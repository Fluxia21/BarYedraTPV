2025-06-07 16:37:35,374 - semgrep.run_scan - DEBUG - semgrep version 1.2.0
2025-06-07 16:37:35,378 - semgrep.git - DEBUG - Failed to get project url from 'git ls-remote': Command failed with exit code: 128
-----
Command failed with output:
fatal: No remote configured to list refs from.


Failed to run 'git ls-remote --get-url'. Possible reasons:

- the git binary is not available
- the current working directory is not a git repository
- the baseline commit is not a parent of the current commit
    (if you are running through semgrep-app, check if you are setting `SEMGREP_BRANCH` or `SEMGREP_BASELINE_COMMIT` properly)
- the current working directory is not marked as safe
    (fix with `git config --global --add safe.directory $(pwd)`)

Try running the command yourself to debug the issue.
2025-06-07 16:37:35,379 - semgrep.config_resolver - DEBUG - Loading local config from /home/runner/workspace/.config/.semgrep/semgrep_rules.json
2025-06-07 16:37:35,381 - semgrep.config_resolver - DEBUG - Done loading local config from /home/runner/workspace/.config/.semgrep/semgrep_rules.json
2025-06-07 16:37:35,384 - semgrep.config_resolver - DEBUG - Saving rules to /tmp/semgrep-64d0_a7e.rules
2025-06-07 16:37:35,530 - semgrep.semgrep_core - DEBUG - Failed to open resource semgrep-core-proprietary: [Errno 2] No such file or directory: '/tmp/_MEIIzo2Qk/semgrep/bin/semgrep-core-proprietary'.
2025-06-07 16:37:36,009 - semgrep.rule_lang - DEBUG - semgrep-core validation response: valid=True
2025-06-07 16:37:36,009 - semgrep.rule_lang - DEBUG - semgrep-core validation succeeded
2025-06-07 16:37:36,009 - semgrep.rule_lang - DEBUG - RPC validation succeeded
2025-06-07 16:37:36,010 - semgrep.config_resolver - DEBUG - loaded 1 configs in 0.6304776668548584
2025-06-07 16:37:36,072 - semgrep.run_scan - VERBOSE - running 712 rules from 1 config /home/runner/workspace/.config/.semgrep/semgrep_rules.json_0
2025-06-07 16:37:36,072 - semgrep.run_scan - VERBOSE - No .semgrepignore found. Using default .semgrepignore rules. See the docs for the list of default ignores: https://semgrep.dev/docs/cli-usage/#ignore-files
2025-06-07 16:37:36,074 - semgrep.run_scan - VERBOSE - Rules:
2025-06-07 16:37:36,074 - semgrep.run_scan - VERBOSE - <SKIPPED DATA (too many entries; use --max-log-list-entries)>
2025-06-07 16:37:36,354 - semgrep.core_runner - DEBUG - Passing whole rules directly to semgrep_core
2025-06-07 16:37:36,467 - semgrep.core_runner - DEBUG - Running Semgrep engine with command:
2025-06-07 16:37:36,467 - semgrep.core_runner - DEBUG - /tmp/_MEIIzo2Qk/semgrep/bin/opengrep-core -json -rules /tmp/tmpkr5g8ysj.json -j 8 -targets /tmp/tmp82isur1z -timeout 5 -timeout_threshold 3 -max_memory 0 -fast
2025-06-07 16:37:42,462 - semgrep.core_runner - DEBUG - --- semgrep-core stderr ---
[00.06][[34mINFO[0m]: Executed as: /tmp/_MEIIzo2Qk/semgrep/bin/opengrep-core -json -rules /tmp/tmpkr5g8ysj.json -j 8 -targets /tmp/tmp82isur1z -timeout 5 -timeout_threshold 3 -max_memory 0 -fast
[00.06][[34mINFO[0m]: Version: 1.2.0
[00.06][[34mINFO[0m]: Parsing rules in /tmp/tmpkr5g8ysj.json
[00.47][[34mINFO[0m]: scan: processing 206 files (skipping 0), with 702 rules (skipping 0 )
[03.14][[33mWARNING[0m]: Fixpoint timeout while performing taint analysis [rule: config..semgrep.vendored-rules.python.boto3.security.hardcoded-token file: init_db.py func: init_database:-1]
[0m[05.92][[34mINFO[0m]: Custom ignore pattern: None
[05.92][[34mINFO[0m]: Custom ignore pattern: None
--- end semgrep-core stderr ---
2025-06-07 16:37:42,591 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 01705a2b0dd7d5bffad2ed21abf5a84ebe678a2dc57461a79c4893913ab48b2cf9b6951348bf983003b88b0d862770ac6cad2d8c840696a2ca917c892443680b_0
2025-06-07 16:37:42,592 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 289fe27b60a76df18142985d6ec4e77f6d8c50c0955081c6254f29039aa832c585500d3584b3b504742295ef3e352f61bc62179b8c0165368f07bf326f6426f3_0
2025-06-07 16:37:42,593 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 289fe27b60a76df18142985d6ec4e77f6d8c50c0955081c6254f29039aa832c585500d3584b3b504742295ef3e352f61bc62179b8c0165368f07bf326f6426f3_0
2025-06-07 16:37:42,593 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 289fe27b60a76df18142985d6ec4e77f6d8c50c0955081c6254f29039aa832c585500d3584b3b504742295ef3e352f61bc62179b8c0165368f07bf326f6426f3_0
2025-06-07 16:37:42,594 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 01705a2b0dd7d5bffad2ed21abf5a84ebe678a2dc57461a79c4893913ab48b2cf9b6951348bf983003b88b0d862770ac6cad2d8c840696a2ca917c892443680b_0
2025-06-07 16:37:42,595 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 289fe27b60a76df18142985d6ec4e77f6d8c50c0955081c6254f29039aa832c585500d3584b3b504742295ef3e352f61bc62179b8c0165368f07bf326f6426f3_0
2025-06-07 16:37:42,596 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 289fe27b60a76df18142985d6ec4e77f6d8c50c0955081c6254f29039aa832c585500d3584b3b504742295ef3e352f61bc62179b8c0165368f07bf326f6426f3_0
2025-06-07 16:37:42,603 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 289fe27b60a76df18142985d6ec4e77f6d8c50c0955081c6254f29039aa832c585500d3584b3b504742295ef3e352f61bc62179b8c0165368f07bf326f6426f3_1
2025-06-07 16:37:42,605 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.open-redirect') match_id = 039979084b3f698c4f4dca82ec442c82e1ad2be4bca81638114f852697a9b7ec049ae29e6e75914c4b57904b692413720f9fd64c770fe49a1961b1d01290d1f0_0
2025-06-07 16:37:42,606 - semgrep.rule_match - DEBUG - match_key = ('mesa_id = flask.request.form\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form.get(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form[...]\n...\nflask.redirect(<... mesa_id ...>, ...)\n flask.redirect(<... flask.request.form ...>, ...) flask.redirect(<... flask.request.form(...) ...>, ...) flask.redirect(<... flask.request.form.get(...) ...>, ...) flask.redirect(<... flask.request.form[...] ...>, ...) @app.route(...)\ndef remove_from_order(...):\n  ...\n @app.route(...)\ndef remove_from_order(...):\n  ...\n  if <... werkzeug.urls.url_parse(mesa_id) ...>:\n    ...\n flask.redirect(f"{flask.request.path}...") flask.redirect(flask.request.path + ...) flask.redirect(flask.request.path)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.open-redirect') match_id = 2ffbe409b4e60dcbdfb5208e408dc7479a067b4cae88d2264a219c51f0b26d5f387f614751565d6b82fa4ec2eabc83883361145a8c883d4c66810abcdd0ab7f8_0
2025-06-07 16:37:42,608 - semgrep.rule_match - DEBUG - match_key = ('mesa_id = flask.request.form\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form.get(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form[...]\n...\nflask.redirect(<... mesa_id ...>, ...)\n flask.redirect(<... flask.request.form ...>, ...) flask.redirect(<... flask.request.form(...) ...>, ...) flask.redirect(<... flask.request.form.get(...) ...>, ...) flask.redirect(<... flask.request.form[...] ...>, ...) @app.route(...)\ndef remove_from_order(...):\n  ...\n @app.route(...)\ndef remove_from_order(...):\n  ...\n  if <... werkzeug.urls.url_parse(mesa_id) ...>:\n    ...\n flask.redirect(f"{flask.request.path}...") flask.redirect(flask.request.path + ...) flask.redirect(flask.request.path)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.open-redirect') match_id = 2ffbe409b4e60dcbdfb5208e408dc7479a067b4cae88d2264a219c51f0b26d5f387f614751565d6b82fa4ec2eabc83883361145a8c883d4c66810abcdd0ab7f8_0
2025-06-07 16:37:42,609 - semgrep.rule_match - DEBUG - match_key = ('mesa_id = flask.request.form\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form.get(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form[...]\n...\nflask.redirect(<... mesa_id ...>, ...)\n flask.redirect(<... flask.request.form ...>, ...) flask.redirect(<... flask.request.form(...) ...>, ...) flask.redirect(<... flask.request.form.get(...) ...>, ...) flask.redirect(<... flask.request.form[...] ...>, ...) @app.route(...)\ndef remove_from_order(...):\n  ...\n @app.route(...)\ndef remove_from_order(...):\n  ...\n  if <... werkzeug.urls.url_parse(mesa_id) ...>:\n    ...\n flask.redirect(f"{flask.request.path}...") flask.redirect(flask.request.path + ...) flask.redirect(flask.request.path)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.open-redirect') match_id = 2ffbe409b4e60dcbdfb5208e408dc7479a067b4cae88d2264a219c51f0b26d5f387f614751565d6b82fa4ec2eabc83883361145a8c883d4c66810abcdd0ab7f8_0
2025-06-07 16:37:42,611 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.open-redirect') match_id = 039979084b3f698c4f4dca82ec442c82e1ad2be4bca81638114f852697a9b7ec049ae29e6e75914c4b57904b692413720f9fd64c770fe49a1961b1d01290d1f0_0
2025-06-07 16:37:42,614 - semgrep.rule_match - DEBUG - match_key = ('mesa_id = flask.request.form\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form.get(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form[...]\n...\nflask.redirect(<... mesa_id ...>, ...)\n flask.redirect(<... flask.request.form ...>, ...) flask.redirect(<... flask.request.form(...) ...>, ...) flask.redirect(<... flask.request.form.get(...) ...>, ...) flask.redirect(<... flask.request.form[...] ...>, ...) @app.route(...)\ndef remove_from_order(...):\n  ...\n @app.route(...)\ndef remove_from_order(...):\n  ...\n  if <... werkzeug.urls.url_parse(mesa_id) ...>:\n    ...\n flask.redirect(f"{flask.request.path}...") flask.redirect(flask.request.path + ...) flask.redirect(flask.request.path)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.open-redirect') match_id = 2ffbe409b4e60dcbdfb5208e408dc7479a067b4cae88d2264a219c51f0b26d5f387f614751565d6b82fa4ec2eabc83883361145a8c883d4c66810abcdd0ab7f8_0
2025-06-07 16:37:42,616 - semgrep.rule_match - DEBUG - match_key = ('mesa_id = flask.request.form\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form.get(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form[...]\n...\nflask.redirect(<... mesa_id ...>, ...)\n flask.redirect(<... flask.request.form ...>, ...) flask.redirect(<... flask.request.form(...) ...>, ...) flask.redirect(<... flask.request.form.get(...) ...>, ...) flask.redirect(<... flask.request.form[...] ...>, ...) @app.route(...)\ndef remove_from_order(...):\n  ...\n @app.route(...)\ndef remove_from_order(...):\n  ...\n  if <... werkzeug.urls.url_parse(mesa_id) ...>:\n    ...\n flask.redirect(f"{flask.request.path}...") flask.redirect(flask.request.path + ...) flask.redirect(flask.request.path)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.open-redirect') match_id = 2ffbe409b4e60dcbdfb5208e408dc7479a067b4cae88d2264a219c51f0b26d5f387f614751565d6b82fa4ec2eabc83883361145a8c883d4c66810abcdd0ab7f8_0
2025-06-07 16:37:42,617 - semgrep.rule_match - DEBUG - match_key = ('mesa_id = flask.request.form\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form.get(...)\n...\nflask.redirect(<... mesa_id ...>, ...)\n mesa_id = flask.request.form[...]\n...\nflask.redirect(<... mesa_id ...>, ...)\n flask.redirect(<... flask.request.form ...>, ...) flask.redirect(<... flask.request.form(...) ...>, ...) flask.redirect(<... flask.request.form.get(...) ...>, ...) flask.redirect(<... flask.request.form[...] ...>, ...) @app.route(...)\ndef remove_from_order(...):\n  ...\n @app.route(...)\ndef remove_from_order(...):\n  ...\n  if <... werkzeug.urls.url_parse(mesa_id) ...>:\n    ...\n flask.redirect(f"{flask.request.path}...") flask.redirect(flask.request.path + ...) flask.redirect(flask.request.path)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.open-redirect') match_id = 2ffbe409b4e60dcbdfb5208e408dc7479a067b4cae88d2264a219c51f0b26d5f387f614751565d6b82fa4ec2eabc83883361145a8c883d4c66810abcdd0ab7f8_1
2025-06-07 16:37:42,619 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.django.security.injection.raw-html-format') match_id = a5700051ac4c46f243de173c34f3d95d4940a53ba879c5e8ac2e8875963e6c675ac2d63a38596ed22190087ddf8c3ac7423c478e3c5811dabb19f20153b706f3_0
2025-06-07 16:37:42,621 - semgrep.rule_match - DEBUG - match_key = ('"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " % ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " + ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del ".format(...) f"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del {...}..." $HTML % ... $HTML + ... $HTML.format(...) $HTML = "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del "\n...\n <b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del  <$TAG ... generic request.args request.build_absolute_uri', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.django.security.injection.raw-html-format') match_id = 44ce85d4ad89b523cf36aed33f2543484f9eb18941c083a83f912ed27856e77210fd6f0d9def6cd1dc1488ed4d4030666d20f81d3360a841cb25679a3768f106_0
2025-06-07 16:37:42,622 - semgrep.rule_match - DEBUG - match_key = ('"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " % ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " + ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del ".format(...) f"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del {...}..." $HTML % ... $HTML + ... $HTML.format(...) $HTML = "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del "\n...\n <b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del  <$TAG ... generic request.args request.build_absolute_uri', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.django.security.injection.raw-html-format') match_id = 44ce85d4ad89b523cf36aed33f2543484f9eb18941c083a83f912ed27856e77210fd6f0d9def6cd1dc1488ed4d4030666d20f81d3360a841cb25679a3768f106_0
2025-06-07 16:37:42,624 - semgrep.rule_match - DEBUG - match_key = ('"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " % ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " + ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del ".format(...) f"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del {...}..." $HTML % ... $HTML + ... $HTML.format(...) $HTML = "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del "\n...\n <b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del  <$TAG ... generic request.args request.build_absolute_uri', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.django.security.injection.raw-html-format') match_id = 44ce85d4ad89b523cf36aed33f2543484f9eb18941c083a83f912ed27856e77210fd6f0d9def6cd1dc1488ed4d4030666d20f81d3360a841cb25679a3768f106_0
2025-06-07 16:37:42,625 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.raw-html-format') match_id = 26d1b278be3811086dee7ebd83104f6e0d59172cd6b5e2d6a4124cafca4d50243c3fd1daf1916f074a7b98075b23ed8d06ce4affdf229875371e5ca4f8ad8268_0
2025-06-07 16:37:42,627 - semgrep.rule_match - DEBUG - match_key = ('"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " % ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " + ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del ".format(...) f"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del {...}..." $HTML % ... $HTML + ... $HTML.format(...) $HTML = "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del "\n...\n <b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del  <$TAG ... generic $ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.args', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.raw-html-format') match_id = da9da13b4491e0c983380eede8f00474825c2a749fa3d4eeb50cc15d7f21980781b272253172f3f38a9b791b73b223bf9daa552592a51383bff13d4d3dba6f04_0
2025-06-07 16:37:42,628 - semgrep.rule_match - DEBUG - match_key = ('"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " % ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " + ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del ".format(...) f"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del {...}..." $HTML % ... $HTML + ... $HTML.format(...) $HTML = "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del "\n...\n <b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del  <$TAG ... generic $ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.args', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.raw-html-format') match_id = da9da13b4491e0c983380eede8f00474825c2a749fa3d4eeb50cc15d7f21980781b272253172f3f38a9b791b73b223bf9daa552592a51383bff13d4d3dba6f04_0
2025-06-07 16:37:42,630 - semgrep.rule_match - DEBUG - match_key = ('"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " % ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del " + ... "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del ".format(...) f"<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del {...}..." $HTML % ... $HTML + ... $HTML.format(...) $HTML = "<b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del "\n...\n <b>BAR YEDRA - INFORME DE FICHAJES</b><br/>Del  <$TAG ... generic $ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.args', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.raw-html-format') match_id = da9da13b4491e0c983380eede8f00474825c2a749fa3d4eeb50cc15d7f21980781b272253172f3f38a9b791b73b223bf9daa552592a51383bff13d4d3dba6f04_0
2025-06-07 16:37:42,638 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_app_run_with_bad_host') match_id = e2644ad455a212799a0730b8ad76663d78adb024c9ffa8f9895fb57dd489e272a3f3cc1be65db0794f59188d07a860995892dbeae860c39d9e44d8f55bc0178b_0
2025-06-07 16:37:42,639 - semgrep.rule_match - DEBUG - match_key = ('app.run(..., "0.0.0.0", ...) app.run(..., host="0.0.0.0", ...)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_app_run_with_bad_host') match_id = ae1e85edb950475b372886323a86cda03f1745ee23989d2c30bcc60ba279204db7f4fed2d29af3c20a4ee5a7db75cf5c97a514131fa4638394995a94b74c6cc8_0
2025-06-07 16:37:42,646 - semgrep.rule_match - DEBUG - match_key = ('app.run(..., "0.0.0.0", ...) app.run(..., host="0.0.0.0", ...)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_app_run_with_bad_host') match_id = ae1e85edb950475b372886323a86cda03f1745ee23989d2c30bcc60ba279204db7f4fed2d29af3c20a4ee5a7db75cf5c97a514131fa4638394995a94b74c6cc8_0
2025-06-07 16:37:42,647 - semgrep.rule_match - DEBUG - match_key = ('app.run(..., "0.0.0.0", ...) app.run(..., host="0.0.0.0", ...)', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_app_run_with_bad_host') match_id = ae1e85edb950475b372886323a86cda03f1745ee23989d2c30bcc60ba279204db7f4fed2d29af3c20a4ee5a7db75cf5c97a514131fa4638394995a94b74c6cc8_0
2025-06-07 16:37:42,649 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.debug-enabled') match_id = b80416feb6b0c2c94812093632c35fe54d10ea2069f4547cf64c1d6c380704fe3dadae707ed562bdebf2cb39a9b4484dd15601f4a32db83c1e40ba04ae7d0175_0
2025-06-07 16:37:42,651 - semgrep.rule_match - DEBUG - match_key = ('app.run(..., debug=True, ...) import flask\n...\n', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.debug-enabled') match_id = 02d3345a06f51164a46344efbf76b42a6a99d28277a21abfc9472d3e328408b28b239c943ddaed3fe92d9aa04f195fa8262f23114a0123f063dfd6f87a459e6b_0
2025-06-07 16:37:42,652 - semgrep.rule_match - DEBUG - match_key = ('app.run(..., debug=True, ...) import flask\n...\n', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.debug-enabled') match_id = 02d3345a06f51164a46344efbf76b42a6a99d28277a21abfc9472d3e328408b28b239c943ddaed3fe92d9aa04f195fa8262f23114a0123f063dfd6f87a459e6b_0
2025-06-07 16:37:42,654 - semgrep.rule_match - DEBUG - match_key = ('app.run(..., debug=True, ...) import flask\n...\n', PosixPath('app.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.debug-enabled') match_id = 02d3345a06f51164a46344efbf76b42a6a99d28277a21abfc9472d3e328408b28b239c943ddaed3fe92d9aa04f195fa8262f23114a0123f063dfd6f87a459e6b_0
2025-06-07 16:37:42,658 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app_simple.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 4fd1d09a8c8173309cb997d0649b83d6e922b895b6a47e7671da0f015b9d86a6711df4f43dcf16ebacf57cc5de9c3dfdc3a80ffc5e0cad6425f600a0fd605488_0
2025-06-07 16:37:42,659 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app_simple.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = d0c537b1418fd5f8fc2411bd8b3eeecf1b64d656a474b32265acd34bd533d9938f368292dfda1b3e430c172b89fed33d0a30fcb09bef9c433a13f1aaa3cdcc01_0
2025-06-07 16:37:42,662 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app_simple.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = d0c537b1418fd5f8fc2411bd8b3eeecf1b64d656a474b32265acd34bd533d9938f368292dfda1b3e430c172b89fed33d0a30fcb09bef9c433a13f1aaa3cdcc01_0
2025-06-07 16:37:42,663 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app_simple.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = d0c537b1418fd5f8fc2411bd8b3eeecf1b64d656a474b32265acd34bd533d9938f368292dfda1b3e430c172b89fed33d0a30fcb09bef9c433a13f1aaa3cdcc01_0
2025-06-07 16:37:42,665 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('app_simple.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 4fd1d09a8c8173309cb997d0649b83d6e922b895b6a47e7671da0f015b9d86a6711df4f43dcf16ebacf57cc5de9c3dfdc3a80ffc5e0cad6425f600a0fd605488_0
2025-06-07 16:37:42,666 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app_simple.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = d0c537b1418fd5f8fc2411bd8b3eeecf1b64d656a474b32265acd34bd533d9938f368292dfda1b3e430c172b89fed33d0a30fcb09bef9c433a13f1aaa3cdcc01_0
2025-06-07 16:37:42,667 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app_simple.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = d0c537b1418fd5f8fc2411bd8b3eeecf1b64d656a474b32265acd34bd533d9938f368292dfda1b3e430c172b89fed33d0a30fcb09bef9c433a13f1aaa3cdcc01_0
2025-06-07 16:37:42,668 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('app_simple.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = d0c537b1418fd5f8fc2411bd8b3eeecf1b64d656a474b32265acd34bd533d9938f368292dfda1b3e430c172b89fed33d0a30fcb09bef9c433a13f1aaa3cdcc01_1
2025-06-07 16:37:42,668 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,669 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,670 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,670 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,671 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,672 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,672 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,673 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_1
2025-06-07 16:37:42,674 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,674 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,675 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,676 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_2
2025-06-07 16:37:42,676 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,677 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,678 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,679 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_3
2025-06-07 16:37:42,679 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,680 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,682 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,682 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_4
2025-06-07 16:37:42,683 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,684 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,684 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,685 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_5
2025-06-07 16:37:42,686 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,686 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,687 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,688 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_6
2025-06-07 16:37:42,689 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,689 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,690 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,691 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_7
2025-06-07 16:37:42,691 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,692 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,693 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,693 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_8
2025-06-07 16:37:42,694 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 805fb61f3282844f9f37c9219111512a1ef1fa307203a416ef471bba8e8c739835ba875a9a0cae6649680b496a148c7a6b7ab53eeaef78a9d78006ba050f1e6e_0
2025-06-07 16:37:42,694 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 332d5a8dc5cc20c2634617c08e90dcc42215d1d38811a0114f0bd5da9141476ac18a92f10fccdfbb3e893497710ae947ac38b1b73e341ffff6a55df7fbd0ad14_0
2025-06-07 16:37:42,695 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 332d5a8dc5cc20c2634617c08e90dcc42215d1d38811a0114f0bd5da9141476ac18a92f10fccdfbb3e893497710ae947ac38b1b73e341ffff6a55df7fbd0ad14_0
2025-06-07 16:37:42,696 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 332d5a8dc5cc20c2634617c08e90dcc42215d1d38811a0114f0bd5da9141476ac18a92f10fccdfbb3e893497710ae947ac38b1b73e341ffff6a55df7fbd0ad14_0
2025-06-07 16:37:42,696 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 805fb61f3282844f9f37c9219111512a1ef1fa307203a416ef471bba8e8c739835ba875a9a0cae6649680b496a148c7a6b7ab53eeaef78a9d78006ba050f1e6e_0
2025-06-07 16:37:42,697 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 332d5a8dc5cc20c2634617c08e90dcc42215d1d38811a0114f0bd5da9141476ac18a92f10fccdfbb3e893497710ae947ac38b1b73e341ffff6a55df7fbd0ad14_0
2025-06-07 16:37:42,698 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 332d5a8dc5cc20c2634617c08e90dcc42215d1d38811a0114f0bd5da9141476ac18a92f10fccdfbb3e893497710ae947ac38b1b73e341ffff6a55df7fbd0ad14_0
2025-06-07 16:37:42,699 - semgrep.rule_match - DEBUG - match_key = ('$ROUTEVAR @$APP.route(...)\ndef $FUNC(..., $ROUTEVAR, ...):\n  ...\n flask.request.form.get(...) flask.request.form[...] bool(...) complex(...) float(...)', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.flask.security.injection.nan-injection') match_id = 332d5a8dc5cc20c2634617c08e90dcc42215d1d38811a0114f0bd5da9141476ac18a92f10fccdfbb3e893497710ae947ac38b1b73e341ffff6a55df7fbd0ad14_1
2025-06-07 16:37:42,700 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = d0225fb0d2b80b2d959572dc2241908b043ba2b54e73b930bd5460eca830479148e236e0af9cc60bab7c0db6d430a3e22e40686326c642efab36ac31ba03b7c9_0
2025-06-07 16:37:42,700 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,701 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_0
2025-06-07 16:37:42,702 - semgrep.rule_match - DEBUG - match_key = ('cursor.execute("..." % ...) cursor.execute("...".format(...)) cursor.execute($SQL) $SQL = "..." % ...\n...\n $SQL = "...".format(...)\n...\n $SQL = f"...{$X}..."\n...\n cursor.execute(f"...")', PosixPath('bar_yedra_tpv.py'), 'config..semgrep.vendored-rules.python.lang.security.audit.formatted-sql-query') match_id = e1c2eaae1e94c97ca8243544e5de02a6946f98de7844bfe8e71490d03dd47210d8bbcee36185b461370c0b17f9230d3a4bb5f78f538edd4ae58c92c1f2c51bf7_9
2025-06-07 16:37:42,703 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('main.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_app_run_with_bad_host') match_id = f5a1d78d28043340433dedc0a20165e63b50d9aa4305aede97be74105c8207b5b89db08fa6703decc4ec27aafa081254be07d38814f40c19f447cf4721551845_0
2025-06-07 16:37:42,703 - semgrep.rule_match - DEBUG - match_key = ('app.run(..., "0.0.0.0", ...) app.run(..., host="0.0.0.0", ...)', PosixPath('main.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_app_run_with_bad_host') match_id = 5c1cbbc54bfaa7420b881ae9f997ad4b5ed5aa16b127a74e037d220112ac891aa501638c0e19641f765822573b5e6f14657485c6b72c0846fdec9bc63200dc57_0
2025-06-07 16:37:42,704 - semgrep.rule_match - DEBUG - match_key = ('app.run(..., "0.0.0.0", ...) app.run(..., host="0.0.0.0", ...)', PosixPath('main.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_app_run_with_bad_host') match_id = 5c1cbbc54bfaa7420b881ae9f997ad4b5ed5aa16b127a74e037d220112ac891aa501638c0e19641f765822573b5e6f14657485c6b72c0846fdec9bc63200dc57_0
2025-06-07 16:37:42,705 - semgrep.rule_match - DEBUG - match_key = ('app.run(..., "0.0.0.0", ...) app.run(..., host="0.0.0.0", ...)', PosixPath('main.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_app_run_with_bad_host') match_id = 5c1cbbc54bfaa7420b881ae9f997ad4b5ed5aa16b127a74e037d220112ac891aa501638c0e19641f765822573b5e6f14657485c6b72c0846fdec9bc63200dc57_0
2025-06-07 16:37:42,705 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('run_server.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_hardcoded_config_DEBUG') match_id = 32b19e3730d73b8a60a255c425faf171a3274b6979d0223afa8b288c6ec38a4ac19d20d33a643a7942047bed5248b71de788de3bda1432734afd4e899ea298bd_0
2025-06-07 16:37:42,706 - semgrep.rule_match - DEBUG - match_key = ("app app.config['DEBUG'] = False app app.config['DEBUG'] = True app app.update(DEBUG=False) app app.update(DEBUG=True)", PosixPath('run_server.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_hardcoded_config_DEBUG') match_id = b0f5530d144c53cc7fa791c0b904c82c92d5ed1983d43be65791892dd767dc0bd2d6f313f4f9a59e72ee57b49c34019a3704577bb6eee57d8e5b9014286b23a2_0
2025-06-07 16:37:42,707 - semgrep.rule_match - DEBUG - match_key = ("app app.config['DEBUG'] = False app app.config['DEBUG'] = True app app.update(DEBUG=False) app app.update(DEBUG=True)", PosixPath('run_server.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_hardcoded_config_DEBUG') match_id = b0f5530d144c53cc7fa791c0b904c82c92d5ed1983d43be65791892dd767dc0bd2d6f313f4f9a59e72ee57b49c34019a3704577bb6eee57d8e5b9014286b23a2_0
2025-06-07 16:37:42,707 - semgrep.rule_match - DEBUG - match_key = ("app app.config['DEBUG'] = False app app.config['DEBUG'] = True app app.update(DEBUG=False) app app.update(DEBUG=True)", PosixPath('run_server.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_hardcoded_config_DEBUG') match_id = b0f5530d144c53cc7fa791c0b904c82c92d5ed1983d43be65791892dd767dc0bd2d6f313f4f9a59e72ee57b49c34019a3704577bb6eee57d8e5b9014286b23a2_0
2025-06-07 16:37:42,708 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('run_server.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_hardcoded_config_ENV') match_id = c8b70432c9ca7aaf4b1866bf3dd9edbb35309430f470824ba7ff4629c4a98434dcab652dd165f742389cacbe18b32e4895ee4799a7e6df87f81d7f55ee3d988a_0
2025-06-07 16:37:42,709 - semgrep.rule_match - DEBUG - match_key = ('app app.config[\'ENV\'] = "=~/^development|production$/" app app.update(ENV="=~/^development|production$/")', PosixPath('run_server.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_hardcoded_config_ENV') match_id = 1b372ce08f9e0a237afc1282df38044e9b5fe2750060576c1ecee2edf2b1010cdb1649724ce38bf18835b9583cce43d66f25c2f016bc9a524fbbd84a31b6cc17_0
2025-06-07 16:37:42,709 - semgrep.rule_match - DEBUG - match_key = ('app app.config[\'ENV\'] = "=~/^development|production$/" app app.update(ENV="=~/^development|production$/")', PosixPath('run_server.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_hardcoded_config_ENV') match_id = 1b372ce08f9e0a237afc1282df38044e9b5fe2750060576c1ecee2edf2b1010cdb1649724ce38bf18835b9583cce43d66f25c2f016bc9a524fbbd84a31b6cc17_0
2025-06-07 16:37:42,710 - semgrep.rule_match - DEBUG - match_key = ('app app.config[\'ENV\'] = "=~/^development|production$/" app app.update(ENV="=~/^development|production$/")', PosixPath('run_server.py'), 'config..semgrep.vendored-rules.python.flask.security.audit.avoid_hardcoded_config_ENV') match_id = 1b372ce08f9e0a237afc1282df38044e9b5fe2750060576c1ecee2edf2b1010cdb1649724ce38bf18835b9583cce43d66f25c2f016bc9a524fbbd84a31b6cc17_0
2025-06-07 16:37:42,711 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-innerhtml') match_id = 2b86126e7b1d21a2147a0edaa6aeb022b6b5537f2b2b271b88c1c474963a057f975db86f09c9ad19d79f83ef16028d1eff14776b5ee13a4f9684c244062739a9_0
2025-06-07 16:37:42,712 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-innerhtml') match_id = 6637ce6c09e4e11937812cde8267c0df6f11bd99f8222ffb8a923fa5e863685de18576871702c95bcc0f7622180a9e8dac9b7bc48bf6699b5e5411be85c17b74_0
2025-06-07 16:37:42,713 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-innerhtml') match_id = 6637ce6c09e4e11937812cde8267c0df6f11bd99f8222ffb8a923fa5e863685de18576871702c95bcc0f7622180a9e8dac9b7bc48bf6699b5e5411be85c17b74_0
2025-06-07 16:37:42,714 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-innerhtml') match_id = 6637ce6c09e4e11937812cde8267c0df6f11bd99f8222ffb8a923fa5e863685de18576871702c95bcc0f7622180a9e8dac9b7bc48bf6699b5e5411be85c17b74_0
2025-06-07 16:37:42,715 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-document-method') match_id = 79bc926098d389030996c1bcd0046741934dfa906ba49f09b2147dc97df587562ae136d62ac2565b7ee4c261aa0db20425613ae2f1445149659188012692bdaf_0
2025-06-07 16:37:42,716 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n button.outerHTML = originalText;\n document.write(...) button.outerHTML = "...";\n document.write("...")', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-document-method') match_id = 42e7c369303780c52749501d97f99f126b7a3f9bb9f64629967b87867cbcc6f2e9bac672074f1572a4eed6b2e1231beb4fe403b6ee7bd44eca68ab8a170a7c60_0
2025-06-07 16:37:42,717 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n button.outerHTML = originalText;\n document.write(...) button.outerHTML = "...";\n document.write("...")', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-document-method') match_id = 42e7c369303780c52749501d97f99f126b7a3f9bb9f64629967b87867cbcc6f2e9bac672074f1572a4eed6b2e1231beb4fe403b6ee7bd44eca68ab8a170a7c60_0
2025-06-07 16:37:42,717 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n button.outerHTML = originalText;\n document.write(...) button.outerHTML = "...";\n document.write("...")', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-document-method') match_id = 42e7c369303780c52749501d97f99f126b7a3f9bb9f64629967b87867cbcc6f2e9bac672074f1572a4eed6b2e1231beb4fe403b6ee7bd44eca68ab8a170a7c60_0
2025-06-07 16:37:42,718 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-innerhtml') match_id = 2b86126e7b1d21a2147a0edaa6aeb022b6b5537f2b2b271b88c1c474963a057f975db86f09c9ad19d79f83ef16028d1eff14776b5ee13a4f9684c244062739a9_0
2025-06-07 16:37:42,719 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-innerhtml') match_id = 6637ce6c09e4e11937812cde8267c0df6f11bd99f8222ffb8a923fa5e863685de18576871702c95bcc0f7622180a9e8dac9b7bc48bf6699b5e5411be85c17b74_0
2025-06-07 16:37:42,720 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-innerhtml') match_id = 6637ce6c09e4e11937812cde8267c0df6f11bd99f8222ffb8a923fa5e863685de18576871702c95bcc0f7622180a9e8dac9b7bc48bf6699b5e5411be85c17b74_0
2025-06-07 16:37:42,721 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-innerhtml') match_id = 6637ce6c09e4e11937812cde8267c0df6f11bd99f8222ffb8a923fa5e863685de18576871702c95bcc0f7622180a9e8dac9b7bc48bf6699b5e5411be85c17b74_1
2025-06-07 16:37:42,721 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-document-method') match_id = 79bc926098d389030996c1bcd0046741934dfa906ba49f09b2147dc97df587562ae136d62ac2565b7ee4c261aa0db20425613ae2f1445149659188012692bdaf_0
2025-06-07 16:37:42,722 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n button.outerHTML = originalText;\n document.write(...) button.outerHTML = "...";\n document.write("...")', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-document-method') match_id = 42e7c369303780c52749501d97f99f126b7a3f9bb9f64629967b87867cbcc6f2e9bac672074f1572a4eed6b2e1231beb4fe403b6ee7bd44eca68ab8a170a7c60_0
2025-06-07 16:37:42,723 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n button.outerHTML = originalText;\n document.write(...) button.outerHTML = "...";\n document.write("...")', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-document-method') match_id = 42e7c369303780c52749501d97f99f126b7a3f9bb9f64629967b87867cbcc6f2e9bac672074f1572a4eed6b2e1231beb4fe403b6ee7bd44eca68ab8a170a7c60_0
2025-06-07 16:37:42,724 - semgrep.rule_match - DEBUG - match_key = ('button.innerHTML = "...";\n button.innerHTML = originalText;\n button.outerHTML = originalText;\n document.write(...) button.outerHTML = "...";\n document.write("...")', PosixPath('static/js/main.js'), 'config..semgrep.vendored-rules.javascript.browser.security.insecure-document-method') match_id = 42e7c369303780c52749501d97f99f126b7a3f9bb9f64629967b87867cbcc6f2e9bac672074f1572a4eed6b2e1231beb4fe403b6ee7bd44eca68ab8a170a7c60_1
2025-06-07 16:37:42,724 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/carta_publica.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = d53b3564293ec5432ac9b044cc53b7ee09cc182841a4565e942edb1a96be6ed1deebb9e86698fe05ba951133d311a065cd141422a9ac6b3fabd669a7fbbe9298_0
2025-06-07 16:37:42,725 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" > <script  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" >...</script>', PosixPath('templates/carta_publica.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 6958b2199a4be3dac9673b5cb99dd2a057db40c9d9eed0482ae1c3bd61becc40cadd1b4176d45b1dfa6ca962162019cb6885b7a5581b51a35090512e23eb25d3_0
2025-06-07 16:37:42,725 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" > <script  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" >...</script>', PosixPath('templates/carta_publica.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 6958b2199a4be3dac9673b5cb99dd2a057db40c9d9eed0482ae1c3bd61becc40cadd1b4176d45b1dfa6ca962162019cb6885b7a5581b51a35090512e23eb25d3_0
2025-06-07 16:37:42,726 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" > <script  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" >...</script>', PosixPath('templates/carta_publica.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 6958b2199a4be3dac9673b5cb99dd2a057db40c9d9eed0482ae1c3bd61becc40cadd1b4176d45b1dfa6ca962162019cb6885b7a5581b51a35090512e23eb25d3_0
2025-06-07 16:37:42,727 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/cash_register.html'), 'config..semgrep.vendored-rules.python.django.security.django-no-csrf-token') match_id = 10edfaa4c38dd10836a556422d72438668950c378e291a9b9747973f6c2adb94ae55191b04f1c17330e1a811be130433903284b32467dd27caf760043a173394_0
2025-06-07 16:37:42,727 - semgrep.rule_match - DEBUG - match_key = ('POST (?i)(post|put|delete|patch) <form ... method="POST" ...>...</form>\n <form ... method=POST ...>...</form>\n <form ... method=\'POST\' ...>...</form>\n <form...>...</form> <form...>...{% csrf_token %}...</form> <form...>...{{ $VAR.csrf_token }}...</form>', PosixPath('templates/cash_register.html'), 'config..semgrep.vendored-rules.python.django.security.django-no-csrf-token') match_id = ce0bbca5f493baa2ff7e89d32a256c9746e7d7c73f2e99796c8370395fa66e67c8b28e96ce37e2006f5f1bd503438f124c41e57f2a50639b2762d7300d9d69b6_0
2025-06-07 16:37:42,728 - semgrep.rule_match - DEBUG - match_key = ('POST (?i)(post|put|delete|patch) <form ... method="POST" ...>...</form>\n <form ... method=POST ...>...</form>\n <form ... method=\'POST\' ...>...</form>\n <form...>...</form> <form...>...{% csrf_token %}...</form> <form...>...{{ $VAR.csrf_token }}...</form>', PosixPath('templates/cash_register.html'), 'config..semgrep.vendored-rules.python.django.security.django-no-csrf-token') match_id = ce0bbca5f493baa2ff7e89d32a256c9746e7d7c73f2e99796c8370395fa66e67c8b28e96ce37e2006f5f1bd503438f124c41e57f2a50639b2762d7300d9d69b6_0
2025-06-07 16:37:42,729 - semgrep.rule_match - DEBUG - match_key = ('POST (?i)(post|put|delete|patch) <form ... method="POST" ...>...</form>\n <form ... method=POST ...>...</form>\n <form ... method=\'POST\' ...>...</form>\n <form...>...</form> <form...>...{% csrf_token %}...</form> <form...>...{{ $VAR.csrf_token }}...</form>', PosixPath('templates/cash_register.html'), 'config..semgrep.vendored-rules.python.django.security.django-no-csrf-token') match_id = ce0bbca5f493baa2ff7e89d32a256c9746e7d7c73f2e99796c8370395fa66e67c8b28e96ce37e2006f5f1bd503438f124c41e57f2a50639b2762d7300d9d69b6_0
2025-06-07 16:37:42,730 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/layout.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 2dc33e3a5ac6a9105c811f0ed00304b11c884be9baeb12186d4e4e1bef85536a7e92a6e9db2478e5927476ccfbd35898a5f5385b13035a6e4bcbb68fa77a0265_0
2025-06-07 16:37:42,730 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" > <script  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" >...</script>', PosixPath('templates/layout.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 69983913bb5809e4a7203d26e16c37caed62bbc34d9800371209187e0cb58de7851b3799147cae53304141608e97a4acce277ab4287a440a6dc717eb5efae567_0
2025-06-07 16:37:42,731 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" > <script  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" >...</script>', PosixPath('templates/layout.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 69983913bb5809e4a7203d26e16c37caed62bbc34d9800371209187e0cb58de7851b3799147cae53304141608e97a4acce277ab4287a440a6dc717eb5efae567_0
2025-06-07 16:37:42,732 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" > <script  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" >...</script>', PosixPath('templates/layout.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 69983913bb5809e4a7203d26e16c37caed62bbc34d9800371209187e0cb58de7851b3799147cae53304141608e97a4acce277ab4287a440a6dc717eb5efae567_0
2025-06-07 16:37:42,733 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/layout.html'), 'config..semgrep.vendored-rules.javascript.express.security.audit.xss.mustache.var-in-script-tag') match_id = fe307bc6174a6e5d52fc4f0e5415cdcdb5d8442d8256791ee77cae970c7f4a66bd96f11087b7dd685cc8477764366fc355c9ccd668d2d04cf0e87643bd68e7b6_0
2025-06-07 16:37:42,733 - semgrep.rule_match - DEBUG - match_key = ('<script ...> ... </script> {{ ... }}', PosixPath('templates/layout.html'), 'config..semgrep.vendored-rules.javascript.express.security.audit.xss.mustache.var-in-script-tag') match_id = f5df66b54afd917b161f975afbbaa61399e05cdbcf9a700aa4e3c0984ada5d7565e1f7aa62f08151e05da2579b740ed9070685c312c8258476ecc179a2ed6ef2_0
2025-06-07 16:37:42,734 - semgrep.rule_match - DEBUG - match_key = ('<script ...> ... </script> {{ ... }}', PosixPath('templates/layout.html'), 'config..semgrep.vendored-rules.javascript.express.security.audit.xss.mustache.var-in-script-tag') match_id = f5df66b54afd917b161f975afbbaa61399e05cdbcf9a700aa4e3c0984ada5d7565e1f7aa62f08151e05da2579b740ed9070685c312c8258476ecc179a2ed6ef2_0
2025-06-07 16:37:42,735 - semgrep.rule_match - DEBUG - match_key = ('<script ...> ... </script> {{ ... }}', PosixPath('templates/layout.html'), 'config..semgrep.vendored-rules.javascript.express.security.audit.xss.mustache.var-in-script-tag') match_id = f5df66b54afd917b161f975afbbaa61399e05cdbcf9a700aa4e3c0984ada5d7565e1f7aa62f08151e05da2579b740ed9070685c312c8258476ecc179a2ed6ef2_0
2025-06-07 16:37:42,736 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/login.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = bb72402d9e3ddbfb78604a9eeef42e78be396c927d11bc5c0442fccb660dcc584eb473c4a986d1ce8a8ca43ea82480eb905b0ca611b2f98965c38aca60d617d6_0
2025-06-07 16:37:42,736 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" > <script  href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" >...</script>', PosixPath('templates/login.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = ecfdadc42f4e9d27d0cf5019456079b01936b8e12a38c3dcd9ffd4f00c1aeaba851189c1d96688ee9580de3830655ef8e3d6bfa540cae70480b369dd90813381_0
2025-06-07 16:37:42,737 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" > <script  href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" >...</script>', PosixPath('templates/login.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = ecfdadc42f4e9d27d0cf5019456079b01936b8e12a38c3dcd9ffd4f00c1aeaba851189c1d96688ee9580de3830655ef8e3d6bfa540cae70480b369dd90813381_0
2025-06-07 16:37:42,738 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" > <script  href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" >...</script>', PosixPath('templates/login.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = ecfdadc42f4e9d27d0cf5019456079b01936b8e12a38c3dcd9ffd4f00c1aeaba851189c1d96688ee9580de3830655ef8e3d6bfa540cae70480b369dd90813381_0
2025-06-07 16:37:42,739 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/login.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = bb72402d9e3ddbfb78604a9eeef42e78be396c927d11bc5c0442fccb660dcc584eb473c4a986d1ce8a8ca43ea82480eb905b0ca611b2f98965c38aca60d617d6_0
2025-06-07 16:37:42,740 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" > <script  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" >...</script>', PosixPath('templates/login.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 426b25a6da74d9fb4d365e2aca24137286f42624b58fa74f94fb4970155ebe698d44585d5d70e1227b335f9158fc0049029076b9340e5bb305a026f88b746c3f_0
2025-06-07 16:37:42,741 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" > <script  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" >...</script>', PosixPath('templates/login.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 426b25a6da74d9fb4d365e2aca24137286f42624b58fa74f94fb4970155ebe698d44585d5d70e1227b335f9158fc0049029076b9340e5bb305a026f88b746c3f_0
2025-06-07 16:37:42,742 - semgrep.rule_match - DEBUG - match_key = (' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" (?is).*integrity= (google-analytics\\.com|fonts\\.googleapis\\.com|fonts\\.gstatic\\.com|googletagmanager\\.com) .*rel\\s*=\\s*[\'"]?preconnect.* href="... :// ..." href="//..." href=\'... :// ...\' href=\'//...\' src="... :// ..." src="//..." src=\'... :// ...\' src=\'//...\' <link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" > <script  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" >...</script>', PosixPath('templates/login.html'), 'config..semgrep.vendored-rules.html.security.audit.missing-integrity') match_id = 426b25a6da74d9fb4d365e2aca24137286f42624b58fa74f94fb4970155ebe698d44585d5d70e1227b335f9158fc0049029076b9340e5bb305a026f88b746c3f_0
2025-06-07 16:37:42,744 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/mesa_pedido.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = f04e1490ce431aa6d2439cc196205f625fb2e807cd82e40f0e1788a85f519e9edce12e15027ee84f3e5c95e5c6bce099c08c3e1c58e3d04115431fa57c09ef06_0
2025-06-07 16:37:42,746 - semgrep.rule_match - DEBUG - match_key = ('\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre }}",\n            precio_base: {{ producto.precio_base if producto.precio_base else producto.precio_final }},\n            precio_final: {{ producto.precio_final }},\n            es_terraza: {{ \'true\' if es_terraza else \'false\' }}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction abrirModalCategoria(categoria) {\n    const modal = document.getElementById(\'modalProductos\');\n    const modalTitle = document.getElementById(\'modalTitle\');\n    const productosGrid = document.getElementById(\'productosGrid\');\n    \n    modalTitle.textContent = categoria;\n    productosGrid.innerHTML = \'\';\n    \n    const productos = productosData[categoria];\n    productos.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card\';\n        productCard.onclick = () => agregarProducto(producto.id, producto.nombre, producto.precio_final);\n        \n        let precioHTML;\n        if (producto.es_terraza && producto.precio_base !== producto.precio_final) {\n            precioHTML = `\n                <div class="price-base">€${producto.precio_base.toFixed(2)}</div>\n                <div class="product-price price-terraza">€${producto.precio_final.toFixed(2)}</div>\n            `;\n        } else {\n            precioHTML = `<div class="product-price">€${producto.precio_final.toFixed(2)}</div>`;\n        }\n        \n        productCard.innerHTML = `\n            <div class="product-name">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n    \n    modal.style.display = \'block\';\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'modalProductos\');\n    modal.style.display = \'none\';\n}\n\nfunction agregarProducto(id, nombre, precio) {\n    // Aquí iría la lógica para agregar el producto al pedido\n    alert(\'Producto añadido: \' + nombre + \' - €\' + precio.toFixed(2));\n    cerrarModal();\n}\n\n// Cerrar modal al hacer clic fuera de él\nwindow.onclick = function(event) {\n    const modal = document.getElementById(\'modalProductos\');\n    if (event.target == modal) {\n        cerrarModal();\n    }\n}\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre }}",\n            precio_base: {{ producto.precio_base if producto.precio_base else producto.precio_final }},\n            precio_final: {{ producto.precio_final }},\n            es_terraza: {{ \'true\' if es_terraza else \'false\' }}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction abrirModalCategoria(categoria) {\n    const modal = document.getElementById(\'modalProductos\');\n    const modalTitle = document.getElementById(\'modalTitle\');\n    const productosGrid = document.getElementById(\'productosGrid\');\n    \n    modalTitle.textContent = categoria;\n    productosGrid.innerHTML = \'\';\n    \n    const productos = productosData[categoria];\n    productos.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card\';\n        productCard.onclick = () => agregarProducto(producto.id, producto.nombre, producto.precio_final);\n        \n        let precioHTML;\n        if (producto.es_terraza && producto.precio_base !== producto.precio_final) {\n            precioHTML = `\n                <div class="price-base">€${producto.precio_base.toFixed(2)}</div>\n                <div class="product-price price-terraza">€${producto.precio_final.toFixed(2)}</div>\n            `;\n        } else {\n            precioHTML = `<div class="product-price">€${producto.precio_final.toFixed(2)}</div>`;\n        }\n        \n        productCard.innerHTML = `\n            <div class="product-name">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n    \n    modal.style.display = \'block\';\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'modalProductos\');\n    modal.style.display = \'none\';\n}\n\nfunction agregarProducto(id, nombre, precio) {\n    // Aquí iría la lógica para agregar el producto al pedido\n    alert(\'Producto añadido: \' + nombre + \' - €\' + precio.toFixed(2));\n    cerrarModal();\n}\n\n// Cerrar modal al hacer clic fuera de él\nwindow.onclick = function(event) {\n    const modal = document.getElementById(\'modalProductos\');\n    if (event.target == modal) {\n        cerrarModal();\n    }\n}\n</script>\n', PosixPath('templates/mesa_pedido.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 9867618fbf11071dbcb16c2f32b31757f69e145168b72cd3402cdd2b10ae143cbd002ec67a8bf8b6dd94c4db8fd6293d49cd0f59ed26c7afdd501c0af1e499c7_0
2025-06-07 16:37:42,747 - semgrep.rule_match - DEBUG - match_key = ('\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre }}",\n            precio_base: {{ producto.precio_base if producto.precio_base else producto.precio_final }},\n            precio_final: {{ producto.precio_final }},\n            es_terraza: {{ \'true\' if es_terraza else \'false\' }}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction abrirModalCategoria(categoria) {\n    const modal = document.getElementById(\'modalProductos\');\n    const modalTitle = document.getElementById(\'modalTitle\');\n    const productosGrid = document.getElementById(\'productosGrid\');\n    \n    modalTitle.textContent = categoria;\n    productosGrid.innerHTML = \'\';\n    \n    const productos = productosData[categoria];\n    productos.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card\';\n        productCard.onclick = () => agregarProducto(producto.id, producto.nombre, producto.precio_final);\n        \n        let precioHTML;\n        if (producto.es_terraza && producto.precio_base !== producto.precio_final) {\n            precioHTML = `\n                <div class="price-base">€${producto.precio_base.toFixed(2)}</div>\n                <div class="product-price price-terraza">€${producto.precio_final.toFixed(2)}</div>\n            `;\n        } else {\n            precioHTML = `<div class="product-price">€${producto.precio_final.toFixed(2)}</div>`;\n        }\n        \n        productCard.innerHTML = `\n            <div class="product-name">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n    \n    modal.style.display = \'block\';\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'modalProductos\');\n    modal.style.display = \'none\';\n}\n\nfunction agregarProducto(id, nombre, precio) {\n    // Aquí iría la lógica para agregar el producto al pedido\n    alert(\'Producto añadido: \' + nombre + \' - €\' + precio.toFixed(2));\n    cerrarModal();\n}\n\n// Cerrar modal al hacer clic fuera de él\nwindow.onclick = function(event) {\n    const modal = document.getElementById(\'modalProductos\');\n    if (event.target == modal) {\n        cerrarModal();\n    }\n}\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre }}",\n            precio_base: {{ producto.precio_base if producto.precio_base else producto.precio_final }},\n            precio_final: {{ producto.precio_final }},\n            es_terraza: {{ \'true\' if es_terraza else \'false\' }}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction abrirModalCategoria(categoria) {\n    const modal = document.getElementById(\'modalProductos\');\n    const modalTitle = document.getElementById(\'modalTitle\');\n    const productosGrid = document.getElementById(\'productosGrid\');\n    \n    modalTitle.textContent = categoria;\n    productosGrid.innerHTML = \'\';\n    \n    const productos = productosData[categoria];\n    productos.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card\';\n        productCard.onclick = () => agregarProducto(producto.id, producto.nombre, producto.precio_final);\n        \n        let precioHTML;\n        if (producto.es_terraza && producto.precio_base !== producto.precio_final) {\n            precioHTML = `\n                <div class="price-base">€${producto.precio_base.toFixed(2)}</div>\n                <div class="product-price price-terraza">€${producto.precio_final.toFixed(2)}</div>\n            `;\n        } else {\n            precioHTML = `<div class="product-price">€${producto.precio_final.toFixed(2)}</div>`;\n        }\n        \n        productCard.innerHTML = `\n            <div class="product-name">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n    \n    modal.style.display = \'block\';\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'modalProductos\');\n    modal.style.display = \'none\';\n}\n\nfunction agregarProducto(id, nombre, precio) {\n    // Aquí iría la lógica para agregar el producto al pedido\n    alert(\'Producto añadido: \' + nombre + \' - €\' + precio.toFixed(2));\n    cerrarModal();\n}\n\n// Cerrar modal al hacer clic fuera de él\nwindow.onclick = function(event) {\n    const modal = document.getElementById(\'modalProductos\');\n    if (event.target == modal) {\n        cerrarModal();\n    }\n}\n</script>\n', PosixPath('templates/mesa_pedido.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 9867618fbf11071dbcb16c2f32b31757f69e145168b72cd3402cdd2b10ae143cbd002ec67a8bf8b6dd94c4db8fd6293d49cd0f59ed26c7afdd501c0af1e499c7_0
2025-06-07 16:37:42,749 - semgrep.rule_match - DEBUG - match_key = ('\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre }}",\n            precio_base: {{ producto.precio_base if producto.precio_base else producto.precio_final }},\n            precio_final: {{ producto.precio_final }},\n            es_terraza: {{ \'true\' if es_terraza else \'false\' }}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction abrirModalCategoria(categoria) {\n    const modal = document.getElementById(\'modalProductos\');\n    const modalTitle = document.getElementById(\'modalTitle\');\n    const productosGrid = document.getElementById(\'productosGrid\');\n    \n    modalTitle.textContent = categoria;\n    productosGrid.innerHTML = \'\';\n    \n    const productos = productosData[categoria];\n    productos.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card\';\n        productCard.onclick = () => agregarProducto(producto.id, producto.nombre, producto.precio_final);\n        \n        let precioHTML;\n        if (producto.es_terraza && producto.precio_base !== producto.precio_final) {\n            precioHTML = `\n                <div class="price-base">€${producto.precio_base.toFixed(2)}</div>\n                <div class="product-price price-terraza">€${producto.precio_final.toFixed(2)}</div>\n            `;\n        } else {\n            precioHTML = `<div class="product-price">€${producto.precio_final.toFixed(2)}</div>`;\n        }\n        \n        productCard.innerHTML = `\n            <div class="product-name">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n    \n    modal.style.display = \'block\';\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'modalProductos\');\n    modal.style.display = \'none\';\n}\n\nfunction agregarProducto(id, nombre, precio) {\n    // Aquí iría la lógica para agregar el producto al pedido\n    alert(\'Producto añadido: \' + nombre + \' - €\' + precio.toFixed(2));\n    cerrarModal();\n}\n\n// Cerrar modal al hacer clic fuera de él\nwindow.onclick = function(event) {\n    const modal = document.getElementById(\'modalProductos\');\n    if (event.target == modal) {\n        cerrarModal();\n    }\n}\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre }}",\n            precio_base: {{ producto.precio_base if producto.precio_base else producto.precio_final }},\n            precio_final: {{ producto.precio_final }},\n            es_terraza: {{ \'true\' if es_terraza else \'false\' }}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction abrirModalCategoria(categoria) {\n    const modal = document.getElementById(\'modalProductos\');\n    const modalTitle = document.getElementById(\'modalTitle\');\n    const productosGrid = document.getElementById(\'productosGrid\');\n    \n    modalTitle.textContent = categoria;\n    productosGrid.innerHTML = \'\';\n    \n    const productos = productosData[categoria];\n    productos.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card\';\n        productCard.onclick = () => agregarProducto(producto.id, producto.nombre, producto.precio_final);\n        \n        let precioHTML;\n        if (producto.es_terraza && producto.precio_base !== producto.precio_final) {\n            precioHTML = `\n                <div class="price-base">€${producto.precio_base.toFixed(2)}</div>\n                <div class="product-price price-terraza">€${producto.precio_final.toFixed(2)}</div>\n            `;\n        } else {\n            precioHTML = `<div class="product-price">€${producto.precio_final.toFixed(2)}</div>`;\n        }\n        \n        productCard.innerHTML = `\n            <div class="product-name">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n    \n    modal.style.display = \'block\';\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'modalProductos\');\n    modal.style.display = \'none\';\n}\n\nfunction agregarProducto(id, nombre, precio) {\n    // Aquí iría la lógica para agregar el producto al pedido\n    alert(\'Producto añadido: \' + nombre + \' - €\' + precio.toFixed(2));\n    cerrarModal();\n}\n\n// Cerrar modal al hacer clic fuera de él\nwindow.onclick = function(event) {\n    const modal = document.getElementById(\'modalProductos\');\n    if (event.target == modal) {\n        cerrarModal();\n    }\n}\n</script>\n', PosixPath('templates/mesa_pedido.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 9867618fbf11071dbcb16c2f32b31757f69e145168b72cd3402cdd2b10ae143cbd002ec67a8bf8b6dd94c4db8fd6293d49cd0f59ed26c7afdd501c0af1e499c7_0
2025-06-07 16:37:42,750 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/products.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 55569002eab8d37bacc8db41f5dda39ba4cdb7eac0f2520d84047aab0d52a2fcb1b9bc342ce639e374a736700a0db8bec156b976ed7b3ec0fe754b52ece43583_0
2025-06-07 16:37:42,750 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 9b0fec23e6397c4e11bd6ab316f3211a8d683992da59703c51b4d219d2ace3368eada76a76537fb46206b97569bdae4bb90b481fe9022923d293f07f9d29fcb0_0
2025-06-07 16:37:42,751 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 9b0fec23e6397c4e11bd6ab316f3211a8d683992da59703c51b4d219d2ace3368eada76a76537fb46206b97569bdae4bb90b481fe9022923d293f07f9d29fcb0_0
2025-06-07 16:37:42,752 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 9b0fec23e6397c4e11bd6ab316f3211a8d683992da59703c51b4d219d2ace3368eada76a76537fb46206b97569bdae4bb90b481fe9022923d293f07f9d29fcb0_0
2025-06-07 16:37:42,753 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/products.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 55569002eab8d37bacc8db41f5dda39ba4cdb7eac0f2520d84047aab0d52a2fcb1b9bc342ce639e374a736700a0db8bec156b976ed7b3ec0fe754b52ece43583_0
2025-06-07 16:37:42,754 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 9b0fec23e6397c4e11bd6ab316f3211a8d683992da59703c51b4d219d2ace3368eada76a76537fb46206b97569bdae4bb90b481fe9022923d293f07f9d29fcb0_0
2025-06-07 16:37:42,755 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 9b0fec23e6397c4e11bd6ab316f3211a8d683992da59703c51b4d219d2ace3368eada76a76537fb46206b97569bdae4bb90b481fe9022923d293f07f9d29fcb0_0
2025-06-07 16:37:42,756 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 9b0fec23e6397c4e11bd6ab316f3211a8d683992da59703c51b4d219d2ace3368eada76a76537fb46206b97569bdae4bb90b481fe9022923d293f07f9d29fcb0_1
2025-06-07 16:37:42,757 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = aa407f1c1690bdd23562d52572a85b601c6466d7b07d77f2680180b6655983d71bbebeca37cc7a737c47c2764f671bd13afda9b9392a46b20fc386d0d57d7efe_0
2025-06-07 16:37:42,758 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,759 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,760 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,760 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = aa407f1c1690bdd23562d52572a85b601c6466d7b07d77f2680180b6655983d71bbebeca37cc7a737c47c2764f671bd13afda9b9392a46b20fc386d0d57d7efe_0
2025-06-07 16:37:42,761 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,762 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,762 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_1
2025-06-07 16:37:42,763 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = aa407f1c1690bdd23562d52572a85b601c6466d7b07d77f2680180b6655983d71bbebeca37cc7a737c47c2764f671bd13afda9b9392a46b20fc386d0d57d7efe_0
2025-06-07 16:37:42,764 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,764 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,765 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_2
2025-06-07 16:37:42,766 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = aa407f1c1690bdd23562d52572a85b601c6466d7b07d77f2680180b6655983d71bbebeca37cc7a737c47c2764f671bd13afda9b9392a46b20fc386d0d57d7efe_0
2025-06-07 16:37:42,766 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,767 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,770 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_3
2025-06-07 16:37:42,771 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = aa407f1c1690bdd23562d52572a85b601c6466d7b07d77f2680180b6655983d71bbebeca37cc7a737c47c2764f671bd13afda9b9392a46b20fc386d0d57d7efe_0
2025-06-07 16:37:42,771 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,772 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,773 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_4
2025-06-07 16:37:42,773 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = aa407f1c1690bdd23562d52572a85b601c6466d7b07d77f2680180b6655983d71bbebeca37cc7a737c47c2764f671bd13afda9b9392a46b20fc386d0d57d7efe_0
2025-06-07 16:37:42,774 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,775 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_0
2025-06-07 16:37:42,776 - semgrep.rule_match - DEBUG - match_key = ('<button ...> ="..." =\'...\' {{ ... }}', PosixPath('templates/products_tpv.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.unquoted-attribute-var') match_id = 22db68905efe3b165a7050742302055321623d49b2d3b30b3cf6942bd6ddb1d3f1571dc6773b0e84f10c0393b99407f1327f3657a1c0d46c8284646f3da13e30_5
2025-06-07 16:37:42,776 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/qr_menu.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.var-in-href') match_id = 1443ad949124ce07f4f9937e1a607bbda856803e2cb443bd353b4ea6193654b6326259a884d60f3cb722b86819bdc92db90c9c7db7286a9cdf2ccb20b68c008b_0
2025-06-07 16:37:42,777 - semgrep.rule_match - DEBUG - match_key = ('<a ...> href = "/{{ ... }}" href = "{{ ... }}" href = \'{{ ... }}\' href = {{ ... }} href = "{{ url_for(...) ... }}" href = \'/{{ ... }}\' href = \'{{ url_for(...) ... }}\' href = {{ url_for(...) ... }}', PosixPath('templates/qr_menu.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.var-in-href') match_id = 4126e3d5acc9399ad42c0c2fe7a2320577d7cfb7e29dbcefbfe1071bafbc6ccab7173c503d2c37dec59fb2970400174502d995160ff1aa7aedba391e952f250a_0
2025-06-07 16:37:42,778 - semgrep.rule_match - DEBUG - match_key = ('<a ...> href = "/{{ ... }}" href = "{{ ... }}" href = \'{{ ... }}\' href = {{ ... }} href = "{{ url_for(...) ... }}" href = \'/{{ ... }}\' href = \'{{ url_for(...) ... }}\' href = {{ url_for(...) ... }}', PosixPath('templates/qr_menu.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.var-in-href') match_id = 4126e3d5acc9399ad42c0c2fe7a2320577d7cfb7e29dbcefbfe1071bafbc6ccab7173c503d2c37dec59fb2970400174502d995160ff1aa7aedba391e952f250a_0
2025-06-07 16:37:42,779 - semgrep.rule_match - DEBUG - match_key = ('<a ...> href = "/{{ ... }}" href = "{{ ... }}" href = \'{{ ... }}\' href = {{ ... }} href = "{{ url_for(...) ... }}" href = \'/{{ ... }}\' href = \'{{ url_for(...) ... }}\' href = {{ url_for(...) ... }}', PosixPath('templates/qr_menu.html'), 'config..semgrep.vendored-rules.generic.html-templates.security.var-in-href') match_id = 4126e3d5acc9399ad42c0c2fe7a2320577d7cfb7e29dbcefbfe1071bafbc6ccab7173c503d2c37dec59fb2970400174502d995160ff1aa7aedba391e952f250a_0
2025-06-07 16:37:42,780 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/qr_menu.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 37cfb027600ba8bad83aebf0e460bd3039530353d6b44ef94bc7136f0a501705f689b970e7fea58c7a487a0ec7101eba840300ab9fe7536238440555c6c3f0bb_0
2025-06-07 16:37:42,781 - semgrep.rule_match - DEBUG - match_key = ('\nfunction copyUrl() {\n    const urlInput = document.querySelector(\'.url-input\');\n    urlInput.select();\n    urlInput.setSelectionRange(0, 99999);\n    \n    try {\n        document.execCommand(\'copy\');\n        \n        const btn = document.querySelector(\'.btn-copy\');\n        const originalText = btn.innerHTML;\n        btn.innerHTML = \'<i class="fas fa-check"></i> ¡Copiado!\';\n        btn.style.background = \'#28a745\';\n        \n        setTimeout(() => {\n            btn.innerHTML = originalText;\n            btn.style.background = \'\';\n        }, 2000);\n        \n    } catch (err) {\n        alert(\'Error al copiar la URL\');\n    }\n}\n\nfunction printQR() {\n    window.print();\n}\n\nfunction downloadQR() {\n    const img = document.querySelector(\'.qr-image\');\n    const canvas = document.createElement(\'canvas\');\n    const ctx = canvas.getContext(\'2d\');\n    \n    canvas.width = img.naturalWidth;\n    canvas.height = img.naturalHeight;\n    \n    ctx.drawImage(img, 0, 0);\n    \n    const link = document.createElement(\'a\');\n    link.download = \'qr-carta-bar-yedra.png\';\n    link.href = canvas.toDataURL();\n    link.click();\n}\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\nfunction copyUrl() {\n    const urlInput = document.querySelector(\'.url-input\');\n    urlInput.select();\n    urlInput.setSelectionRange(0, 99999);\n    \n    try {\n        document.execCommand(\'copy\');\n        \n        const btn = document.querySelector(\'.btn-copy\');\n        const originalText = btn.innerHTML;\n        btn.innerHTML = \'<i class="fas fa-check"></i> ¡Copiado!\';\n        btn.style.background = \'#28a745\';\n        \n        setTimeout(() => {\n            btn.innerHTML = originalText;\n            btn.style.background = \'\';\n        }, 2000);\n        \n    } catch (err) {\n        alert(\'Error al copiar la URL\');\n    }\n}\n\nfunction printQR() {\n    window.print();\n}\n\nfunction downloadQR() {\n    const img = document.querySelector(\'.qr-image\');\n    const canvas = document.createElement(\'canvas\');\n    const ctx = canvas.getContext(\'2d\');\n    \n    canvas.width = img.naturalWidth;\n    canvas.height = img.naturalHeight;\n    \n    ctx.drawImage(img, 0, 0);\n    \n    const link = document.createElement(\'a\');\n    link.download = \'qr-carta-bar-yedra.png\';\n    link.href = canvas.toDataURL();\n    link.click();\n}\n</script>\n', PosixPath('templates/qr_menu.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 1e5a24fff39a7f91a5b115239d670240308332d027e1267dfc5f8313b37e399a5ec01d0fc6b9bfca8547562b80f3faf7d9aca23e6ba30186b4cba1e8bce80fd6_0
2025-06-07 16:37:42,787 - semgrep.rule_match - DEBUG - match_key = ('\nfunction copyUrl() {\n    const urlInput = document.querySelector(\'.url-input\');\n    urlInput.select();\n    urlInput.setSelectionRange(0, 99999);\n    \n    try {\n        document.execCommand(\'copy\');\n        \n        const btn = document.querySelector(\'.btn-copy\');\n        const originalText = btn.innerHTML;\n        btn.innerHTML = \'<i class="fas fa-check"></i> ¡Copiado!\';\n        btn.style.background = \'#28a745\';\n        \n        setTimeout(() => {\n            btn.innerHTML = originalText;\n            btn.style.background = \'\';\n        }, 2000);\n        \n    } catch (err) {\n        alert(\'Error al copiar la URL\');\n    }\n}\n\nfunction printQR() {\n    window.print();\n}\n\nfunction downloadQR() {\n    const img = document.querySelector(\'.qr-image\');\n    const canvas = document.createElement(\'canvas\');\n    const ctx = canvas.getContext(\'2d\');\n    \n    canvas.width = img.naturalWidth;\n    canvas.height = img.naturalHeight;\n    \n    ctx.drawImage(img, 0, 0);\n    \n    const link = document.createElement(\'a\');\n    link.download = \'qr-carta-bar-yedra.png\';\n    link.href = canvas.toDataURL();\n    link.click();\n}\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\nfunction copyUrl() {\n    const urlInput = document.querySelector(\'.url-input\');\n    urlInput.select();\n    urlInput.setSelectionRange(0, 99999);\n    \n    try {\n        document.execCommand(\'copy\');\n        \n        const btn = document.querySelector(\'.btn-copy\');\n        const originalText = btn.innerHTML;\n        btn.innerHTML = \'<i class="fas fa-check"></i> ¡Copiado!\';\n        btn.style.background = \'#28a745\';\n        \n        setTimeout(() => {\n            btn.innerHTML = originalText;\n            btn.style.background = \'\';\n        }, 2000);\n        \n    } catch (err) {\n        alert(\'Error al copiar la URL\');\n    }\n}\n\nfunction printQR() {\n    window.print();\n}\n\nfunction downloadQR() {\n    const img = document.querySelector(\'.qr-image\');\n    const canvas = document.createElement(\'canvas\');\n    const ctx = canvas.getContext(\'2d\');\n    \n    canvas.width = img.naturalWidth;\n    canvas.height = img.naturalHeight;\n    \n    ctx.drawImage(img, 0, 0);\n    \n    const link = document.createElement(\'a\');\n    link.download = \'qr-carta-bar-yedra.png\';\n    link.href = canvas.toDataURL();\n    link.click();\n}\n</script>\n', PosixPath('templates/qr_menu.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 1e5a24fff39a7f91a5b115239d670240308332d027e1267dfc5f8313b37e399a5ec01d0fc6b9bfca8547562b80f3faf7d9aca23e6ba30186b4cba1e8bce80fd6_0
2025-06-07 16:37:42,788 - semgrep.rule_match - DEBUG - match_key = ('\nfunction copyUrl() {\n    const urlInput = document.querySelector(\'.url-input\');\n    urlInput.select();\n    urlInput.setSelectionRange(0, 99999);\n    \n    try {\n        document.execCommand(\'copy\');\n        \n        const btn = document.querySelector(\'.btn-copy\');\n        const originalText = btn.innerHTML;\n        btn.innerHTML = \'<i class="fas fa-check"></i> ¡Copiado!\';\n        btn.style.background = \'#28a745\';\n        \n        setTimeout(() => {\n            btn.innerHTML = originalText;\n            btn.style.background = \'\';\n        }, 2000);\n        \n    } catch (err) {\n        alert(\'Error al copiar la URL\');\n    }\n}\n\nfunction printQR() {\n    window.print();\n}\n\nfunction downloadQR() {\n    const img = document.querySelector(\'.qr-image\');\n    const canvas = document.createElement(\'canvas\');\n    const ctx = canvas.getContext(\'2d\');\n    \n    canvas.width = img.naturalWidth;\n    canvas.height = img.naturalHeight;\n    \n    ctx.drawImage(img, 0, 0);\n    \n    const link = document.createElement(\'a\');\n    link.download = \'qr-carta-bar-yedra.png\';\n    link.href = canvas.toDataURL();\n    link.click();\n}\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\nfunction copyUrl() {\n    const urlInput = document.querySelector(\'.url-input\');\n    urlInput.select();\n    urlInput.setSelectionRange(0, 99999);\n    \n    try {\n        document.execCommand(\'copy\');\n        \n        const btn = document.querySelector(\'.btn-copy\');\n        const originalText = btn.innerHTML;\n        btn.innerHTML = \'<i class="fas fa-check"></i> ¡Copiado!\';\n        btn.style.background = \'#28a745\';\n        \n        setTimeout(() => {\n            btn.innerHTML = originalText;\n            btn.style.background = \'\';\n        }, 2000);\n        \n    } catch (err) {\n        alert(\'Error al copiar la URL\');\n    }\n}\n\nfunction printQR() {\n    window.print();\n}\n\nfunction downloadQR() {\n    const img = document.querySelector(\'.qr-image\');\n    const canvas = document.createElement(\'canvas\');\n    const ctx = canvas.getContext(\'2d\');\n    \n    canvas.width = img.naturalWidth;\n    canvas.height = img.naturalHeight;\n    \n    ctx.drawImage(img, 0, 0);\n    \n    const link = document.createElement(\'a\');\n    link.download = \'qr-carta-bar-yedra.png\';\n    link.href = canvas.toDataURL();\n    link.click();\n}\n</script>\n', PosixPath('templates/qr_menu.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 1e5a24fff39a7f91a5b115239d670240308332d027e1267dfc5f8313b37e399a5ec01d0fc6b9bfca8547562b80f3faf7d9aca23e6ba30186b4cba1e8bce80fd6_0
2025-06-07 16:37:42,789 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/reports.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 31927f102a4be05b927150bd86683dd29211a29ef98e9b980efdef38cc809b6bcf34bb56333f630f88f0a148da83c16cedc3807b927735f12573d65da381aabb_0
2025-06-07 16:37:42,791 - semgrep.rule_match - DEBUG - match_key = ('\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n    // Añadir efectos de hover y click\n    const exportButtons = document.querySelectorAll(\'.btn-export\');\n    \n    exportButtons.forEach(button => {\n        button.addEventListener(\'click\', function(e) {\n            // Añadir efecto de carga\n            const originalText = this.innerHTML;\n            this.innerHTML = \'<i class="fas fa-spinner fa-spin"></i> Generando...\';\n            this.disabled = true;\n            \n            // Restaurar después de un momento\n            setTimeout(() => {\n                this.innerHTML = originalText;\n                this.disabled = false;\n            }, 2000);\n        });\n    });\n});\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n    // Añadir efectos de hover y click\n    const exportButtons = document.querySelectorAll(\'.btn-export\');\n    \n    exportButtons.forEach(button => {\n        button.addEventListener(\'click\', function(e) {\n            // Añadir efecto de carga\n            const originalText = this.innerHTML;\n            this.innerHTML = \'<i class="fas fa-spinner fa-spin"></i> Generando...\';\n            this.disabled = true;\n            \n            // Restaurar después de un momento\n            setTimeout(() => {\n                this.innerHTML = originalText;\n                this.disabled = false;\n            }, 2000);\n        });\n    });\n});\n</script>\n', PosixPath('templates/reports.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 9162848d0440733be76b38b2b321078c2d0c6cf1b12f0d9393438217acfe5e5f0c46a61ed85f05c3571fa894754eb4164bf04c980a26bfc9292d5defe1b0c5d1_0
2025-06-07 16:37:42,792 - semgrep.rule_match - DEBUG - match_key = ('\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n    // Añadir efectos de hover y click\n    const exportButtons = document.querySelectorAll(\'.btn-export\');\n    \n    exportButtons.forEach(button => {\n        button.addEventListener(\'click\', function(e) {\n            // Añadir efecto de carga\n            const originalText = this.innerHTML;\n            this.innerHTML = \'<i class="fas fa-spinner fa-spin"></i> Generando...\';\n            this.disabled = true;\n            \n            // Restaurar después de un momento\n            setTimeout(() => {\n                this.innerHTML = originalText;\n                this.disabled = false;\n            }, 2000);\n        });\n    });\n});\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n    // Añadir efectos de hover y click\n    const exportButtons = document.querySelectorAll(\'.btn-export\');\n    \n    exportButtons.forEach(button => {\n        button.addEventListener(\'click\', function(e) {\n            // Añadir efecto de carga\n            const originalText = this.innerHTML;\n            this.innerHTML = \'<i class="fas fa-spinner fa-spin"></i> Generando...\';\n            this.disabled = true;\n            \n            // Restaurar después de un momento\n            setTimeout(() => {\n                this.innerHTML = originalText;\n                this.disabled = false;\n            }, 2000);\n        });\n    });\n});\n</script>\n', PosixPath('templates/reports.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 9162848d0440733be76b38b2b321078c2d0c6cf1b12f0d9393438217acfe5e5f0c46a61ed85f05c3571fa894754eb4164bf04c980a26bfc9292d5defe1b0c5d1_0
2025-06-07 16:37:42,793 - semgrep.rule_match - DEBUG - match_key = ('\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n    // Añadir efectos de hover y click\n    const exportButtons = document.querySelectorAll(\'.btn-export\');\n    \n    exportButtons.forEach(button => {\n        button.addEventListener(\'click\', function(e) {\n            // Añadir efecto de carga\n            const originalText = this.innerHTML;\n            this.innerHTML = \'<i class="fas fa-spinner fa-spin"></i> Generando...\';\n            this.disabled = true;\n            \n            // Restaurar después de un momento\n            setTimeout(() => {\n                this.innerHTML = originalText;\n                this.disabled = false;\n            }, 2000);\n        });\n    });\n});\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n    // Añadir efectos de hover y click\n    const exportButtons = document.querySelectorAll(\'.btn-export\');\n    \n    exportButtons.forEach(button => {\n        button.addEventListener(\'click\', function(e) {\n            // Añadir efecto de carga\n            const originalText = this.innerHTML;\n            this.innerHTML = \'<i class="fas fa-spinner fa-spin"></i> Generando...\';\n            this.disabled = true;\n            \n            // Restaurar después de un momento\n            setTimeout(() => {\n                this.innerHTML = originalText;\n                this.disabled = false;\n            }, 2000);\n        });\n    });\n});\n</script>\n', PosixPath('templates/reports.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 9162848d0440733be76b38b2b321078c2d0c6cf1b12f0d9393438217acfe5e5f0c46a61ed85f05c3571fa894754eb4164bf04c980a26bfc9292d5defe1b0c5d1_0
2025-06-07 16:37:42,804 - semgrep.rule_match - DEBUG - match_key = ('', PosixPath('templates/table_detail.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 05f803c786105f8ddd0a3c9d7c64cb316e41407e45167456e325c3425827273326b7e9e696100b75520b4ba12131d6c806f688fe8e8c183ecf646cec9a3d97f2_0
2025-06-07 16:37:42,817 - semgrep.rule_match - DEBUG - match_key = ('\nfunction toggleCategory(categoria) {\n    const container = document.getElementById(`products-${categoria}`);\n    const categoryCard = document.querySelector(`[data-categoria="${categoria}"]`);\n    const allCards = document.querySelectorAll(\'.category-card\');\n    const allContainers = document.querySelectorAll(\'.products-expanded-container\');\n    \n    allCards.forEach(card => {\n        if (card.dataset.categoria !== categoria) {\n            card.classList.remove(\'expanded\');\n        }\n    });\n    allContainers.forEach(cont => {\n        if (cont.id !== `products-${categoria}`) {\n            cont.style.display = \'none\';\n        }\n    });\n    \n    if (container.style.display === \'none\' || container.style.display === \'\') {\n        container.style.display = \'block\';\n        categoryCard.classList.add(\'expanded\');\n        setTimeout(() => {\n            container.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\n        }, 100);\n    } else {\n        container.style.display = \'none\';\n        categoryCard.classList.remove(\'expanded\');\n    }\n}\n\nfunction addToOrderWithAnimation(productCard, mesaId, productoId) {\n    // Add selection animation\n    productCard.classList.add(\'selected\');\n    \n    // Create floating feedback bubble\n    const feedback = document.createElement(\'div\');\n    feedback.className = \'feedback-bubble\';\n    feedback.textContent = \'✓ Added!\';\n    \n    // Ensure product card has relative positioning\n    productCard.style.position = \'relative\';\n    productCard.appendChild(feedback);\n    \n    // Create ripple effect\n    const ripple = document.createElement(\'div\');\n    ripple.style.cssText = `\n        position: absolute;\n        border-radius: 50%;\n        background: rgba(76, 175, 80, 0.3);\n        width: 30px;\n        height: 30px;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%) scale(0);\n        animation: ripple 0.6s linear;\n        pointer-events: none;\n        z-index: 999;\n    `;\n    productCard.appendChild(ripple);\n    \n    // Cleanup animations\n    setTimeout(() => {\n        if (feedback.parentNode) feedback.parentNode.removeChild(feedback);\n        if (ripple.parentNode) ripple.parentNode.removeChild(ripple);\n        productCard.classList.remove(\'selected\');\n    }, 1200);\n    \n    // Call original function\n    addToOrder(mesaId, productoId);\n}\n\nfunction addToOrder(mesaId, productoId) {\n    // Usar AJAX para añadir producto sin recargar la página\n    const formData = new FormData();\n    formData.append(\'mesa_id\', mesaId);\n    formData.append(\'producto_id\', productoId);\n    formData.append(\'cantidad\', 1);\n    \n    fetch(\'/add_to_order\', {\n        method: \'POST\',\n        body: formData\n    })\n    .then(response => {\n        if (response.ok) {\n            // Actualizar el panel de pedido sin cerrar el modal\n            updateOrderPanel(mesaId);\n        } else {\n            console.error(\'Error al añadir producto\');\n        }\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n    });\n}\n\nfunction updateOrderPanel(mesaId) {\n    // Actualizar usando AJAX más simple\n    fetch(`/table/${mesaId}`)\n    .then(response => {\n        if (!response.ok) throw new Error(\'Network error\');\n        return response.text();\n    })\n    .then(html => {\n        // Actualizar página completa después de un pequeño delay\n        setTimeout(() => {\n            location.reload();\n        }, 500);\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n        // Si falla, recargar página\n        location.reload();\n    });\n}\n\nfunction closeOrder(mesaId) {\n    if (confirm(\'¿Cerrar pedido y marcar mesa lista para pagar?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/close_order/\' + mesaId;\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction payOrder(mesaId, method) {\n    if (confirm(`¿Confirmar pago con ${method}?`)) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/pay_order/\' + mesaId;\n        \n        const methodInput = document.createElement(\'input\');\n        methodInput.type = \'hidden\';\n        methodInput.name = \'forma_pago\';\n        methodInput.value = method;\n        \n        form.appendChild(methodInput);\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction updateQuantity(mesaId, productoId, newQuantity) {\n    if (newQuantity <= 0) {\n        removeFromOrder(mesaId, productoId);\n        return;\n    }\n    \n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/update_quantity\';\n    \n    const mesaInput = document.createElement(\'input\');\n    mesaInput.type = \'hidden\';\n    mesaInput.name = \'mesa_id\';\n    mesaInput.value = mesaId;\n    \n    const productoInput = document.createElement(\'input\');\n    productoInput.type = \'hidden\';\n    productoInput.name = \'producto_id\';\n    productoInput.value = productoId;\n    \n    const cantidadInput = document.createElement(\'input\');\n    cantidadInput.type = \'hidden\';\n    cantidadInput.name = \'cantidad\';\n    cantidadInput.value = newQuantity;\n    \n    form.appendChild(mesaInput);\n    form.appendChild(productoInput);\n    form.appendChild(cantidadInput);\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction removeFromOrder(mesaId, productoId) {\n    if (confirm(\'¿Eliminar este producto del pedido?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/remove_from_order\';\n        \n        const mesaInput = document.createElement(\'input\');\n        mesaInput.type = \'hidden\';\n        mesaInput.name = \'mesa_id\';\n        mesaInput.value = mesaId;\n        \n        const productoInput = document.createElement(\'input\');\n        productoInput.type = \'hidden\';\n        productoInput.name = \'producto_id\';\n        productoInput.value = productoId;\n        \n        form.appendChild(mesaInput);\n        form.appendChild(productoInput);\n        \n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction showPaymentOptions(mesaId) {\n    // Mostrar modal de selección de pago inmediatamente\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'block\';\n        // Añadir clase para animación suave\n        modal.classList.add(\'show\');\n    }\n}\n\nfunction hidePaymentOptions(mesaId) {\n    // Ocultar modal de selección de pago\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'none\';\n        modal.classList.remove(\'show\');\n    }\n}\n\n// Datos de productos para el modal\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre|e }}",\n            precio: {{ producto.precio|float }},\n            descripcion: "{{ producto.descripcion|e|default(\'\') }}",\n            foto_url: "{{ producto.foto_url|default(\'\') }}",\n            sin_suplemento_terraza: {{ \'true\' if producto.sin_suplemento_terraza else \'false\' }}{% if es_terraza %},\n            precio_con_suplemento: {% if producto.sin_suplemento_terraza %}{{ producto.precio|float }}{% else %}{{ (producto.precio|float + suplemento_terraza|float)|round(2) }}{% endif %}{% endif %}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction openCategoryModal(categoria) {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    if (!modal || !modalTitle || !productosGrid) {\n        console.error(\'Modal elements not found\');\n        return;\n    }\n    \n    // Mostrar modal inmediatamente\n    modal.style.display = \'block\';\n    modalTitle.textContent = categoria;\n    \n    try {\n        // Si es cervezas, mostrar subcategorías primero\n        if (categoria === \'Cervezas\') {\n            showBeerSubcategories();\n            return;\n        }\n        \n        // Si es bocadillos, mostrar subcategorías\n        if (categoria === \'Bocadillos\') {\n            showBocadillosSubcategories();\n            return;\n        }\n        \n        // Si es raciones, mostrar subcategorías\n        if (categoria === \'Raciones\') {\n            showRacionesSubcategories();\n            return;\n        }\n        \n        productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">Cargando productos...</div>\';\n        \n        const productos = productosData[categoria];\n        if (!productos || productos.length === 0) {\n            productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">No hay productos en esta categoría</div>\';\n            return;\n        }\n        \n        // Limpiar y cargar productos\n        productosGrid.innerHTML = \'\';\n        \n        productos.forEach(producto => {\n            const productCard = document.createElement(\'div\');\n            productCard.className = \'product-card-modal\';\n            productCard.addEventListener(\'click\', function() {\n                addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n                // El modal permanece abierto para seguir agregando productos\n            });\n            \n            let precioHTML = \'\';\n            {% if es_terraza %}\n            if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n                precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                           \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n            } else {\n                precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            }\n            {% else %}\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            {% endif %}\n            \n            let imagenHTML = \'<div class="product-image-space" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 1px solid #e0e0e0; flex-shrink: 0;">📦</div>\';\n            if (producto.foto_url && producto.foto_url !== \'\') {\n                imagenHTML = \'<img src="\' + producto.foto_url + \'" alt="\' + producto.nombre + \'" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; object-fit: cover; background: #f5f5f5; padding: 0px; border: 1px solid #4CAF50; display: block; flex-shrink: 0;">\';\n            }\n            \n            productCard.innerHTML = imagenHTML + \'<div class="product-name-modal">\' + producto.nombre + \'</div>\' + precioHTML;\n            \n            productosGrid.appendChild(productCard);\n        });\n        \n        modal.style.display = \'block\';\n        \n    } catch (error) {\n        console.error(\'Error opening category modal:\', error);\n    }\n}\n\nfunction closeCategoryModal() {\n    const modal = document.getElementById(\'categoryModal\');\n    modal.style.display = \'none\';\n}\n\nfunction showBeerSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Cervezas - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const nacionalesBtn = document.createElement(\'div\');\n    nacionalesBtn.className = \'subcategory-button\';\n    nacionalesBtn.innerHTML = `\n        <div class="subcategory-icon">🍺</div>\n        <div class="subcategory-name">Cervezas Nacionales</div>\n        <div class="subcategory-count">${countBeersByType(\'nacionales\')}</div>\n    `;\n    nacionalesBtn.onclick = () => showBeerProducts(\'nacionales\');\n    \n    const importacionBtn = document.createElement(\'div\');\n    importacionBtn.className = \'subcategory-button\';\n    importacionBtn.innerHTML = `\n        <div class="subcategory-icon">🍻</div>\n        <div class="subcategory-name">Cervezas de Importación</div>\n        <div class="subcategory-count">${countBeersByType(\'importación\')}</div>\n    `;\n    importacionBtn.onclick = () => showBeerProducts(\'importación\');\n    \n    productosGrid.appendChild(nacionalesBtn);\n    productosGrid.appendChild(importacionBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBeersByType(tipo) {\n    const cervezas = productosData[\'Cervezas\'] || [];\n    return cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    }).length;\n}\n\nfunction showBeerProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = tipo === \'nacionales\' ? \'Cervezas Nacionales\' : \'Cervezas de Importación\';\n    productosGrid.innerHTML = \'\';\n    \n    const cervezas = productosData[\'Cervezas\'] || [];\n    const cervezasFiltradas = cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    });\n    \n    cervezasFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🍺</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showBocadillosSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Bocadillos - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const pinchosMontadosBtn = document.createElement(\'div\');\n    pinchosMontadosBtn.className = \'subcategory-button\';\n    pinchosMontadosBtn.innerHTML = `\n        <div class="subcategory-icon">🥪</div>\n        <div class="subcategory-name">Pinchos y Montados</div>\n        <div class="subcategory-count">${countBocadillosByType(\'pinchos y montados\')}</div>\n    `;\n    pinchosMontadosBtn.onclick = () => showBocadillosProducts(\'pinchos y montados\');\n    \n    const bocadillosFriosBtn = document.createElement(\'div\');\n    bocadillosFriosBtn.className = \'subcategory-button\';\n    bocadillosFriosBtn.innerHTML = `\n        <div class="subcategory-icon">🥖</div>\n        <div class="subcategory-name">Bocadillos Fríos</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos fríos\')}</div>\n    `;\n    bocadillosFriosBtn.onclick = () => showBocadillosProducts(\'bocadillos fríos\');\n    \n    const bocadillosCalientesBtn = document.createElement(\'div\');\n    bocadillosCalientesBtn.className = \'subcategory-button\';\n    bocadillosCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🌭</div>\n        <div class="subcategory-name">Bocadillos Calientes</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos calientes\')}</div>\n    `;\n    bocadillosCalientesBtn.onclick = () => showBocadillosProducts(\'bocadillos calientes\');\n    \n    productosGrid.appendChild(pinchosMontadosBtn);\n    productosGrid.appendChild(bocadillosFriosBtn);\n    productosGrid.appendChild(bocadillosCalientesBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction showRacionesSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Raciones - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const racionesCalientesBtn = document.createElement(\'div\');\n    racionesCalientesBtn.className = \'subcategory-button\';\n    racionesCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🍳</div>\n        <div class="subcategory-name">Raciones Calientes</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones calientes\')}</div>\n    `;\n    racionesCalientesBtn.onclick = () => showRacionesProducts(\'raciones calientes\');\n    \n    const racionesFriasBtn = document.createElement(\'div\');\n    racionesFriasBtn.className = \'subcategory-button\';\n    racionesFriasBtn.innerHTML = `\n        <div class="subcategory-icon">🥗</div>\n        <div class="subcategory-name">Raciones Frías</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones frías\')}</div>\n    `;\n    racionesFriasBtn.onclick = () => showRacionesProducts(\'raciones frías\');\n    \n    productosGrid.appendChild(racionesCalientesBtn);\n    productosGrid.appendChild(racionesFriasBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBocadillosByType(tipo) {\n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    return bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction countRacionesByType(tipo) {\n    const raciones = productosData[\'Raciones\'] || [];\n    return raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction showBocadillosProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    const bocadillosFiltrados = bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    bocadillosFiltrados.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🥪</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showRacionesProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const raciones = productosData[\'Raciones\'] || [];\n    const racionesFiltradas = raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    racionesFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        productCard.innerHTML = `\n            <div class="product-image-space">🍽️</div>\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\n// Calculadora de cambio - versión final funcional\nlet totalDelPedido = 0;\n\nfunction abrirModalPago() {\n    console.log(\'Abriendo modal de pago\');\n    \n    // Obtener total del pedido\n    totalDelPedido = obtenerTotal();\n    console.log(\'Total calculado:\', totalDelPedido);\n    \n    // Mostrar total\n    const elementoTotal = document.getElementById(\'totalAmount\');\n    if (elementoTotal) {\n        elementoTotal.textContent = \'€\' + totalDelPedido.toFixed(2);\n    }\n    \n    // Ocultar calculadora\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n    \n    // Mostrar modal\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'flex\';\n}\n\nfunction seleccionarEfectivo() {\n    console.log(\'Efectivo seleccionado\');\n    \n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) {\n        calc.style.display = \'block\';\n        \n        // Limpiar campos\n        const input = document.getElementById(\'cashReceived\');\n        const cambio = document.getElementById(\'changeAmount\');\n        const btn = document.getElementById(\'confirmCashBtn\');\n        \n        if (input) input.value = \'\';\n        if (cambio) cambio.textContent = \'€0.00\';\n        if (btn) btn.disabled = true;\n        \n        // Enfocar\n        setTimeout(() => {\n            if (input) input.focus();\n        }, 100);\n    }\n}\n\nfunction seleccionarTarjeta() {\n    console.log(\'Tarjeta seleccionada\');\n    if (confirm(\'¿Confirmar pago con tarjeta por €\' + totalDelPedido.toFixed(2) + \'?\')) {\n        enviarPago(\'tarjeta\');\n    }\n}\n\nfunction calcularCambio() {\n    console.log(\'Función calcularCambio ejecutada\');\n    \n    const input = document.getElementById(\'cashReceived\');\n    const cambio = document.getElementById(\'changeAmount\');\n    const btn = document.getElementById(\'confirmCashBtn\');\n    \n    console.log(\'Elementos encontrados:\', {input, cambio, btn});\n    \n    if (!input || !cambio || !btn) {\n        console.log(\'ERROR: No se encontraron todos los elementos\');\n        return;\n    }\n    \n    const recibido = parseFloat(input.value) || 0;\n    const diferencia = recibido - totalDelPedido;\n    \n    console.log(\'Cálculo:\', {recibido, totalDelPedido, diferencia});\n    \n    if (diferencia < 0) {\n        cambio.textContent = \'€\' + Math.abs(diferencia).toFixed(2) + \' (Falta)\';\n        cambio.style.color = \'red\';\n        btn.disabled = true;\n        console.log(\'Dinero insuficiente - botón deshabilitado\');\n    } else {\n        cambio.textContent = \'€\' + diferencia.toFixed(2);\n        cambio.style.color = \'green\';\n        btn.disabled = false;\n        console.log(\'Dinero suficiente - botón habilitado\');\n    }\n}\n\nfunction confirmarPagoEfectivo() {\n    const input = document.getElementById(\'cashReceived\');\n    if (input) {\n        const recibido = parseFloat(input.value) || 0;\n        if (recibido >= totalDelPedido) {\n            enviarPago(\'efectivo\', recibido);\n        }\n    }\n}\n\nfunction enviarPago(metodo, dinero = null) {\n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/pay_order/{{ mesa.id }}\';\n    \n    const inputMetodo = document.createElement(\'input\');\n    inputMetodo.type = \'hidden\';\n    inputMetodo.name = \'forma_pago\';\n    inputMetodo.value = metodo;\n    form.appendChild(inputMetodo);\n    \n    if (metodo === \'efectivo\' && dinero) {\n        const inputDinero = document.createElement(\'input\');\n        inputDinero.type = \'hidden\';\n        inputDinero.name = \'dinero_recibido\';\n        inputDinero.value = dinero.toFixed(2);\n        form.appendChild(inputDinero);\n        \n        const inputCambio = document.createElement(\'input\');\n        inputCambio.type = \'hidden\';\n        inputCambio.name = \'cambio\';\n        inputCambio.value = (dinero - totalDelPedido).toFixed(2);\n        form.appendChild(inputCambio);\n    }\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction obtenerTotal() {\n    // Buscar en resumen\n    const resumen = document.querySelector(\'.summary-value\');\n    if (resumen) {\n        const texto = resumen.textContent.replace(\'€\', \'\').replace(\',\', \'.\');\n        return parseFloat(texto) || 0;\n    }\n    \n    // Calcular desde items\n    let total = 0;\n    const items = document.querySelectorAll(\'.order-item\');\n    items.forEach(item => {\n        const precio = item.querySelector(\'.item-price\');\n        const cantidad = item.querySelector(\'.quantity\');\n        if (precio && cantidad) {\n            const p = parseFloat(precio.textContent.replace(\'€\', \'\')) || 0;\n            const c = parseInt(cantidad.textContent) || 0;\n            total += p * c;\n        }\n    });\n    \n    return total;\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'none\';\n}\n\nfunction ocultarCalculadora() {\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n}\n\n\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\nfunction toggleCategory(categoria) {\n    const container = document.getElementById(`products-${categoria}`);\n    const categoryCard = document.querySelector(`[data-categoria="${categoria}"]`);\n    const allCards = document.querySelectorAll(\'.category-card\');\n    const allContainers = document.querySelectorAll(\'.products-expanded-container\');\n    \n    allCards.forEach(card => {\n        if (card.dataset.categoria !== categoria) {\n            card.classList.remove(\'expanded\');\n        }\n    });\n    allContainers.forEach(cont => {\n        if (cont.id !== `products-${categoria}`) {\n            cont.style.display = \'none\';\n        }\n    });\n    \n    if (container.style.display === \'none\' || container.style.display === \'\') {\n        container.style.display = \'block\';\n        categoryCard.classList.add(\'expanded\');\n        setTimeout(() => {\n            container.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\n        }, 100);\n    } else {\n        container.style.display = \'none\';\n        categoryCard.classList.remove(\'expanded\');\n    }\n}\n\nfunction addToOrderWithAnimation(productCard, mesaId, productoId) {\n    // Add selection animation\n    productCard.classList.add(\'selected\');\n    \n    // Create floating feedback bubble\n    const feedback = document.createElement(\'div\');\n    feedback.className = \'feedback-bubble\';\n    feedback.textContent = \'✓ Added!\';\n    \n    // Ensure product card has relative positioning\n    productCard.style.position = \'relative\';\n    productCard.appendChild(feedback);\n    \n    // Create ripple effect\n    const ripple = document.createElement(\'div\');\n    ripple.style.cssText = `\n        position: absolute;\n        border-radius: 50%;\n        background: rgba(76, 175, 80, 0.3);\n        width: 30px;\n        height: 30px;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%) scale(0);\n        animation: ripple 0.6s linear;\n        pointer-events: none;\n        z-index: 999;\n    `;\n    productCard.appendChild(ripple);\n    \n    // Cleanup animations\n    setTimeout(() => {\n        if (feedback.parentNode) feedback.parentNode.removeChild(feedback);\n        if (ripple.parentNode) ripple.parentNode.removeChild(ripple);\n        productCard.classList.remove(\'selected\');\n    }, 1200);\n    \n    // Call original function\n    addToOrder(mesaId, productoId);\n}\n\nfunction addToOrder(mesaId, productoId) {\n    // Usar AJAX para añadir producto sin recargar la página\n    const formData = new FormData();\n    formData.append(\'mesa_id\', mesaId);\n    formData.append(\'producto_id\', productoId);\n    formData.append(\'cantidad\', 1);\n    \n    fetch(\'/add_to_order\', {\n        method: \'POST\',\n        body: formData\n    })\n    .then(response => {\n        if (response.ok) {\n            // Actualizar el panel de pedido sin cerrar el modal\n            updateOrderPanel(mesaId);\n        } else {\n            console.error(\'Error al añadir producto\');\n        }\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n    });\n}\n\nfunction updateOrderPanel(mesaId) {\n    // Actualizar usando AJAX más simple\n    fetch(`/table/${mesaId}`)\n    .then(response => {\n        if (!response.ok) throw new Error(\'Network error\');\n        return response.text();\n    })\n    .then(html => {\n        // Actualizar página completa después de un pequeño delay\n        setTimeout(() => {\n            location.reload();\n        }, 500);\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n        // Si falla, recargar página\n        location.reload();\n    });\n}\n\nfunction closeOrder(mesaId) {\n    if (confirm(\'¿Cerrar pedido y marcar mesa lista para pagar?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/close_order/\' + mesaId;\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction payOrder(mesaId, method) {\n    if (confirm(`¿Confirmar pago con ${method}?`)) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/pay_order/\' + mesaId;\n        \n        const methodInput = document.createElement(\'input\');\n        methodInput.type = \'hidden\';\n        methodInput.name = \'forma_pago\';\n        methodInput.value = method;\n        \n        form.appendChild(methodInput);\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction updateQuantity(mesaId, productoId, newQuantity) {\n    if (newQuantity <= 0) {\n        removeFromOrder(mesaId, productoId);\n        return;\n    }\n    \n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/update_quantity\';\n    \n    const mesaInput = document.createElement(\'input\');\n    mesaInput.type = \'hidden\';\n    mesaInput.name = \'mesa_id\';\n    mesaInput.value = mesaId;\n    \n    const productoInput = document.createElement(\'input\');\n    productoInput.type = \'hidden\';\n    productoInput.name = \'producto_id\';\n    productoInput.value = productoId;\n    \n    const cantidadInput = document.createElement(\'input\');\n    cantidadInput.type = \'hidden\';\n    cantidadInput.name = \'cantidad\';\n    cantidadInput.value = newQuantity;\n    \n    form.appendChild(mesaInput);\n    form.appendChild(productoInput);\n    form.appendChild(cantidadInput);\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction removeFromOrder(mesaId, productoId) {\n    if (confirm(\'¿Eliminar este producto del pedido?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/remove_from_order\';\n        \n        const mesaInput = document.createElement(\'input\');\n        mesaInput.type = \'hidden\';\n        mesaInput.name = \'mesa_id\';\n        mesaInput.value = mesaId;\n        \n        const productoInput = document.createElement(\'input\');\n        productoInput.type = \'hidden\';\n        productoInput.name = \'producto_id\';\n        productoInput.value = productoId;\n        \n        form.appendChild(mesaInput);\n        form.appendChild(productoInput);\n        \n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction showPaymentOptions(mesaId) {\n    // Mostrar modal de selección de pago inmediatamente\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'block\';\n        // Añadir clase para animación suave\n        modal.classList.add(\'show\');\n    }\n}\n\nfunction hidePaymentOptions(mesaId) {\n    // Ocultar modal de selección de pago\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'none\';\n        modal.classList.remove(\'show\');\n    }\n}\n\n// Datos de productos para el modal\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre|e }}",\n            precio: {{ producto.precio|float }},\n            descripcion: "{{ producto.descripcion|e|default(\'\') }}",\n            foto_url: "{{ producto.foto_url|default(\'\') }}",\n            sin_suplemento_terraza: {{ \'true\' if producto.sin_suplemento_terraza else \'false\' }}{% if es_terraza %},\n            precio_con_suplemento: {% if producto.sin_suplemento_terraza %}{{ producto.precio|float }}{% else %}{{ (producto.precio|float + suplemento_terraza|float)|round(2) }}{% endif %}{% endif %}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction openCategoryModal(categoria) {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    if (!modal || !modalTitle || !productosGrid) {\n        console.error(\'Modal elements not found\');\n        return;\n    }\n    \n    // Mostrar modal inmediatamente\n    modal.style.display = \'block\';\n    modalTitle.textContent = categoria;\n    \n    try {\n        // Si es cervezas, mostrar subcategorías primero\n        if (categoria === \'Cervezas\') {\n            showBeerSubcategories();\n            return;\n        }\n        \n        // Si es bocadillos, mostrar subcategorías\n        if (categoria === \'Bocadillos\') {\n            showBocadillosSubcategories();\n            return;\n        }\n        \n        // Si es raciones, mostrar subcategorías\n        if (categoria === \'Raciones\') {\n            showRacionesSubcategories();\n            return;\n        }\n        \n        productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">Cargando productos...</div>\';\n        \n        const productos = productosData[categoria];\n        if (!productos || productos.length === 0) {\n            productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">No hay productos en esta categoría</div>\';\n            return;\n        }\n        \n        // Limpiar y cargar productos\n        productosGrid.innerHTML = \'\';\n        \n        productos.forEach(producto => {\n            const productCard = document.createElement(\'div\');\n            productCard.className = \'product-card-modal\';\n            productCard.addEventListener(\'click\', function() {\n                addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n                // El modal permanece abierto para seguir agregando productos\n            });\n            \n            let precioHTML = \'\';\n            {% if es_terraza %}\n            if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n                precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                           \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n            } else {\n                precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            }\n            {% else %}\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            {% endif %}\n            \n            let imagenHTML = \'<div class="product-image-space" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 1px solid #e0e0e0; flex-shrink: 0;">📦</div>\';\n            if (producto.foto_url && producto.foto_url !== \'\') {\n                imagenHTML = \'<img src="\' + producto.foto_url + \'" alt="\' + producto.nombre + \'" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; object-fit: cover; background: #f5f5f5; padding: 0px; border: 1px solid #4CAF50; display: block; flex-shrink: 0;">\';\n            }\n            \n            productCard.innerHTML = imagenHTML + \'<div class="product-name-modal">\' + producto.nombre + \'</div>\' + precioHTML;\n            \n            productosGrid.appendChild(productCard);\n        });\n        \n        modal.style.display = \'block\';\n        \n    } catch (error) {\n        console.error(\'Error opening category modal:\', error);\n    }\n}\n\nfunction closeCategoryModal() {\n    const modal = document.getElementById(\'categoryModal\');\n    modal.style.display = \'none\';\n}\n\nfunction showBeerSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Cervezas - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const nacionalesBtn = document.createElement(\'div\');\n    nacionalesBtn.className = \'subcategory-button\';\n    nacionalesBtn.innerHTML = `\n        <div class="subcategory-icon">🍺</div>\n        <div class="subcategory-name">Cervezas Nacionales</div>\n        <div class="subcategory-count">${countBeersByType(\'nacionales\')}</div>\n    `;\n    nacionalesBtn.onclick = () => showBeerProducts(\'nacionales\');\n    \n    const importacionBtn = document.createElement(\'div\');\n    importacionBtn.className = \'subcategory-button\';\n    importacionBtn.innerHTML = `\n        <div class="subcategory-icon">🍻</div>\n        <div class="subcategory-name">Cervezas de Importación</div>\n        <div class="subcategory-count">${countBeersByType(\'importación\')}</div>\n    `;\n    importacionBtn.onclick = () => showBeerProducts(\'importación\');\n    \n    productosGrid.appendChild(nacionalesBtn);\n    productosGrid.appendChild(importacionBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBeersByType(tipo) {\n    const cervezas = productosData[\'Cervezas\'] || [];\n    return cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    }).length;\n}\n\nfunction showBeerProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = tipo === \'nacionales\' ? \'Cervezas Nacionales\' : \'Cervezas de Importación\';\n    productosGrid.innerHTML = \'\';\n    \n    const cervezas = productosData[\'Cervezas\'] || [];\n    const cervezasFiltradas = cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    });\n    \n    cervezasFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🍺</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showBocadillosSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Bocadillos - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const pinchosMontadosBtn = document.createElement(\'div\');\n    pinchosMontadosBtn.className = \'subcategory-button\';\n    pinchosMontadosBtn.innerHTML = `\n        <div class="subcategory-icon">🥪</div>\n        <div class="subcategory-name">Pinchos y Montados</div>\n        <div class="subcategory-count">${countBocadillosByType(\'pinchos y montados\')}</div>\n    `;\n    pinchosMontadosBtn.onclick = () => showBocadillosProducts(\'pinchos y montados\');\n    \n    const bocadillosFriosBtn = document.createElement(\'div\');\n    bocadillosFriosBtn.className = \'subcategory-button\';\n    bocadillosFriosBtn.innerHTML = `\n        <div class="subcategory-icon">🥖</div>\n        <div class="subcategory-name">Bocadillos Fríos</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos fríos\')}</div>\n    `;\n    bocadillosFriosBtn.onclick = () => showBocadillosProducts(\'bocadillos fríos\');\n    \n    const bocadillosCalientesBtn = document.createElement(\'div\');\n    bocadillosCalientesBtn.className = \'subcategory-button\';\n    bocadillosCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🌭</div>\n        <div class="subcategory-name">Bocadillos Calientes</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos calientes\')}</div>\n    `;\n    bocadillosCalientesBtn.onclick = () => showBocadillosProducts(\'bocadillos calientes\');\n    \n    productosGrid.appendChild(pinchosMontadosBtn);\n    productosGrid.appendChild(bocadillosFriosBtn);\n    productosGrid.appendChild(bocadillosCalientesBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction showRacionesSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Raciones - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const racionesCalientesBtn = document.createElement(\'div\');\n    racionesCalientesBtn.className = \'subcategory-button\';\n    racionesCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🍳</div>\n        <div class="subcategory-name">Raciones Calientes</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones calientes\')}</div>\n    `;\n    racionesCalientesBtn.onclick = () => showRacionesProducts(\'raciones calientes\');\n    \n    const racionesFriasBtn = document.createElement(\'div\');\n    racionesFriasBtn.className = \'subcategory-button\';\n    racionesFriasBtn.innerHTML = `\n        <div class="subcategory-icon">🥗</div>\n        <div class="subcategory-name">Raciones Frías</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones frías\')}</div>\n    `;\n    racionesFriasBtn.onclick = () => showRacionesProducts(\'raciones frías\');\n    \n    productosGrid.appendChild(racionesCalientesBtn);\n    productosGrid.appendChild(racionesFriasBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBocadillosByType(tipo) {\n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    return bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction countRacionesByType(tipo) {\n    const raciones = productosData[\'Raciones\'] || [];\n    return raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction showBocadillosProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    const bocadillosFiltrados = bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    bocadillosFiltrados.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🥪</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showRacionesProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const raciones = productosData[\'Raciones\'] || [];\n    const racionesFiltradas = raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    racionesFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        productCard.innerHTML = `\n            <div class="product-image-space">🍽️</div>\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\n// Calculadora de cambio - versión final funcional\nlet totalDelPedido = 0;\n\nfunction abrirModalPago() {\n    console.log(\'Abriendo modal de pago\');\n    \n    // Obtener total del pedido\n    totalDelPedido = obtenerTotal();\n    console.log(\'Total calculado:\', totalDelPedido);\n    \n    // Mostrar total\n    const elementoTotal = document.getElementById(\'totalAmount\');\n    if (elementoTotal) {\n        elementoTotal.textContent = \'€\' + totalDelPedido.toFixed(2);\n    }\n    \n    // Ocultar calculadora\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n    \n    // Mostrar modal\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'flex\';\n}\n\nfunction seleccionarEfectivo() {\n    console.log(\'Efectivo seleccionado\');\n    \n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) {\n        calc.style.display = \'block\';\n        \n        // Limpiar campos\n        const input = document.getElementById(\'cashReceived\');\n        const cambio = document.getElementById(\'changeAmount\');\n        const btn = document.getElementById(\'confirmCashBtn\');\n        \n        if (input) input.value = \'\';\n        if (cambio) cambio.textContent = \'€0.00\';\n        if (btn) btn.disabled = true;\n        \n        // Enfocar\n        setTimeout(() => {\n            if (input) input.focus();\n        }, 100);\n    }\n}\n\nfunction seleccionarTarjeta() {\n    console.log(\'Tarjeta seleccionada\');\n    if (confirm(\'¿Confirmar pago con tarjeta por €\' + totalDelPedido.toFixed(2) + \'?\')) {\n        enviarPago(\'tarjeta\');\n    }\n}\n\nfunction calcularCambio() {\n    console.log(\'Función calcularCambio ejecutada\');\n    \n    const input = document.getElementById(\'cashReceived\');\n    const cambio = document.getElementById(\'changeAmount\');\n    const btn = document.getElementById(\'confirmCashBtn\');\n    \n    console.log(\'Elementos encontrados:\', {input, cambio, btn});\n    \n    if (!input || !cambio || !btn) {\n        console.log(\'ERROR: No se encontraron todos los elementos\');\n        return;\n    }\n    \n    const recibido = parseFloat(input.value) || 0;\n    const diferencia = recibido - totalDelPedido;\n    \n    console.log(\'Cálculo:\', {recibido, totalDelPedido, diferencia});\n    \n    if (diferencia < 0) {\n        cambio.textContent = \'€\' + Math.abs(diferencia).toFixed(2) + \' (Falta)\';\n        cambio.style.color = \'red\';\n        btn.disabled = true;\n        console.log(\'Dinero insuficiente - botón deshabilitado\');\n    } else {\n        cambio.textContent = \'€\' + diferencia.toFixed(2);\n        cambio.style.color = \'green\';\n        btn.disabled = false;\n        console.log(\'Dinero suficiente - botón habilitado\');\n    }\n}\n\nfunction confirmarPagoEfectivo() {\n    const input = document.getElementById(\'cashReceived\');\n    if (input) {\n        const recibido = parseFloat(input.value) || 0;\n        if (recibido >= totalDelPedido) {\n            enviarPago(\'efectivo\', recibido);\n        }\n    }\n}\n\nfunction enviarPago(metodo, dinero = null) {\n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/pay_order/{{ mesa.id }}\';\n    \n    const inputMetodo = document.createElement(\'input\');\n    inputMetodo.type = \'hidden\';\n    inputMetodo.name = \'forma_pago\';\n    inputMetodo.value = metodo;\n    form.appendChild(inputMetodo);\n    \n    if (metodo === \'efectivo\' && dinero) {\n        const inputDinero = document.createElement(\'input\');\n        inputDinero.type = \'hidden\';\n        inputDinero.name = \'dinero_recibido\';\n        inputDinero.value = dinero.toFixed(2);\n        form.appendChild(inputDinero);\n        \n        const inputCambio = document.createElement(\'input\');\n        inputCambio.type = \'hidden\';\n        inputCambio.name = \'cambio\';\n        inputCambio.value = (dinero - totalDelPedido).toFixed(2);\n        form.appendChild(inputCambio);\n    }\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction obtenerTotal() {\n    // Buscar en resumen\n    const resumen = document.querySelector(\'.summary-value\');\n    if (resumen) {\n        const texto = resumen.textContent.replace(\'€\', \'\').replace(\',\', \'.\');\n        return parseFloat(texto) || 0;\n    }\n    \n    // Calcular desde items\n    let total = 0;\n    const items = document.querySelectorAll(\'.order-item\');\n    items.forEach(item => {\n        const precio = item.querySelector(\'.item-price\');\n        const cantidad = item.querySelector(\'.quantity\');\n        if (precio && cantidad) {\n            const p = parseFloat(precio.textContent.replace(\'€\', \'\')) || 0;\n            const c = parseInt(cantidad.textContent) || 0;\n            total += p * c;\n        }\n    });\n    \n    return total;\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'none\';\n}\n\nfunction ocultarCalculadora() {\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n}\n\n\n</script>\n', PosixPath('templates/table_detail.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 3750e1296f3d1c3c1641c87f40db676442065800d5c342795b995f01bcfe5a4d27ca61c5ea0dfadf2eea19c178d7118b8b8c8013553eaa4746b528834981e7f7_0
2025-06-07 16:37:42,829 - semgrep.rule_match - DEBUG - match_key = ('\nfunction toggleCategory(categoria) {\n    const container = document.getElementById(`products-${categoria}`);\n    const categoryCard = document.querySelector(`[data-categoria="${categoria}"]`);\n    const allCards = document.querySelectorAll(\'.category-card\');\n    const allContainers = document.querySelectorAll(\'.products-expanded-container\');\n    \n    allCards.forEach(card => {\n        if (card.dataset.categoria !== categoria) {\n            card.classList.remove(\'expanded\');\n        }\n    });\n    allContainers.forEach(cont => {\n        if (cont.id !== `products-${categoria}`) {\n            cont.style.display = \'none\';\n        }\n    });\n    \n    if (container.style.display === \'none\' || container.style.display === \'\') {\n        container.style.display = \'block\';\n        categoryCard.classList.add(\'expanded\');\n        setTimeout(() => {\n            container.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\n        }, 100);\n    } else {\n        container.style.display = \'none\';\n        categoryCard.classList.remove(\'expanded\');\n    }\n}\n\nfunction addToOrderWithAnimation(productCard, mesaId, productoId) {\n    // Add selection animation\n    productCard.classList.add(\'selected\');\n    \n    // Create floating feedback bubble\n    const feedback = document.createElement(\'div\');\n    feedback.className = \'feedback-bubble\';\n    feedback.textContent = \'✓ Added!\';\n    \n    // Ensure product card has relative positioning\n    productCard.style.position = \'relative\';\n    productCard.appendChild(feedback);\n    \n    // Create ripple effect\n    const ripple = document.createElement(\'div\');\n    ripple.style.cssText = `\n        position: absolute;\n        border-radius: 50%;\n        background: rgba(76, 175, 80, 0.3);\n        width: 30px;\n        height: 30px;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%) scale(0);\n        animation: ripple 0.6s linear;\n        pointer-events: none;\n        z-index: 999;\n    `;\n    productCard.appendChild(ripple);\n    \n    // Cleanup animations\n    setTimeout(() => {\n        if (feedback.parentNode) feedback.parentNode.removeChild(feedback);\n        if (ripple.parentNode) ripple.parentNode.removeChild(ripple);\n        productCard.classList.remove(\'selected\');\n    }, 1200);\n    \n    // Call original function\n    addToOrder(mesaId, productoId);\n}\n\nfunction addToOrder(mesaId, productoId) {\n    // Usar AJAX para añadir producto sin recargar la página\n    const formData = new FormData();\n    formData.append(\'mesa_id\', mesaId);\n    formData.append(\'producto_id\', productoId);\n    formData.append(\'cantidad\', 1);\n    \n    fetch(\'/add_to_order\', {\n        method: \'POST\',\n        body: formData\n    })\n    .then(response => {\n        if (response.ok) {\n            // Actualizar el panel de pedido sin cerrar el modal\n            updateOrderPanel(mesaId);\n        } else {\n            console.error(\'Error al añadir producto\');\n        }\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n    });\n}\n\nfunction updateOrderPanel(mesaId) {\n    // Actualizar usando AJAX más simple\n    fetch(`/table/${mesaId}`)\n    .then(response => {\n        if (!response.ok) throw new Error(\'Network error\');\n        return response.text();\n    })\n    .then(html => {\n        // Actualizar página completa después de un pequeño delay\n        setTimeout(() => {\n            location.reload();\n        }, 500);\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n        // Si falla, recargar página\n        location.reload();\n    });\n}\n\nfunction closeOrder(mesaId) {\n    if (confirm(\'¿Cerrar pedido y marcar mesa lista para pagar?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/close_order/\' + mesaId;\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction payOrder(mesaId, method) {\n    if (confirm(`¿Confirmar pago con ${method}?`)) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/pay_order/\' + mesaId;\n        \n        const methodInput = document.createElement(\'input\');\n        methodInput.type = \'hidden\';\n        methodInput.name = \'forma_pago\';\n        methodInput.value = method;\n        \n        form.appendChild(methodInput);\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction updateQuantity(mesaId, productoId, newQuantity) {\n    if (newQuantity <= 0) {\n        removeFromOrder(mesaId, productoId);\n        return;\n    }\n    \n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/update_quantity\';\n    \n    const mesaInput = document.createElement(\'input\');\n    mesaInput.type = \'hidden\';\n    mesaInput.name = \'mesa_id\';\n    mesaInput.value = mesaId;\n    \n    const productoInput = document.createElement(\'input\');\n    productoInput.type = \'hidden\';\n    productoInput.name = \'producto_id\';\n    productoInput.value = productoId;\n    \n    const cantidadInput = document.createElement(\'input\');\n    cantidadInput.type = \'hidden\';\n    cantidadInput.name = \'cantidad\';\n    cantidadInput.value = newQuantity;\n    \n    form.appendChild(mesaInput);\n    form.appendChild(productoInput);\n    form.appendChild(cantidadInput);\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction removeFromOrder(mesaId, productoId) {\n    if (confirm(\'¿Eliminar este producto del pedido?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/remove_from_order\';\n        \n        const mesaInput = document.createElement(\'input\');\n        mesaInput.type = \'hidden\';\n        mesaInput.name = \'mesa_id\';\n        mesaInput.value = mesaId;\n        \n        const productoInput = document.createElement(\'input\');\n        productoInput.type = \'hidden\';\n        productoInput.name = \'producto_id\';\n        productoInput.value = productoId;\n        \n        form.appendChild(mesaInput);\n        form.appendChild(productoInput);\n        \n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction showPaymentOptions(mesaId) {\n    // Mostrar modal de selección de pago inmediatamente\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'block\';\n        // Añadir clase para animación suave\n        modal.classList.add(\'show\');\n    }\n}\n\nfunction hidePaymentOptions(mesaId) {\n    // Ocultar modal de selección de pago\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'none\';\n        modal.classList.remove(\'show\');\n    }\n}\n\n// Datos de productos para el modal\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre|e }}",\n            precio: {{ producto.precio|float }},\n            descripcion: "{{ producto.descripcion|e|default(\'\') }}",\n            foto_url: "{{ producto.foto_url|default(\'\') }}",\n            sin_suplemento_terraza: {{ \'true\' if producto.sin_suplemento_terraza else \'false\' }}{% if es_terraza %},\n            precio_con_suplemento: {% if producto.sin_suplemento_terraza %}{{ producto.precio|float }}{% else %}{{ (producto.precio|float + suplemento_terraza|float)|round(2) }}{% endif %}{% endif %}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction openCategoryModal(categoria) {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    if (!modal || !modalTitle || !productosGrid) {\n        console.error(\'Modal elements not found\');\n        return;\n    }\n    \n    // Mostrar modal inmediatamente\n    modal.style.display = \'block\';\n    modalTitle.textContent = categoria;\n    \n    try {\n        // Si es cervezas, mostrar subcategorías primero\n        if (categoria === \'Cervezas\') {\n            showBeerSubcategories();\n            return;\n        }\n        \n        // Si es bocadillos, mostrar subcategorías\n        if (categoria === \'Bocadillos\') {\n            showBocadillosSubcategories();\n            return;\n        }\n        \n        // Si es raciones, mostrar subcategorías\n        if (categoria === \'Raciones\') {\n            showRacionesSubcategories();\n            return;\n        }\n        \n        productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">Cargando productos...</div>\';\n        \n        const productos = productosData[categoria];\n        if (!productos || productos.length === 0) {\n            productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">No hay productos en esta categoría</div>\';\n            return;\n        }\n        \n        // Limpiar y cargar productos\n        productosGrid.innerHTML = \'\';\n        \n        productos.forEach(producto => {\n            const productCard = document.createElement(\'div\');\n            productCard.className = \'product-card-modal\';\n            productCard.addEventListener(\'click\', function() {\n                addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n                // El modal permanece abierto para seguir agregando productos\n            });\n            \n            let precioHTML = \'\';\n            {% if es_terraza %}\n            if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n                precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                           \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n            } else {\n                precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            }\n            {% else %}\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            {% endif %}\n            \n            let imagenHTML = \'<div class="product-image-space" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 1px solid #e0e0e0; flex-shrink: 0;">📦</div>\';\n            if (producto.foto_url && producto.foto_url !== \'\') {\n                imagenHTML = \'<img src="\' + producto.foto_url + \'" alt="\' + producto.nombre + \'" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; object-fit: cover; background: #f5f5f5; padding: 0px; border: 1px solid #4CAF50; display: block; flex-shrink: 0;">\';\n            }\n            \n            productCard.innerHTML = imagenHTML + \'<div class="product-name-modal">\' + producto.nombre + \'</div>\' + precioHTML;\n            \n            productosGrid.appendChild(productCard);\n        });\n        \n        modal.style.display = \'block\';\n        \n    } catch (error) {\n        console.error(\'Error opening category modal:\', error);\n    }\n}\n\nfunction closeCategoryModal() {\n    const modal = document.getElementById(\'categoryModal\');\n    modal.style.display = \'none\';\n}\n\nfunction showBeerSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Cervezas - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const nacionalesBtn = document.createElement(\'div\');\n    nacionalesBtn.className = \'subcategory-button\';\n    nacionalesBtn.innerHTML = `\n        <div class="subcategory-icon">🍺</div>\n        <div class="subcategory-name">Cervezas Nacionales</div>\n        <div class="subcategory-count">${countBeersByType(\'nacionales\')}</div>\n    `;\n    nacionalesBtn.onclick = () => showBeerProducts(\'nacionales\');\n    \n    const importacionBtn = document.createElement(\'div\');\n    importacionBtn.className = \'subcategory-button\';\n    importacionBtn.innerHTML = `\n        <div class="subcategory-icon">🍻</div>\n        <div class="subcategory-name">Cervezas de Importación</div>\n        <div class="subcategory-count">${countBeersByType(\'importación\')}</div>\n    `;\n    importacionBtn.onclick = () => showBeerProducts(\'importación\');\n    \n    productosGrid.appendChild(nacionalesBtn);\n    productosGrid.appendChild(importacionBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBeersByType(tipo) {\n    const cervezas = productosData[\'Cervezas\'] || [];\n    return cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    }).length;\n}\n\nfunction showBeerProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = tipo === \'nacionales\' ? \'Cervezas Nacionales\' : \'Cervezas de Importación\';\n    productosGrid.innerHTML = \'\';\n    \n    const cervezas = productosData[\'Cervezas\'] || [];\n    const cervezasFiltradas = cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    });\n    \n    cervezasFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🍺</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showBocadillosSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Bocadillos - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const pinchosMontadosBtn = document.createElement(\'div\');\n    pinchosMontadosBtn.className = \'subcategory-button\';\n    pinchosMontadosBtn.innerHTML = `\n        <div class="subcategory-icon">🥪</div>\n        <div class="subcategory-name">Pinchos y Montados</div>\n        <div class="subcategory-count">${countBocadillosByType(\'pinchos y montados\')}</div>\n    `;\n    pinchosMontadosBtn.onclick = () => showBocadillosProducts(\'pinchos y montados\');\n    \n    const bocadillosFriosBtn = document.createElement(\'div\');\n    bocadillosFriosBtn.className = \'subcategory-button\';\n    bocadillosFriosBtn.innerHTML = `\n        <div class="subcategory-icon">🥖</div>\n        <div class="subcategory-name">Bocadillos Fríos</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos fríos\')}</div>\n    `;\n    bocadillosFriosBtn.onclick = () => showBocadillosProducts(\'bocadillos fríos\');\n    \n    const bocadillosCalientesBtn = document.createElement(\'div\');\n    bocadillosCalientesBtn.className = \'subcategory-button\';\n    bocadillosCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🌭</div>\n        <div class="subcategory-name">Bocadillos Calientes</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos calientes\')}</div>\n    `;\n    bocadillosCalientesBtn.onclick = () => showBocadillosProducts(\'bocadillos calientes\');\n    \n    productosGrid.appendChild(pinchosMontadosBtn);\n    productosGrid.appendChild(bocadillosFriosBtn);\n    productosGrid.appendChild(bocadillosCalientesBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction showRacionesSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Raciones - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const racionesCalientesBtn = document.createElement(\'div\');\n    racionesCalientesBtn.className = \'subcategory-button\';\n    racionesCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🍳</div>\n        <div class="subcategory-name">Raciones Calientes</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones calientes\')}</div>\n    `;\n    racionesCalientesBtn.onclick = () => showRacionesProducts(\'raciones calientes\');\n    \n    const racionesFriasBtn = document.createElement(\'div\');\n    racionesFriasBtn.className = \'subcategory-button\';\n    racionesFriasBtn.innerHTML = `\n        <div class="subcategory-icon">🥗</div>\n        <div class="subcategory-name">Raciones Frías</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones frías\')}</div>\n    `;\n    racionesFriasBtn.onclick = () => showRacionesProducts(\'raciones frías\');\n    \n    productosGrid.appendChild(racionesCalientesBtn);\n    productosGrid.appendChild(racionesFriasBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBocadillosByType(tipo) {\n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    return bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction countRacionesByType(tipo) {\n    const raciones = productosData[\'Raciones\'] || [];\n    return raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction showBocadillosProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    const bocadillosFiltrados = bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    bocadillosFiltrados.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🥪</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showRacionesProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const raciones = productosData[\'Raciones\'] || [];\n    const racionesFiltradas = raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    racionesFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        productCard.innerHTML = `\n            <div class="product-image-space">🍽️</div>\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\n// Calculadora de cambio - versión final funcional\nlet totalDelPedido = 0;\n\nfunction abrirModalPago() {\n    console.log(\'Abriendo modal de pago\');\n    \n    // Obtener total del pedido\n    totalDelPedido = obtenerTotal();\n    console.log(\'Total calculado:\', totalDelPedido);\n    \n    // Mostrar total\n    const elementoTotal = document.getElementById(\'totalAmount\');\n    if (elementoTotal) {\n        elementoTotal.textContent = \'€\' + totalDelPedido.toFixed(2);\n    }\n    \n    // Ocultar calculadora\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n    \n    // Mostrar modal\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'flex\';\n}\n\nfunction seleccionarEfectivo() {\n    console.log(\'Efectivo seleccionado\');\n    \n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) {\n        calc.style.display = \'block\';\n        \n        // Limpiar campos\n        const input = document.getElementById(\'cashReceived\');\n        const cambio = document.getElementById(\'changeAmount\');\n        const btn = document.getElementById(\'confirmCashBtn\');\n        \n        if (input) input.value = \'\';\n        if (cambio) cambio.textContent = \'€0.00\';\n        if (btn) btn.disabled = true;\n        \n        // Enfocar\n        setTimeout(() => {\n            if (input) input.focus();\n        }, 100);\n    }\n}\n\nfunction seleccionarTarjeta() {\n    console.log(\'Tarjeta seleccionada\');\n    if (confirm(\'¿Confirmar pago con tarjeta por €\' + totalDelPedido.toFixed(2) + \'?\')) {\n        enviarPago(\'tarjeta\');\n    }\n}\n\nfunction calcularCambio() {\n    console.log(\'Función calcularCambio ejecutada\');\n    \n    const input = document.getElementById(\'cashReceived\');\n    const cambio = document.getElementById(\'changeAmount\');\n    const btn = document.getElementById(\'confirmCashBtn\');\n    \n    console.log(\'Elementos encontrados:\', {input, cambio, btn});\n    \n    if (!input || !cambio || !btn) {\n        console.log(\'ERROR: No se encontraron todos los elementos\');\n        return;\n    }\n    \n    const recibido = parseFloat(input.value) || 0;\n    const diferencia = recibido - totalDelPedido;\n    \n    console.log(\'Cálculo:\', {recibido, totalDelPedido, diferencia});\n    \n    if (diferencia < 0) {\n        cambio.textContent = \'€\' + Math.abs(diferencia).toFixed(2) + \' (Falta)\';\n        cambio.style.color = \'red\';\n        btn.disabled = true;\n        console.log(\'Dinero insuficiente - botón deshabilitado\');\n    } else {\n        cambio.textContent = \'€\' + diferencia.toFixed(2);\n        cambio.style.color = \'green\';\n        btn.disabled = false;\n        console.log(\'Dinero suficiente - botón habilitado\');\n    }\n}\n\nfunction confirmarPagoEfectivo() {\n    const input = document.getElementById(\'cashReceived\');\n    if (input) {\n        const recibido = parseFloat(input.value) || 0;\n        if (recibido >= totalDelPedido) {\n            enviarPago(\'efectivo\', recibido);\n        }\n    }\n}\n\nfunction enviarPago(metodo, dinero = null) {\n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/pay_order/{{ mesa.id }}\';\n    \n    const inputMetodo = document.createElement(\'input\');\n    inputMetodo.type = \'hidden\';\n    inputMetodo.name = \'forma_pago\';\n    inputMetodo.value = metodo;\n    form.appendChild(inputMetodo);\n    \n    if (metodo === \'efectivo\' && dinero) {\n        const inputDinero = document.createElement(\'input\');\n        inputDinero.type = \'hidden\';\n        inputDinero.name = \'dinero_recibido\';\n        inputDinero.value = dinero.toFixed(2);\n        form.appendChild(inputDinero);\n        \n        const inputCambio = document.createElement(\'input\');\n        inputCambio.type = \'hidden\';\n        inputCambio.name = \'cambio\';\n        inputCambio.value = (dinero - totalDelPedido).toFixed(2);\n        form.appendChild(inputCambio);\n    }\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction obtenerTotal() {\n    // Buscar en resumen\n    const resumen = document.querySelector(\'.summary-value\');\n    if (resumen) {\n        const texto = resumen.textContent.replace(\'€\', \'\').replace(\',\', \'.\');\n        return parseFloat(texto) || 0;\n    }\n    \n    // Calcular desde items\n    let total = 0;\n    const items = document.querySelectorAll(\'.order-item\');\n    items.forEach(item => {\n        const precio = item.querySelector(\'.item-price\');\n        const cantidad = item.querySelector(\'.quantity\');\n        if (precio && cantidad) {\n            const p = parseFloat(precio.textContent.replace(\'€\', \'\')) || 0;\n            const c = parseInt(cantidad.textContent) || 0;\n            total += p * c;\n        }\n    });\n    \n    return total;\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'none\';\n}\n\nfunction ocultarCalculadora() {\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n}\n\n\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\nfunction toggleCategory(categoria) {\n    const container = document.getElementById(`products-${categoria}`);\n    const categoryCard = document.querySelector(`[data-categoria="${categoria}"]`);\n    const allCards = document.querySelectorAll(\'.category-card\');\n    const allContainers = document.querySelectorAll(\'.products-expanded-container\');\n    \n    allCards.forEach(card => {\n        if (card.dataset.categoria !== categoria) {\n            card.classList.remove(\'expanded\');\n        }\n    });\n    allContainers.forEach(cont => {\n        if (cont.id !== `products-${categoria}`) {\n            cont.style.display = \'none\';\n        }\n    });\n    \n    if (container.style.display === \'none\' || container.style.display === \'\') {\n        container.style.display = \'block\';\n        categoryCard.classList.add(\'expanded\');\n        setTimeout(() => {\n            container.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\n        }, 100);\n    } else {\n        container.style.display = \'none\';\n        categoryCard.classList.remove(\'expanded\');\n    }\n}\n\nfunction addToOrderWithAnimation(productCard, mesaId, productoId) {\n    // Add selection animation\n    productCard.classList.add(\'selected\');\n    \n    // Create floating feedback bubble\n    const feedback = document.createElement(\'div\');\n    feedback.className = \'feedback-bubble\';\n    feedback.textContent = \'✓ Added!\';\n    \n    // Ensure product card has relative positioning\n    productCard.style.position = \'relative\';\n    productCard.appendChild(feedback);\n    \n    // Create ripple effect\n    const ripple = document.createElement(\'div\');\n    ripple.style.cssText = `\n        position: absolute;\n        border-radius: 50%;\n        background: rgba(76, 175, 80, 0.3);\n        width: 30px;\n        height: 30px;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%) scale(0);\n        animation: ripple 0.6s linear;\n        pointer-events: none;\n        z-index: 999;\n    `;\n    productCard.appendChild(ripple);\n    \n    // Cleanup animations\n    setTimeout(() => {\n        if (feedback.parentNode) feedback.parentNode.removeChild(feedback);\n        if (ripple.parentNode) ripple.parentNode.removeChild(ripple);\n        productCard.classList.remove(\'selected\');\n    }, 1200);\n    \n    // Call original function\n    addToOrder(mesaId, productoId);\n}\n\nfunction addToOrder(mesaId, productoId) {\n    // Usar AJAX para añadir producto sin recargar la página\n    const formData = new FormData();\n    formData.append(\'mesa_id\', mesaId);\n    formData.append(\'producto_id\', productoId);\n    formData.append(\'cantidad\', 1);\n    \n    fetch(\'/add_to_order\', {\n        method: \'POST\',\n        body: formData\n    })\n    .then(response => {\n        if (response.ok) {\n            // Actualizar el panel de pedido sin cerrar el modal\n            updateOrderPanel(mesaId);\n        } else {\n            console.error(\'Error al añadir producto\');\n        }\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n    });\n}\n\nfunction updateOrderPanel(mesaId) {\n    // Actualizar usando AJAX más simple\n    fetch(`/table/${mesaId}`)\n    .then(response => {\n        if (!response.ok) throw new Error(\'Network error\');\n        return response.text();\n    })\n    .then(html => {\n        // Actualizar página completa después de un pequeño delay\n        setTimeout(() => {\n            location.reload();\n        }, 500);\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n        // Si falla, recargar página\n        location.reload();\n    });\n}\n\nfunction closeOrder(mesaId) {\n    if (confirm(\'¿Cerrar pedido y marcar mesa lista para pagar?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/close_order/\' + mesaId;\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction payOrder(mesaId, method) {\n    if (confirm(`¿Confirmar pago con ${method}?`)) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/pay_order/\' + mesaId;\n        \n        const methodInput = document.createElement(\'input\');\n        methodInput.type = \'hidden\';\n        methodInput.name = \'forma_pago\';\n        methodInput.value = method;\n        \n        form.appendChild(methodInput);\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction updateQuantity(mesaId, productoId, newQuantity) {\n    if (newQuantity <= 0) {\n        removeFromOrder(mesaId, productoId);\n        return;\n    }\n    \n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/update_quantity\';\n    \n    const mesaInput = document.createElement(\'input\');\n    mesaInput.type = \'hidden\';\n    mesaInput.name = \'mesa_id\';\n    mesaInput.value = mesaId;\n    \n    const productoInput = document.createElement(\'input\');\n    productoInput.type = \'hidden\';\n    productoInput.name = \'producto_id\';\n    productoInput.value = productoId;\n    \n    const cantidadInput = document.createElement(\'input\');\n    cantidadInput.type = \'hidden\';\n    cantidadInput.name = \'cantidad\';\n    cantidadInput.value = newQuantity;\n    \n    form.appendChild(mesaInput);\n    form.appendChild(productoInput);\n    form.appendChild(cantidadInput);\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction removeFromOrder(mesaId, productoId) {\n    if (confirm(\'¿Eliminar este producto del pedido?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/remove_from_order\';\n        \n        const mesaInput = document.createElement(\'input\');\n        mesaInput.type = \'hidden\';\n        mesaInput.name = \'mesa_id\';\n        mesaInput.value = mesaId;\n        \n        const productoInput = document.createElement(\'input\');\n        productoInput.type = \'hidden\';\n        productoInput.name = \'producto_id\';\n        productoInput.value = productoId;\n        \n        form.appendChild(mesaInput);\n        form.appendChild(productoInput);\n        \n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction showPaymentOptions(mesaId) {\n    // Mostrar modal de selección de pago inmediatamente\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'block\';\n        // Añadir clase para animación suave\n        modal.classList.add(\'show\');\n    }\n}\n\nfunction hidePaymentOptions(mesaId) {\n    // Ocultar modal de selección de pago\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'none\';\n        modal.classList.remove(\'show\');\n    }\n}\n\n// Datos de productos para el modal\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre|e }}",\n            precio: {{ producto.precio|float }},\n            descripcion: "{{ producto.descripcion|e|default(\'\') }}",\n            foto_url: "{{ producto.foto_url|default(\'\') }}",\n            sin_suplemento_terraza: {{ \'true\' if producto.sin_suplemento_terraza else \'false\' }}{% if es_terraza %},\n            precio_con_suplemento: {% if producto.sin_suplemento_terraza %}{{ producto.precio|float }}{% else %}{{ (producto.precio|float + suplemento_terraza|float)|round(2) }}{% endif %}{% endif %}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction openCategoryModal(categoria) {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    if (!modal || !modalTitle || !productosGrid) {\n        console.error(\'Modal elements not found\');\n        return;\n    }\n    \n    // Mostrar modal inmediatamente\n    modal.style.display = \'block\';\n    modalTitle.textContent = categoria;\n    \n    try {\n        // Si es cervezas, mostrar subcategorías primero\n        if (categoria === \'Cervezas\') {\n            showBeerSubcategories();\n            return;\n        }\n        \n        // Si es bocadillos, mostrar subcategorías\n        if (categoria === \'Bocadillos\') {\n            showBocadillosSubcategories();\n            return;\n        }\n        \n        // Si es raciones, mostrar subcategorías\n        if (categoria === \'Raciones\') {\n            showRacionesSubcategories();\n            return;\n        }\n        \n        productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">Cargando productos...</div>\';\n        \n        const productos = productosData[categoria];\n        if (!productos || productos.length === 0) {\n            productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">No hay productos en esta categoría</div>\';\n            return;\n        }\n        \n        // Limpiar y cargar productos\n        productosGrid.innerHTML = \'\';\n        \n        productos.forEach(producto => {\n            const productCard = document.createElement(\'div\');\n            productCard.className = \'product-card-modal\';\n            productCard.addEventListener(\'click\', function() {\n                addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n                // El modal permanece abierto para seguir agregando productos\n            });\n            \n            let precioHTML = \'\';\n            {% if es_terraza %}\n            if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n                precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                           \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n            } else {\n                precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            }\n            {% else %}\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            {% endif %}\n            \n            let imagenHTML = \'<div class="product-image-space" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 1px solid #e0e0e0; flex-shrink: 0;">📦</div>\';\n            if (producto.foto_url && producto.foto_url !== \'\') {\n                imagenHTML = \'<img src="\' + producto.foto_url + \'" alt="\' + producto.nombre + \'" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; object-fit: cover; background: #f5f5f5; padding: 0px; border: 1px solid #4CAF50; display: block; flex-shrink: 0;">\';\n            }\n            \n            productCard.innerHTML = imagenHTML + \'<div class="product-name-modal">\' + producto.nombre + \'</div>\' + precioHTML;\n            \n            productosGrid.appendChild(productCard);\n        });\n        \n        modal.style.display = \'block\';\n        \n    } catch (error) {\n        console.error(\'Error opening category modal:\', error);\n    }\n}\n\nfunction closeCategoryModal() {\n    const modal = document.getElementById(\'categoryModal\');\n    modal.style.display = \'none\';\n}\n\nfunction showBeerSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Cervezas - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const nacionalesBtn = document.createElement(\'div\');\n    nacionalesBtn.className = \'subcategory-button\';\n    nacionalesBtn.innerHTML = `\n        <div class="subcategory-icon">🍺</div>\n        <div class="subcategory-name">Cervezas Nacionales</div>\n        <div class="subcategory-count">${countBeersByType(\'nacionales\')}</div>\n    `;\n    nacionalesBtn.onclick = () => showBeerProducts(\'nacionales\');\n    \n    const importacionBtn = document.createElement(\'div\');\n    importacionBtn.className = \'subcategory-button\';\n    importacionBtn.innerHTML = `\n        <div class="subcategory-icon">🍻</div>\n        <div class="subcategory-name">Cervezas de Importación</div>\n        <div class="subcategory-count">${countBeersByType(\'importación\')}</div>\n    `;\n    importacionBtn.onclick = () => showBeerProducts(\'importación\');\n    \n    productosGrid.appendChild(nacionalesBtn);\n    productosGrid.appendChild(importacionBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBeersByType(tipo) {\n    const cervezas = productosData[\'Cervezas\'] || [];\n    return cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    }).length;\n}\n\nfunction showBeerProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = tipo === \'nacionales\' ? \'Cervezas Nacionales\' : \'Cervezas de Importación\';\n    productosGrid.innerHTML = \'\';\n    \n    const cervezas = productosData[\'Cervezas\'] || [];\n    const cervezasFiltradas = cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    });\n    \n    cervezasFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🍺</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showBocadillosSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Bocadillos - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const pinchosMontadosBtn = document.createElement(\'div\');\n    pinchosMontadosBtn.className = \'subcategory-button\';\n    pinchosMontadosBtn.innerHTML = `\n        <div class="subcategory-icon">🥪</div>\n        <div class="subcategory-name">Pinchos y Montados</div>\n        <div class="subcategory-count">${countBocadillosByType(\'pinchos y montados\')}</div>\n    `;\n    pinchosMontadosBtn.onclick = () => showBocadillosProducts(\'pinchos y montados\');\n    \n    const bocadillosFriosBtn = document.createElement(\'div\');\n    bocadillosFriosBtn.className = \'subcategory-button\';\n    bocadillosFriosBtn.innerHTML = `\n        <div class="subcategory-icon">🥖</div>\n        <div class="subcategory-name">Bocadillos Fríos</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos fríos\')}</div>\n    `;\n    bocadillosFriosBtn.onclick = () => showBocadillosProducts(\'bocadillos fríos\');\n    \n    const bocadillosCalientesBtn = document.createElement(\'div\');\n    bocadillosCalientesBtn.className = \'subcategory-button\';\n    bocadillosCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🌭</div>\n        <div class="subcategory-name">Bocadillos Calientes</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos calientes\')}</div>\n    `;\n    bocadillosCalientesBtn.onclick = () => showBocadillosProducts(\'bocadillos calientes\');\n    \n    productosGrid.appendChild(pinchosMontadosBtn);\n    productosGrid.appendChild(bocadillosFriosBtn);\n    productosGrid.appendChild(bocadillosCalientesBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction showRacionesSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Raciones - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const racionesCalientesBtn = document.createElement(\'div\');\n    racionesCalientesBtn.className = \'subcategory-button\';\n    racionesCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🍳</div>\n        <div class="subcategory-name">Raciones Calientes</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones calientes\')}</div>\n    `;\n    racionesCalientesBtn.onclick = () => showRacionesProducts(\'raciones calientes\');\n    \n    const racionesFriasBtn = document.createElement(\'div\');\n    racionesFriasBtn.className = \'subcategory-button\';\n    racionesFriasBtn.innerHTML = `\n        <div class="subcategory-icon">🥗</div>\n        <div class="subcategory-name">Raciones Frías</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones frías\')}</div>\n    `;\n    racionesFriasBtn.onclick = () => showRacionesProducts(\'raciones frías\');\n    \n    productosGrid.appendChild(racionesCalientesBtn);\n    productosGrid.appendChild(racionesFriasBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBocadillosByType(tipo) {\n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    return bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction countRacionesByType(tipo) {\n    const raciones = productosData[\'Raciones\'] || [];\n    return raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction showBocadillosProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    const bocadillosFiltrados = bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    bocadillosFiltrados.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🥪</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showRacionesProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const raciones = productosData[\'Raciones\'] || [];\n    const racionesFiltradas = raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    racionesFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        productCard.innerHTML = `\n            <div class="product-image-space">🍽️</div>\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\n// Calculadora de cambio - versión final funcional\nlet totalDelPedido = 0;\n\nfunction abrirModalPago() {\n    console.log(\'Abriendo modal de pago\');\n    \n    // Obtener total del pedido\n    totalDelPedido = obtenerTotal();\n    console.log(\'Total calculado:\', totalDelPedido);\n    \n    // Mostrar total\n    const elementoTotal = document.getElementById(\'totalAmount\');\n    if (elementoTotal) {\n        elementoTotal.textContent = \'€\' + totalDelPedido.toFixed(2);\n    }\n    \n    // Ocultar calculadora\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n    \n    // Mostrar modal\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'flex\';\n}\n\nfunction seleccionarEfectivo() {\n    console.log(\'Efectivo seleccionado\');\n    \n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) {\n        calc.style.display = \'block\';\n        \n        // Limpiar campos\n        const input = document.getElementById(\'cashReceived\');\n        const cambio = document.getElementById(\'changeAmount\');\n        const btn = document.getElementById(\'confirmCashBtn\');\n        \n        if (input) input.value = \'\';\n        if (cambio) cambio.textContent = \'€0.00\';\n        if (btn) btn.disabled = true;\n        \n        // Enfocar\n        setTimeout(() => {\n            if (input) input.focus();\n        }, 100);\n    }\n}\n\nfunction seleccionarTarjeta() {\n    console.log(\'Tarjeta seleccionada\');\n    if (confirm(\'¿Confirmar pago con tarjeta por €\' + totalDelPedido.toFixed(2) + \'?\')) {\n        enviarPago(\'tarjeta\');\n    }\n}\n\nfunction calcularCambio() {\n    console.log(\'Función calcularCambio ejecutada\');\n    \n    const input = document.getElementById(\'cashReceived\');\n    const cambio = document.getElementById(\'changeAmount\');\n    const btn = document.getElementById(\'confirmCashBtn\');\n    \n    console.log(\'Elementos encontrados:\', {input, cambio, btn});\n    \n    if (!input || !cambio || !btn) {\n        console.log(\'ERROR: No se encontraron todos los elementos\');\n        return;\n    }\n    \n    const recibido = parseFloat(input.value) || 0;\n    const diferencia = recibido - totalDelPedido;\n    \n    console.log(\'Cálculo:\', {recibido, totalDelPedido, diferencia});\n    \n    if (diferencia < 0) {\n        cambio.textContent = \'€\' + Math.abs(diferencia).toFixed(2) + \' (Falta)\';\n        cambio.style.color = \'red\';\n        btn.disabled = true;\n        console.log(\'Dinero insuficiente - botón deshabilitado\');\n    } else {\n        cambio.textContent = \'€\' + diferencia.toFixed(2);\n        cambio.style.color = \'green\';\n        btn.disabled = false;\n        console.log(\'Dinero suficiente - botón habilitado\');\n    }\n}\n\nfunction confirmarPagoEfectivo() {\n    const input = document.getElementById(\'cashReceived\');\n    if (input) {\n        const recibido = parseFloat(input.value) || 0;\n        if (recibido >= totalDelPedido) {\n            enviarPago(\'efectivo\', recibido);\n        }\n    }\n}\n\nfunction enviarPago(metodo, dinero = null) {\n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/pay_order/{{ mesa.id }}\';\n    \n    const inputMetodo = document.createElement(\'input\');\n    inputMetodo.type = \'hidden\';\n    inputMetodo.name = \'forma_pago\';\n    inputMetodo.value = metodo;\n    form.appendChild(inputMetodo);\n    \n    if (metodo === \'efectivo\' && dinero) {\n        const inputDinero = document.createElement(\'input\');\n        inputDinero.type = \'hidden\';\n        inputDinero.name = \'dinero_recibido\';\n        inputDinero.value = dinero.toFixed(2);\n        form.appendChild(inputDinero);\n        \n        const inputCambio = document.createElement(\'input\');\n        inputCambio.type = \'hidden\';\n        inputCambio.name = \'cambio\';\n        inputCambio.value = (dinero - totalDelPedido).toFixed(2);\n        form.appendChild(inputCambio);\n    }\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction obtenerTotal() {\n    // Buscar en resumen\n    const resumen = document.querySelector(\'.summary-value\');\n    if (resumen) {\n        const texto = resumen.textContent.replace(\'€\', \'\').replace(\',\', \'.\');\n        return parseFloat(texto) || 0;\n    }\n    \n    // Calcular desde items\n    let total = 0;\n    const items = document.querySelectorAll(\'.order-item\');\n    items.forEach(item => {\n        const precio = item.querySelector(\'.item-price\');\n        const cantidad = item.querySelector(\'.quantity\');\n        if (precio && cantidad) {\n            const p = parseFloat(precio.textContent.replace(\'€\', \'\')) || 0;\n            const c = parseInt(cantidad.textContent) || 0;\n            total += p * c;\n        }\n    });\n    \n    return total;\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'none\';\n}\n\nfunction ocultarCalculadora() {\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n}\n\n\n</script>\n', PosixPath('templates/table_detail.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 3750e1296f3d1c3c1641c87f40db676442065800d5c342795b995f01bcfe5a4d27ca61c5ea0dfadf2eea19c178d7118b8b8c8013553eaa4746b528834981e7f7_0
2025-06-07 16:37:42,843 - semgrep.rule_match - DEBUG - match_key = ('\nfunction toggleCategory(categoria) {\n    const container = document.getElementById(`products-${categoria}`);\n    const categoryCard = document.querySelector(`[data-categoria="${categoria}"]`);\n    const allCards = document.querySelectorAll(\'.category-card\');\n    const allContainers = document.querySelectorAll(\'.products-expanded-container\');\n    \n    allCards.forEach(card => {\n        if (card.dataset.categoria !== categoria) {\n            card.classList.remove(\'expanded\');\n        }\n    });\n    allContainers.forEach(cont => {\n        if (cont.id !== `products-${categoria}`) {\n            cont.style.display = \'none\';\n        }\n    });\n    \n    if (container.style.display === \'none\' || container.style.display === \'\') {\n        container.style.display = \'block\';\n        categoryCard.classList.add(\'expanded\');\n        setTimeout(() => {\n            container.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\n        }, 100);\n    } else {\n        container.style.display = \'none\';\n        categoryCard.classList.remove(\'expanded\');\n    }\n}\n\nfunction addToOrderWithAnimation(productCard, mesaId, productoId) {\n    // Add selection animation\n    productCard.classList.add(\'selected\');\n    \n    // Create floating feedback bubble\n    const feedback = document.createElement(\'div\');\n    feedback.className = \'feedback-bubble\';\n    feedback.textContent = \'✓ Added!\';\n    \n    // Ensure product card has relative positioning\n    productCard.style.position = \'relative\';\n    productCard.appendChild(feedback);\n    \n    // Create ripple effect\n    const ripple = document.createElement(\'div\');\n    ripple.style.cssText = `\n        position: absolute;\n        border-radius: 50%;\n        background: rgba(76, 175, 80, 0.3);\n        width: 30px;\n        height: 30px;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%) scale(0);\n        animation: ripple 0.6s linear;\n        pointer-events: none;\n        z-index: 999;\n    `;\n    productCard.appendChild(ripple);\n    \n    // Cleanup animations\n    setTimeout(() => {\n        if (feedback.parentNode) feedback.parentNode.removeChild(feedback);\n        if (ripple.parentNode) ripple.parentNode.removeChild(ripple);\n        productCard.classList.remove(\'selected\');\n    }, 1200);\n    \n    // Call original function\n    addToOrder(mesaId, productoId);\n}\n\nfunction addToOrder(mesaId, productoId) {\n    // Usar AJAX para añadir producto sin recargar la página\n    const formData = new FormData();\n    formData.append(\'mesa_id\', mesaId);\n    formData.append(\'producto_id\', productoId);\n    formData.append(\'cantidad\', 1);\n    \n    fetch(\'/add_to_order\', {\n        method: \'POST\',\n        body: formData\n    })\n    .then(response => {\n        if (response.ok) {\n            // Actualizar el panel de pedido sin cerrar el modal\n            updateOrderPanel(mesaId);\n        } else {\n            console.error(\'Error al añadir producto\');\n        }\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n    });\n}\n\nfunction updateOrderPanel(mesaId) {\n    // Actualizar usando AJAX más simple\n    fetch(`/table/${mesaId}`)\n    .then(response => {\n        if (!response.ok) throw new Error(\'Network error\');\n        return response.text();\n    })\n    .then(html => {\n        // Actualizar página completa después de un pequeño delay\n        setTimeout(() => {\n            location.reload();\n        }, 500);\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n        // Si falla, recargar página\n        location.reload();\n    });\n}\n\nfunction closeOrder(mesaId) {\n    if (confirm(\'¿Cerrar pedido y marcar mesa lista para pagar?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/close_order/\' + mesaId;\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction payOrder(mesaId, method) {\n    if (confirm(`¿Confirmar pago con ${method}?`)) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/pay_order/\' + mesaId;\n        \n        const methodInput = document.createElement(\'input\');\n        methodInput.type = \'hidden\';\n        methodInput.name = \'forma_pago\';\n        methodInput.value = method;\n        \n        form.appendChild(methodInput);\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction updateQuantity(mesaId, productoId, newQuantity) {\n    if (newQuantity <= 0) {\n        removeFromOrder(mesaId, productoId);\n        return;\n    }\n    \n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/update_quantity\';\n    \n    const mesaInput = document.createElement(\'input\');\n    mesaInput.type = \'hidden\';\n    mesaInput.name = \'mesa_id\';\n    mesaInput.value = mesaId;\n    \n    const productoInput = document.createElement(\'input\');\n    productoInput.type = \'hidden\';\n    productoInput.name = \'producto_id\';\n    productoInput.value = productoId;\n    \n    const cantidadInput = document.createElement(\'input\');\n    cantidadInput.type = \'hidden\';\n    cantidadInput.name = \'cantidad\';\n    cantidadInput.value = newQuantity;\n    \n    form.appendChild(mesaInput);\n    form.appendChild(productoInput);\n    form.appendChild(cantidadInput);\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction removeFromOrder(mesaId, productoId) {\n    if (confirm(\'¿Eliminar este producto del pedido?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/remove_from_order\';\n        \n        const mesaInput = document.createElement(\'input\');\n        mesaInput.type = \'hidden\';\n        mesaInput.name = \'mesa_id\';\n        mesaInput.value = mesaId;\n        \n        const productoInput = document.createElement(\'input\');\n        productoInput.type = \'hidden\';\n        productoInput.name = \'producto_id\';\n        productoInput.value = productoId;\n        \n        form.appendChild(mesaInput);\n        form.appendChild(productoInput);\n        \n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction showPaymentOptions(mesaId) {\n    // Mostrar modal de selección de pago inmediatamente\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'block\';\n        // Añadir clase para animación suave\n        modal.classList.add(\'show\');\n    }\n}\n\nfunction hidePaymentOptions(mesaId) {\n    // Ocultar modal de selección de pago\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'none\';\n        modal.classList.remove(\'show\');\n    }\n}\n\n// Datos de productos para el modal\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre|e }}",\n            precio: {{ producto.precio|float }},\n            descripcion: "{{ producto.descripcion|e|default(\'\') }}",\n            foto_url: "{{ producto.foto_url|default(\'\') }}",\n            sin_suplemento_terraza: {{ \'true\' if producto.sin_suplemento_terraza else \'false\' }}{% if es_terraza %},\n            precio_con_suplemento: {% if producto.sin_suplemento_terraza %}{{ producto.precio|float }}{% else %}{{ (producto.precio|float + suplemento_terraza|float)|round(2) }}{% endif %}{% endif %}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction openCategoryModal(categoria) {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    if (!modal || !modalTitle || !productosGrid) {\n        console.error(\'Modal elements not found\');\n        return;\n    }\n    \n    // Mostrar modal inmediatamente\n    modal.style.display = \'block\';\n    modalTitle.textContent = categoria;\n    \n    try {\n        // Si es cervezas, mostrar subcategorías primero\n        if (categoria === \'Cervezas\') {\n            showBeerSubcategories();\n            return;\n        }\n        \n        // Si es bocadillos, mostrar subcategorías\n        if (categoria === \'Bocadillos\') {\n            showBocadillosSubcategories();\n            return;\n        }\n        \n        // Si es raciones, mostrar subcategorías\n        if (categoria === \'Raciones\') {\n            showRacionesSubcategories();\n            return;\n        }\n        \n        productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">Cargando productos...</div>\';\n        \n        const productos = productosData[categoria];\n        if (!productos || productos.length === 0) {\n            productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">No hay productos en esta categoría</div>\';\n            return;\n        }\n        \n        // Limpiar y cargar productos\n        productosGrid.innerHTML = \'\';\n        \n        productos.forEach(producto => {\n            const productCard = document.createElement(\'div\');\n            productCard.className = \'product-card-modal\';\n            productCard.addEventListener(\'click\', function() {\n                addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n                // El modal permanece abierto para seguir agregando productos\n            });\n            \n            let precioHTML = \'\';\n            {% if es_terraza %}\n            if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n                precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                           \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n            } else {\n                precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            }\n            {% else %}\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            {% endif %}\n            \n            let imagenHTML = \'<div class="product-image-space" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 1px solid #e0e0e0; flex-shrink: 0;">📦</div>\';\n            if (producto.foto_url && producto.foto_url !== \'\') {\n                imagenHTML = \'<img src="\' + producto.foto_url + \'" alt="\' + producto.nombre + \'" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; object-fit: cover; background: #f5f5f5; padding: 0px; border: 1px solid #4CAF50; display: block; flex-shrink: 0;">\';\n            }\n            \n            productCard.innerHTML = imagenHTML + \'<div class="product-name-modal">\' + producto.nombre + \'</div>\' + precioHTML;\n            \n            productosGrid.appendChild(productCard);\n        });\n        \n        modal.style.display = \'block\';\n        \n    } catch (error) {\n        console.error(\'Error opening category modal:\', error);\n    }\n}\n\nfunction closeCategoryModal() {\n    const modal = document.getElementById(\'categoryModal\');\n    modal.style.display = \'none\';\n}\n\nfunction showBeerSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Cervezas - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const nacionalesBtn = document.createElement(\'div\');\n    nacionalesBtn.className = \'subcategory-button\';\n    nacionalesBtn.innerHTML = `\n        <div class="subcategory-icon">🍺</div>\n        <div class="subcategory-name">Cervezas Nacionales</div>\n        <div class="subcategory-count">${countBeersByType(\'nacionales\')}</div>\n    `;\n    nacionalesBtn.onclick = () => showBeerProducts(\'nacionales\');\n    \n    const importacionBtn = document.createElement(\'div\');\n    importacionBtn.className = \'subcategory-button\';\n    importacionBtn.innerHTML = `\n        <div class="subcategory-icon">🍻</div>\n        <div class="subcategory-name">Cervezas de Importación</div>\n        <div class="subcategory-count">${countBeersByType(\'importación\')}</div>\n    `;\n    importacionBtn.onclick = () => showBeerProducts(\'importación\');\n    \n    productosGrid.appendChild(nacionalesBtn);\n    productosGrid.appendChild(importacionBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBeersByType(tipo) {\n    const cervezas = productosData[\'Cervezas\'] || [];\n    return cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    }).length;\n}\n\nfunction showBeerProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = tipo === \'nacionales\' ? \'Cervezas Nacionales\' : \'Cervezas de Importación\';\n    productosGrid.innerHTML = \'\';\n    \n    const cervezas = productosData[\'Cervezas\'] || [];\n    const cervezasFiltradas = cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    });\n    \n    cervezasFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🍺</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showBocadillosSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Bocadillos - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const pinchosMontadosBtn = document.createElement(\'div\');\n    pinchosMontadosBtn.className = \'subcategory-button\';\n    pinchosMontadosBtn.innerHTML = `\n        <div class="subcategory-icon">🥪</div>\n        <div class="subcategory-name">Pinchos y Montados</div>\n        <div class="subcategory-count">${countBocadillosByType(\'pinchos y montados\')}</div>\n    `;\n    pinchosMontadosBtn.onclick = () => showBocadillosProducts(\'pinchos y montados\');\n    \n    const bocadillosFriosBtn = document.createElement(\'div\');\n    bocadillosFriosBtn.className = \'subcategory-button\';\n    bocadillosFriosBtn.innerHTML = `\n        <div class="subcategory-icon">🥖</div>\n        <div class="subcategory-name">Bocadillos Fríos</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos fríos\')}</div>\n    `;\n    bocadillosFriosBtn.onclick = () => showBocadillosProducts(\'bocadillos fríos\');\n    \n    const bocadillosCalientesBtn = document.createElement(\'div\');\n    bocadillosCalientesBtn.className = \'subcategory-button\';\n    bocadillosCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🌭</div>\n        <div class="subcategory-name">Bocadillos Calientes</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos calientes\')}</div>\n    `;\n    bocadillosCalientesBtn.onclick = () => showBocadillosProducts(\'bocadillos calientes\');\n    \n    productosGrid.appendChild(pinchosMontadosBtn);\n    productosGrid.appendChild(bocadillosFriosBtn);\n    productosGrid.appendChild(bocadillosCalientesBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction showRacionesSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Raciones - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const racionesCalientesBtn = document.createElement(\'div\');\n    racionesCalientesBtn.className = \'subcategory-button\';\n    racionesCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🍳</div>\n        <div class="subcategory-name">Raciones Calientes</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones calientes\')}</div>\n    `;\n    racionesCalientesBtn.onclick = () => showRacionesProducts(\'raciones calientes\');\n    \n    const racionesFriasBtn = document.createElement(\'div\');\n    racionesFriasBtn.className = \'subcategory-button\';\n    racionesFriasBtn.innerHTML = `\n        <div class="subcategory-icon">🥗</div>\n        <div class="subcategory-name">Raciones Frías</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones frías\')}</div>\n    `;\n    racionesFriasBtn.onclick = () => showRacionesProducts(\'raciones frías\');\n    \n    productosGrid.appendChild(racionesCalientesBtn);\n    productosGrid.appendChild(racionesFriasBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBocadillosByType(tipo) {\n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    return bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction countRacionesByType(tipo) {\n    const raciones = productosData[\'Raciones\'] || [];\n    return raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction showBocadillosProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    const bocadillosFiltrados = bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    bocadillosFiltrados.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🥪</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showRacionesProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const raciones = productosData[\'Raciones\'] || [];\n    const racionesFiltradas = raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    racionesFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        productCard.innerHTML = `\n            <div class="product-image-space">🍽️</div>\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\n// Calculadora de cambio - versión final funcional\nlet totalDelPedido = 0;\n\nfunction abrirModalPago() {\n    console.log(\'Abriendo modal de pago\');\n    \n    // Obtener total del pedido\n    totalDelPedido = obtenerTotal();\n    console.log(\'Total calculado:\', totalDelPedido);\n    \n    // Mostrar total\n    const elementoTotal = document.getElementById(\'totalAmount\');\n    if (elementoTotal) {\n        elementoTotal.textContent = \'€\' + totalDelPedido.toFixed(2);\n    }\n    \n    // Ocultar calculadora\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n    \n    // Mostrar modal\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'flex\';\n}\n\nfunction seleccionarEfectivo() {\n    console.log(\'Efectivo seleccionado\');\n    \n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) {\n        calc.style.display = \'block\';\n        \n        // Limpiar campos\n        const input = document.getElementById(\'cashReceived\');\n        const cambio = document.getElementById(\'changeAmount\');\n        const btn = document.getElementById(\'confirmCashBtn\');\n        \n        if (input) input.value = \'\';\n        if (cambio) cambio.textContent = \'€0.00\';\n        if (btn) btn.disabled = true;\n        \n        // Enfocar\n        setTimeout(() => {\n            if (input) input.focus();\n        }, 100);\n    }\n}\n\nfunction seleccionarTarjeta() {\n    console.log(\'Tarjeta seleccionada\');\n    if (confirm(\'¿Confirmar pago con tarjeta por €\' + totalDelPedido.toFixed(2) + \'?\')) {\n        enviarPago(\'tarjeta\');\n    }\n}\n\nfunction calcularCambio() {\n    console.log(\'Función calcularCambio ejecutada\');\n    \n    const input = document.getElementById(\'cashReceived\');\n    const cambio = document.getElementById(\'changeAmount\');\n    const btn = document.getElementById(\'confirmCashBtn\');\n    \n    console.log(\'Elementos encontrados:\', {input, cambio, btn});\n    \n    if (!input || !cambio || !btn) {\n        console.log(\'ERROR: No se encontraron todos los elementos\');\n        return;\n    }\n    \n    const recibido = parseFloat(input.value) || 0;\n    const diferencia = recibido - totalDelPedido;\n    \n    console.log(\'Cálculo:\', {recibido, totalDelPedido, diferencia});\n    \n    if (diferencia < 0) {\n        cambio.textContent = \'€\' + Math.abs(diferencia).toFixed(2) + \' (Falta)\';\n        cambio.style.color = \'red\';\n        btn.disabled = true;\n        console.log(\'Dinero insuficiente - botón deshabilitado\');\n    } else {\n        cambio.textContent = \'€\' + diferencia.toFixed(2);\n        cambio.style.color = \'green\';\n        btn.disabled = false;\n        console.log(\'Dinero suficiente - botón habilitado\');\n    }\n}\n\nfunction confirmarPagoEfectivo() {\n    const input = document.getElementById(\'cashReceived\');\n    if (input) {\n        const recibido = parseFloat(input.value) || 0;\n        if (recibido >= totalDelPedido) {\n            enviarPago(\'efectivo\', recibido);\n        }\n    }\n}\n\nfunction enviarPago(metodo, dinero = null) {\n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/pay_order/{{ mesa.id }}\';\n    \n    const inputMetodo = document.createElement(\'input\');\n    inputMetodo.type = \'hidden\';\n    inputMetodo.name = \'forma_pago\';\n    inputMetodo.value = metodo;\n    form.appendChild(inputMetodo);\n    \n    if (metodo === \'efectivo\' && dinero) {\n        const inputDinero = document.createElement(\'input\');\n        inputDinero.type = \'hidden\';\n        inputDinero.name = \'dinero_recibido\';\n        inputDinero.value = dinero.toFixed(2);\n        form.appendChild(inputDinero);\n        \n        const inputCambio = document.createElement(\'input\');\n        inputCambio.type = \'hidden\';\n        inputCambio.name = \'cambio\';\n        inputCambio.value = (dinero - totalDelPedido).toFixed(2);\n        form.appendChild(inputCambio);\n    }\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction obtenerTotal() {\n    // Buscar en resumen\n    const resumen = document.querySelector(\'.summary-value\');\n    if (resumen) {\n        const texto = resumen.textContent.replace(\'€\', \'\').replace(\',\', \'.\');\n        return parseFloat(texto) || 0;\n    }\n    \n    // Calcular desde items\n    let total = 0;\n    const items = document.querySelectorAll(\'.order-item\');\n    items.forEach(item => {\n        const precio = item.querySelector(\'.item-price\');\n        const cantidad = item.querySelector(\'.quantity\');\n        if (precio && cantidad) {\n            const p = parseFloat(precio.textContent.replace(\'€\', \'\')) || 0;\n            const c = parseInt(cantidad.textContent) || 0;\n            total += p * c;\n        }\n    });\n    \n    return total;\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'none\';\n}\n\nfunction ocultarCalculadora() {\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n}\n\n\n $X $X. ... .$V = "..." $X. ... .innerHTML = ... $X. ... .outerHTML = ... javascript <script ...>\nfunction toggleCategory(categoria) {\n    const container = document.getElementById(`products-${categoria}`);\n    const categoryCard = document.querySelector(`[data-categoria="${categoria}"]`);\n    const allCards = document.querySelectorAll(\'.category-card\');\n    const allContainers = document.querySelectorAll(\'.products-expanded-container\');\n    \n    allCards.forEach(card => {\n        if (card.dataset.categoria !== categoria) {\n            card.classList.remove(\'expanded\');\n        }\n    });\n    allContainers.forEach(cont => {\n        if (cont.id !== `products-${categoria}`) {\n            cont.style.display = \'none\';\n        }\n    });\n    \n    if (container.style.display === \'none\' || container.style.display === \'\') {\n        container.style.display = \'block\';\n        categoryCard.classList.add(\'expanded\');\n        setTimeout(() => {\n            container.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\n        }, 100);\n    } else {\n        container.style.display = \'none\';\n        categoryCard.classList.remove(\'expanded\');\n    }\n}\n\nfunction addToOrderWithAnimation(productCard, mesaId, productoId) {\n    // Add selection animation\n    productCard.classList.add(\'selected\');\n    \n    // Create floating feedback bubble\n    const feedback = document.createElement(\'div\');\n    feedback.className = \'feedback-bubble\';\n    feedback.textContent = \'✓ Added!\';\n    \n    // Ensure product card has relative positioning\n    productCard.style.position = \'relative\';\n    productCard.appendChild(feedback);\n    \n    // Create ripple effect\n    const ripple = document.createElement(\'div\');\n    ripple.style.cssText = `\n        position: absolute;\n        border-radius: 50%;\n        background: rgba(76, 175, 80, 0.3);\n        width: 30px;\n        height: 30px;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%) scale(0);\n        animation: ripple 0.6s linear;\n        pointer-events: none;\n        z-index: 999;\n    `;\n    productCard.appendChild(ripple);\n    \n    // Cleanup animations\n    setTimeout(() => {\n        if (feedback.parentNode) feedback.parentNode.removeChild(feedback);\n        if (ripple.parentNode) ripple.parentNode.removeChild(ripple);\n        productCard.classList.remove(\'selected\');\n    }, 1200);\n    \n    // Call original function\n    addToOrder(mesaId, productoId);\n}\n\nfunction addToOrder(mesaId, productoId) {\n    // Usar AJAX para añadir producto sin recargar la página\n    const formData = new FormData();\n    formData.append(\'mesa_id\', mesaId);\n    formData.append(\'producto_id\', productoId);\n    formData.append(\'cantidad\', 1);\n    \n    fetch(\'/add_to_order\', {\n        method: \'POST\',\n        body: formData\n    })\n    .then(response => {\n        if (response.ok) {\n            // Actualizar el panel de pedido sin cerrar el modal\n            updateOrderPanel(mesaId);\n        } else {\n            console.error(\'Error al añadir producto\');\n        }\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n    });\n}\n\nfunction updateOrderPanel(mesaId) {\n    // Actualizar usando AJAX más simple\n    fetch(`/table/${mesaId}`)\n    .then(response => {\n        if (!response.ok) throw new Error(\'Network error\');\n        return response.text();\n    })\n    .then(html => {\n        // Actualizar página completa después de un pequeño delay\n        setTimeout(() => {\n            location.reload();\n        }, 500);\n    })\n    .catch(error => {\n        console.error(\'Error:\', error);\n        // Si falla, recargar página\n        location.reload();\n    });\n}\n\nfunction closeOrder(mesaId) {\n    if (confirm(\'¿Cerrar pedido y marcar mesa lista para pagar?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/close_order/\' + mesaId;\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction payOrder(mesaId, method) {\n    if (confirm(`¿Confirmar pago con ${method}?`)) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/pay_order/\' + mesaId;\n        \n        const methodInput = document.createElement(\'input\');\n        methodInput.type = \'hidden\';\n        methodInput.name = \'forma_pago\';\n        methodInput.value = method;\n        \n        form.appendChild(methodInput);\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction updateQuantity(mesaId, productoId, newQuantity) {\n    if (newQuantity <= 0) {\n        removeFromOrder(mesaId, productoId);\n        return;\n    }\n    \n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/update_quantity\';\n    \n    const mesaInput = document.createElement(\'input\');\n    mesaInput.type = \'hidden\';\n    mesaInput.name = \'mesa_id\';\n    mesaInput.value = mesaId;\n    \n    const productoInput = document.createElement(\'input\');\n    productoInput.type = \'hidden\';\n    productoInput.name = \'producto_id\';\n    productoInput.value = productoId;\n    \n    const cantidadInput = document.createElement(\'input\');\n    cantidadInput.type = \'hidden\';\n    cantidadInput.name = \'cantidad\';\n    cantidadInput.value = newQuantity;\n    \n    form.appendChild(mesaInput);\n    form.appendChild(productoInput);\n    form.appendChild(cantidadInput);\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction removeFromOrder(mesaId, productoId) {\n    if (confirm(\'¿Eliminar este producto del pedido?\')) {\n        const form = document.createElement(\'form\');\n        form.method = \'POST\';\n        form.action = \'/remove_from_order\';\n        \n        const mesaInput = document.createElement(\'input\');\n        mesaInput.type = \'hidden\';\n        mesaInput.name = \'mesa_id\';\n        mesaInput.value = mesaId;\n        \n        const productoInput = document.createElement(\'input\');\n        productoInput.type = \'hidden\';\n        productoInput.name = \'producto_id\';\n        productoInput.value = productoId;\n        \n        form.appendChild(mesaInput);\n        form.appendChild(productoInput);\n        \n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\nfunction showPaymentOptions(mesaId) {\n    // Mostrar modal de selección de pago inmediatamente\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'block\';\n        // Añadir clase para animación suave\n        modal.classList.add(\'show\');\n    }\n}\n\nfunction hidePaymentOptions(mesaId) {\n    // Ocultar modal de selección de pago\n    const modal = document.getElementById(`payment-modal-${mesaId}`);\n    if (modal) {\n        modal.style.display = \'none\';\n        modal.classList.remove(\'show\');\n    }\n}\n\n// Datos de productos para el modal\nconst productosData = {\n    {% for categoria, productos in productos_por_categoria.items() %}\n    "{{ categoria }}": [\n        {% for producto in productos %}\n        {\n            id: {{ producto.id }},\n            nombre: "{{ producto.nombre|e }}",\n            precio: {{ producto.precio|float }},\n            descripcion: "{{ producto.descripcion|e|default(\'\') }}",\n            foto_url: "{{ producto.foto_url|default(\'\') }}",\n            sin_suplemento_terraza: {{ \'true\' if producto.sin_suplemento_terraza else \'false\' }}{% if es_terraza %},\n            precio_con_suplemento: {% if producto.sin_suplemento_terraza %}{{ producto.precio|float }}{% else %}{{ (producto.precio|float + suplemento_terraza|float)|round(2) }}{% endif %}{% endif %}\n        }{% if not loop.last %},{% endif %}\n        {% endfor %}\n    ]{% if not loop.last %},{% endif %}\n    {% endfor %}\n};\n\nfunction openCategoryModal(categoria) {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    if (!modal || !modalTitle || !productosGrid) {\n        console.error(\'Modal elements not found\');\n        return;\n    }\n    \n    // Mostrar modal inmediatamente\n    modal.style.display = \'block\';\n    modalTitle.textContent = categoria;\n    \n    try {\n        // Si es cervezas, mostrar subcategorías primero\n        if (categoria === \'Cervezas\') {\n            showBeerSubcategories();\n            return;\n        }\n        \n        // Si es bocadillos, mostrar subcategorías\n        if (categoria === \'Bocadillos\') {\n            showBocadillosSubcategories();\n            return;\n        }\n        \n        // Si es raciones, mostrar subcategorías\n        if (categoria === \'Raciones\') {\n            showRacionesSubcategories();\n            return;\n        }\n        \n        productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">Cargando productos...</div>\';\n        \n        const productos = productosData[categoria];\n        if (!productos || productos.length === 0) {\n            productosGrid.innerHTML = \'<div style="text-align: center; padding: 20px; color: #666;">No hay productos en esta categoría</div>\';\n            return;\n        }\n        \n        // Limpiar y cargar productos\n        productosGrid.innerHTML = \'\';\n        \n        productos.forEach(producto => {\n            const productCard = document.createElement(\'div\');\n            productCard.className = \'product-card-modal\';\n            productCard.addEventListener(\'click\', function() {\n                addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n                // El modal permanece abierto para seguir agregando productos\n            });\n            \n            let precioHTML = \'\';\n            {% if es_terraza %}\n            if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n                precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                           \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n            } else {\n                precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            }\n            {% else %}\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n            {% endif %}\n            \n            let imagenHTML = \'<div class="product-image-space" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 1px solid #e0e0e0; flex-shrink: 0;">📦</div>\';\n            if (producto.foto_url && producto.foto_url !== \'\') {\n                imagenHTML = \'<img src="\' + producto.foto_url + \'" alt="\' + producto.nombre + \'" style="width: 60px; height: 60px; margin: 0 auto 4px auto; border-radius: 8px; object-fit: cover; background: #f5f5f5; padding: 0px; border: 1px solid #4CAF50; display: block; flex-shrink: 0;">\';\n            }\n            \n            productCard.innerHTML = imagenHTML + \'<div class="product-name-modal">\' + producto.nombre + \'</div>\' + precioHTML;\n            \n            productosGrid.appendChild(productCard);\n        });\n        \n        modal.style.display = \'block\';\n        \n    } catch (error) {\n        console.error(\'Error opening category modal:\', error);\n    }\n}\n\nfunction closeCategoryModal() {\n    const modal = document.getElementById(\'categoryModal\');\n    modal.style.display = \'none\';\n}\n\nfunction showBeerSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Cervezas - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const nacionalesBtn = document.createElement(\'div\');\n    nacionalesBtn.className = \'subcategory-button\';\n    nacionalesBtn.innerHTML = `\n        <div class="subcategory-icon">🍺</div>\n        <div class="subcategory-name">Cervezas Nacionales</div>\n        <div class="subcategory-count">${countBeersByType(\'nacionales\')}</div>\n    `;\n    nacionalesBtn.onclick = () => showBeerProducts(\'nacionales\');\n    \n    const importacionBtn = document.createElement(\'div\');\n    importacionBtn.className = \'subcategory-button\';\n    importacionBtn.innerHTML = `\n        <div class="subcategory-icon">🍻</div>\n        <div class="subcategory-name">Cervezas de Importación</div>\n        <div class="subcategory-count">${countBeersByType(\'importación\')}</div>\n    `;\n    importacionBtn.onclick = () => showBeerProducts(\'importación\');\n    \n    productosGrid.appendChild(nacionalesBtn);\n    productosGrid.appendChild(importacionBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBeersByType(tipo) {\n    const cervezas = productosData[\'Cervezas\'] || [];\n    return cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    }).length;\n}\n\nfunction showBeerProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = tipo === \'nacionales\' ? \'Cervezas Nacionales\' : \'Cervezas de Importación\';\n    productosGrid.innerHTML = \'\';\n    \n    const cervezas = productosData[\'Cervezas\'] || [];\n    const cervezasFiltradas = cervezas.filter(cerveza => {\n        return tipo === \'nacionales\' ? \n            cerveza.descripcion.toLowerCase().includes(\'nacionales\') :\n            cerveza.descripcion.toLowerCase().includes(\'importación\');\n    });\n    \n    cervezasFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🍺</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showBocadillosSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Bocadillos - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const pinchosMontadosBtn = document.createElement(\'div\');\n    pinchosMontadosBtn.className = \'subcategory-button\';\n    pinchosMontadosBtn.innerHTML = `\n        <div class="subcategory-icon">🥪</div>\n        <div class="subcategory-name">Pinchos y Montados</div>\n        <div class="subcategory-count">${countBocadillosByType(\'pinchos y montados\')}</div>\n    `;\n    pinchosMontadosBtn.onclick = () => showBocadillosProducts(\'pinchos y montados\');\n    \n    const bocadillosFriosBtn = document.createElement(\'div\');\n    bocadillosFriosBtn.className = \'subcategory-button\';\n    bocadillosFriosBtn.innerHTML = `\n        <div class="subcategory-icon">🥖</div>\n        <div class="subcategory-name">Bocadillos Fríos</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos fríos\')}</div>\n    `;\n    bocadillosFriosBtn.onclick = () => showBocadillosProducts(\'bocadillos fríos\');\n    \n    const bocadillosCalientesBtn = document.createElement(\'div\');\n    bocadillosCalientesBtn.className = \'subcategory-button\';\n    bocadillosCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🌭</div>\n        <div class="subcategory-name">Bocadillos Calientes</div>\n        <div class="subcategory-count">${countBocadillosByType(\'bocadillos calientes\')}</div>\n    `;\n    bocadillosCalientesBtn.onclick = () => showBocadillosProducts(\'bocadillos calientes\');\n    \n    productosGrid.appendChild(pinchosMontadosBtn);\n    productosGrid.appendChild(bocadillosFriosBtn);\n    productosGrid.appendChild(bocadillosCalientesBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction showRacionesSubcategories() {\n    const modal = document.getElementById(\'categoryModal\');\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    modalTitle.textContent = \'Raciones - Seleccionar Tipo\';\n    productosGrid.innerHTML = \'\';\n    \n    // Crear botones para subcategorías\n    const racionesCalientesBtn = document.createElement(\'div\');\n    racionesCalientesBtn.className = \'subcategory-button\';\n    racionesCalientesBtn.innerHTML = `\n        <div class="subcategory-icon">🍳</div>\n        <div class="subcategory-name">Raciones Calientes</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones calientes\')}</div>\n    `;\n    racionesCalientesBtn.onclick = () => showRacionesProducts(\'raciones calientes\');\n    \n    const racionesFriasBtn = document.createElement(\'div\');\n    racionesFriasBtn.className = \'subcategory-button\';\n    racionesFriasBtn.innerHTML = `\n        <div class="subcategory-icon">🥗</div>\n        <div class="subcategory-name">Raciones Frías</div>\n        <div class="subcategory-count">${countRacionesByType(\'raciones frías\')}</div>\n    `;\n    racionesFriasBtn.onclick = () => showRacionesProducts(\'raciones frías\');\n    \n    productosGrid.appendChild(racionesCalientesBtn);\n    productosGrid.appendChild(racionesFriasBtn);\n    \n    modal.style.display = \'block\';\n}\n\nfunction countBocadillosByType(tipo) {\n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    return bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction countRacionesByType(tipo) {\n    const raciones = productosData[\'Raciones\'] || [];\n    return raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    }).length;\n}\n\nfunction showBocadillosProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const bocadillos = productosData[\'Bocadillos\'] || [];\n    const bocadillosFiltrados = bocadillos.filter(bocadillo => {\n        return bocadillo.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    bocadillosFiltrados.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        let imagenHTML = \'<div class="product-image-space">🥪</div>\';\n        if (producto.foto_url) {\n            imagenHTML = `<img src="${producto.foto_url}" alt="${producto.nombre}" style="width: 48px; height: 48px; margin: 0 auto 12px auto; border-radius: 8px; object-fit: contain; background: #f8f9fa; padding: 4px; border: 1px solid #e9ecef; display: block;">`;\n        }\n        \n        productCard.innerHTML = `\n            ${imagenHTML}\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\nfunction showRacionesProducts(tipo) {\n    const modalTitle = document.getElementById(\'modalCategoryTitle\');\n    const productosGrid = document.getElementById(\'modalProductsGrid\');\n    \n    let tituloCapitalizado = tipo.split(\' \').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(\' \');\n    modalTitle.textContent = tituloCapitalizado;\n    productosGrid.innerHTML = \'\';\n    \n    const raciones = productosData[\'Raciones\'] || [];\n    const racionesFiltradas = raciones.filter(racion => {\n        return racion.descripcion.toLowerCase().includes(tipo.toLowerCase());\n    });\n    \n    racionesFiltradas.forEach(producto => {\n        const productCard = document.createElement(\'div\');\n        productCard.className = \'product-card-modal\';\n        productCard.addEventListener(\'click\', function() {\n            addToOrderWithAnimation(productCard, {{ mesa.id }}, producto.id);\n            // El modal permanece abierto para seguir agregando productos\n        });\n        \n        let precioHTML = \'\';\n        {% if es_terraza %}\n        if (producto.precio_con_suplemento && producto.precio_con_suplemento !== producto.precio && !producto.sin_suplemento_terraza) {\n            precioHTML = \'<div class="price-base">€\' + producto.precio.toFixed(2) + \'</div>\' +\n                       \'<div class="product-price price-terraza">€\' + producto.precio_con_suplemento.toFixed(2) + \'</div>\';\n        } else {\n            precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        }\n        {% else %}\n        precioHTML = \'<div class="product-price">€\' + producto.precio.toFixed(2) + \'</div>\';\n        {% endif %}\n        \n        productCard.innerHTML = `\n            <div class="product-image-space">🍽️</div>\n            <div class="product-name-modal">${producto.nombre}</div>\n            ${precioHTML}\n        `;\n        \n        productosGrid.appendChild(productCard);\n    });\n}\n\n// Calculadora de cambio - versión final funcional\nlet totalDelPedido = 0;\n\nfunction abrirModalPago() {\n    console.log(\'Abriendo modal de pago\');\n    \n    // Obtener total del pedido\n    totalDelPedido = obtenerTotal();\n    console.log(\'Total calculado:\', totalDelPedido);\n    \n    // Mostrar total\n    const elementoTotal = document.getElementById(\'totalAmount\');\n    if (elementoTotal) {\n        elementoTotal.textContent = \'€\' + totalDelPedido.toFixed(2);\n    }\n    \n    // Ocultar calculadora\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n    \n    // Mostrar modal\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'flex\';\n}\n\nfunction seleccionarEfectivo() {\n    console.log(\'Efectivo seleccionado\');\n    \n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) {\n        calc.style.display = \'block\';\n        \n        // Limpiar campos\n        const input = document.getElementById(\'cashReceived\');\n        const cambio = document.getElementById(\'changeAmount\');\n        const btn = document.getElementById(\'confirmCashBtn\');\n        \n        if (input) input.value = \'\';\n        if (cambio) cambio.textContent = \'€0.00\';\n        if (btn) btn.disabled = true;\n        \n        // Enfocar\n        setTimeout(() => {\n            if (input) input.focus();\n        }, 100);\n    }\n}\n\nfunction seleccionarTarjeta() {\n    console.log(\'Tarjeta seleccionada\');\n    if (confirm(\'¿Confirmar pago con tarjeta por €\' + totalDelPedido.toFixed(2) + \'?\')) {\n        enviarPago(\'tarjeta\');\n    }\n}\n\nfunction calcularCambio() {\n    console.log(\'Función calcularCambio ejecutada\');\n    \n    const input = document.getElementById(\'cashReceived\');\n    const cambio = document.getElementById(\'changeAmount\');\n    const btn = document.getElementById(\'confirmCashBtn\');\n    \n    console.log(\'Elementos encontrados:\', {input, cambio, btn});\n    \n    if (!input || !cambio || !btn) {\n        console.log(\'ERROR: No se encontraron todos los elementos\');\n        return;\n    }\n    \n    const recibido = parseFloat(input.value) || 0;\n    const diferencia = recibido - totalDelPedido;\n    \n    console.log(\'Cálculo:\', {recibido, totalDelPedido, diferencia});\n    \n    if (diferencia < 0) {\n        cambio.textContent = \'€\' + Math.abs(diferencia).toFixed(2) + \' (Falta)\';\n        cambio.style.color = \'red\';\n        btn.disabled = true;\n        console.log(\'Dinero insuficiente - botón deshabilitado\');\n    } else {\n        cambio.textContent = \'€\' + diferencia.toFixed(2);\n        cambio.style.color = \'green\';\n        btn.disabled = false;\n        console.log(\'Dinero suficiente - botón habilitado\');\n    }\n}\n\nfunction confirmarPagoEfectivo() {\n    const input = document.getElementById(\'cashReceived\');\n    if (input) {\n        const recibido = parseFloat(input.value) || 0;\n        if (recibido >= totalDelPedido) {\n            enviarPago(\'efectivo\', recibido);\n        }\n    }\n}\n\nfunction enviarPago(metodo, dinero = null) {\n    const form = document.createElement(\'form\');\n    form.method = \'POST\';\n    form.action = \'/pay_order/{{ mesa.id }}\';\n    \n    const inputMetodo = document.createElement(\'input\');\n    inputMetodo.type = \'hidden\';\n    inputMetodo.name = \'forma_pago\';\n    inputMetodo.value = metodo;\n    form.appendChild(inputMetodo);\n    \n    if (metodo === \'efectivo\' && dinero) {\n        const inputDinero = document.createElement(\'input\');\n        inputDinero.type = \'hidden\';\n        inputDinero.name = \'dinero_recibido\';\n        inputDinero.value = dinero.toFixed(2);\n        form.appendChild(inputDinero);\n        \n        const inputCambio = document.createElement(\'input\');\n        inputCambio.type = \'hidden\';\n        inputCambio.name = \'cambio\';\n        inputCambio.value = (dinero - totalDelPedido).toFixed(2);\n        form.appendChild(inputCambio);\n    }\n    \n    document.body.appendChild(form);\n    form.submit();\n}\n\nfunction obtenerTotal() {\n    // Buscar en resumen\n    const resumen = document.querySelector(\'.summary-value\');\n    if (resumen) {\n        const texto = resumen.textContent.replace(\'€\', \'\').replace(\',\', \'.\');\n        return parseFloat(texto) || 0;\n    }\n    \n    // Calcular desde items\n    let total = 0;\n    const items = document.querySelectorAll(\'.order-item\');\n    items.forEach(item => {\n        const precio = item.querySelector(\'.item-price\');\n        const cantidad = item.querySelector(\'.quantity\');\n        if (precio && cantidad) {\n            const p = parseFloat(precio.textContent.replace(\'€\', \'\')) || 0;\n            const c = parseInt(cantidad.textContent) || 0;\n            total += p * c;\n        }\n    });\n    \n    return total;\n}\n\nfunction cerrarModal() {\n    const modal = document.getElementById(\'closeOrderModal\');\n    if (modal) modal.style.display = \'none\';\n}\n\nfunction ocultarCalculadora() {\n    const calc = document.getElementById(\'cashCalculator\');\n    if (calc) calc.style.display = \'none\';\n}\n\n\n</script>\n', PosixPath('templates/table_detail.html'), 'config..semgrep.vendored-rules.html.security.audit.insecure-document-method') match_id = 3750e1296f3d1c3c1641c87f40db676442065800d5c342795b995f01bcfe5a4d27ca61c5ea0dfadf2eea19c178d7118b8b8c8013553eaa4746b528834981e7f7_0
2025-06-07 16:37:42,851 - semgrep.core_runner - DEBUG - semgrep ran in 0:00:06.496303 on 85 files
2025-06-07 16:37:42,852 - semgrep.core_runner - DEBUG - findings summary: 36 warning, 12 error, 0 info
2025-06-07 16:37:42,859 - semgrep.app.auth - DEBUG - Getting API token from settings file
2025-06-07 16:37:42,860 - semgrep.app.auth - DEBUG - No API token found in settings file
2025-06-07 16:37:42,863 - semgrep.semgrep_core - DEBUG - Failed to open resource semgrep-core-proprietary: [Errno 2] No such file or directory: '/tmp/_MEIIzo2Qk/semgrep/bin/semgrep-core-proprietary'.
2025-06-07 16:37:43,030 - semgrep.output - VERBOSE - 
========================================
Files skipped:
========================================

  Always skipped by Opengrep:

   • <none>

  Skipped by .gitignore:
  (Disable by passing --no-git-ignore)

   • <all files not listed by `git ls-files` were skipped>

  Skipped by .semgrepignore:
  - https://semgrep.dev/docs/ignoring-files-folders-code/#understand-semgrep-defaults

   • <none>

  Skipped by --include patterns:

   • <none>

  Skipped by --exclude patterns:

   • <none>

  Files skipped due to insufficient read permissions:

   • <none>

  Skipped by limiting to files smaller than 1000000 bytes:
  (Adjust with the --max-target-bytes flag)

   • attached_assets/IMG_0547.jpeg
   • attached_assets/IMG_5934.png
   • attached_assets/image_1748332515917.png
   • attached_assets/image_1748341370570.png
   • attached_assets/image_1748361528505.jpeg
   • attached_assets/image_1748379440627.png

  Partially analyzed due to parsing or internal Opengrep errors

   • bar_yedra_tpv.py (31 lines skipped)
   • templates/barra.html (6 lines skipped)
   • templates/carta.html (6 lines skipped)
   • templates/cash_register.html (8 lines skipped)
   • templates/edit_product.html (17 lines skipped)
   • templates/empleados.html (6 lines skipped)
   • templates/fichaje.html (6 lines skipped)
   • templates/index.html (64 lines skipped)
   • templates/index_tpv.html (8 lines skipped)
   • templates/informe_fichajes.html (6 lines skipped)
   • templates/inventory.html (6 lines skipped)
   • templates/login.html (4 lines skipped)
   • templates/mesa_pedido.html (42 lines skipped)
   • templates/nuevo_empleado.html (6 lines skipped)
   • templates/products.html (7 lines skipped)
   • templates/products_tpv.html (10 lines skipped)
   • templates/qr_menu.html (6 lines skipped)
   • templates/reports.html (7 lines skipped)
   • templates/sala.html (6 lines skipped)
   • templates/table_detail.html (94 lines skipped)
   • templates/table_detail_broken.html (7 lines skipped)
   • templates/table_detail_broken_final.html (7 lines skipped)
   • templates/terraza.html (6 lines skipped)

2025-06-07 16:37:43,032 - semgrep.output - INFO - Some files were skipped or only partially analyzed.
  Scan was limited to files tracked by git.
  Partially scanned: 23 files only partially analyzed due to parsing or internal Opengrep errors
  Scan skipped: 6 files larger than 1.0 MB
  For a full list of skipped files, run opengrep with the --verbose flag.

Ran 681 rules on 85 files: 48 findings.
2025-06-07 16:37:43,032 - semgrep.app.version - DEBUG - Version cache does not exist
2025-06-07 16:37:43,032 - semgrep.app.version - DEBUG - Version cache does not exist
2025-06-07 16:37:43,048 - semgrep.metrics - VERBOSE - Not sending pseudonymous metrics since metrics are configured to OFF and registry usage is False
