{% extends "layout.html" %}

{% block title %}Productos{% endblock %}

{% block content %}
<div class="content-header">
    <h1 class="page-title">Gesti√≥n de Productos</h1>
    <button class="btn btn-primary btn-lg touch-friendly" onclick="showAddProductModal()">
        <i class="icon-plus"></i> A√±adir Producto
    </button>
</div>

<div class="content-container">
    <!-- Productos organizados por categor√≠a -->
    {% for categoria, productos in productos_por_categoria.items() %}
    <div class="category-section">
        <h2 class="category-title">
            <i class="icon-tag"></i> {{ categoria }}
            <span class="category-count">({{ productos|length }})</span>
        </h2>
        
        <div class="products-grid">
            {% for producto in productos %}
            <div class="product-card touch-friendly">
                <div class="product-image">
                    {% if producto.foto_url %}
                        <img src="{{ producto.foto_url }}" alt="{{ producto.nombre }}" class="product-photo">
                    {% else %}
                        <div class="product-placeholder">
                            <i class="icon-image"></i>
                        </div>
                    {% endif %}
                </div>
                
                <div class="product-info">
                    <h3 class="product-name">{{ producto.nombre }}</h3>
                    <p class="product-price">‚Ç¨{{ "%.2f"|format(producto.precio) }}</p>
                    {% if producto.descripcion %}
                        <p class="product-description">{{ producto.descripcion }}</p>
                    {% endif %}
                </div>
                
                <div class="product-actions">
                    <button class="btn btn-danger btn-sm touch-friendly" 
                            onclick="deleteProduct({{ producto.id }}, '{{ producto.nombre }}')">
                        <i class="icon-trash"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
    
    {% if not productos_por_categoria %}
    <div class="empty-state">
        <div class="empty-icon">
            <i class="icon-package"></i>
        </div>
        <h3>No hay productos</h3>
        <p>A√±ade tu primer producto para comenzar</p>
        <button class="btn btn-primary btn-lg touch-friendly" onclick="showAddProductModal()">
            <i class="icon-plus"></i> A√±adir Primer Producto
        </button>
    </div>
    {% endif %}
</div>

<!-- Modal para a√±adir producto - Optimizado para t√°ctil -->
<div id="addProductModal" class="modal">
    <div class="modal-content touch-optimized">
        <div class="modal-header">
            <h2><i class="icon-plus"></i> Nuevo Producto</h2>
            <button class="modal-close touch-friendly" onclick="hideAddProductModal()">
                <i class="icon-x"></i>
            </button>
        </div>
        
        <form method="POST" action="{{ url_for('add_product') }}" class="product-form">
            <div class="form-grid">
                <div class="form-group">
                    <label for="nombre" class="form-label">Nombre del Producto</label>
                    <input type="text" class="form-input touch-friendly" id="nombre" name="nombre" required 
                           placeholder="Ej: Caf√© con leche">
                </div>
                
                <div class="form-group">
                    <label for="precio" class="form-label">Precio (‚Ç¨)</label>
                    <input type="number" step="0.01" class="form-input touch-friendly" id="precio" name="precio" required 
                           placeholder="2.50">
                </div>
                
                <div class="form-group">
                    <label for="categoria" class="form-label">Categor√≠a</label>
                    <select class="form-input touch-friendly" id="categoria" name="categoria" required>
                        <option value="Bebidas Calientes">‚òï Bebidas Calientes</option>
                        <option value="Bebidas Fr√≠as">ü•§ Bebidas Fr√≠as</option>
                        <option value="Alcoholicas">üç∫ Bebidas Alcoh√≥licas</option>
                        <option value="Comida">üçΩÔ∏è Comida</option>
                        <option value="Tapas">üç§ Tapas</option>
                        <option value="Postres">üç∞ Postres</option>
                        <option value="General">üì¶ General</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="foto_url" class="form-label">URL de la Foto (opcional)</label>
                    <input type="url" class="form-input touch-friendly" id="foto_url" name="foto_url" 
                           placeholder="https://ejemplo.com/imagen.jpg">
                </div>
                
                <div class="form-group full-width">
                    <label for="descripcion" class="form-label">Descripci√≥n (opcional)</label>
                    <textarea class="form-input touch-friendly" id="descripcion" name="descripcion" rows="3" 
                              placeholder="Descripci√≥n breve del producto..."></textarea>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary btn-lg touch-friendly" onclick="hideAddProductModal()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary btn-lg touch-friendly">
                    <i class="icon-check"></i> Crear Producto
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function showAddProductModal() {
    document.getElementById('addProductModal').style.display = 'flex';
}

function hideAddProductModal() {
    document.getElementById('addProductModal').style.display = 'none';
}

function deleteProduct(id, nombre) {
    if (confirm(`¬øEst√°s seguro de eliminar "${nombre}"?`)) {
        window.location.href = `/delete_product/${id}`;
    }
}
</script>
{% endblock %}