{% extends "layout.html" %}

{% block title %}Productos{% endblock %}

{% block content %}
<div class="content-header">
    <h1 class="page-title">Gesti√≥n de Productos</h1>
    <button class="btn btn-primary btn-lg touch-friendly" onclick="showAddProductModal()">
        <i class="icon-plus"></i> A√±adir Producto
    </button>
</div>

<div class="content-container">
    <!-- Productos organizados por categor√≠a -->
    {% for categoria, productos in productos_por_categoria.items() %}
    <div class="category-section">
        <h2 class="category-title">
            <i class="icon-tag"></i> {{ categoria }}
            <span class="category-count">({{ productos|length }})</span>
        </h2>
        
        <div class="products-grid">
            {% for producto in productos %}
            <div class="product-card touch-friendly">
                <div class="product-image">
                    {% if producto.foto_url %}
                        <img src="{{ producto.foto_url }}" alt="{{ producto.nombre }}" class="product-photo">
                    {% else %}
                        <div class="product-placeholder">
                            <i class="icon-image"></i>
                        </div>
                    {% endif %}
                </div>
                
                <div class="product-info">
                    <h3 class="product-name">{{ producto.nombre }}</h3>
                    <p class="product-price">‚Ç¨{{ "%.2f"|format(producto.precio) }}</p>
                    {% if producto.descripcion %}
                        <p class="product-description">{{ producto.descripcion }}</p>
                    {% endif %}
                </div>
                
                <!-- Botones simples sin estilos complejos -->
                <div style="display: flex; gap: 10px; margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 8px;">
                    <button style="flex: 1; padding: 12px; background: #ff8c00; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;" onclick="openEditModal({{ producto.id }}, '{{ producto.nombre }}', {{ producto.precio }}, '{{ producto.categoria }}', '{{ producto.foto_url or '' }}', '{{ producto.descripcion or '' }}')">
                        ‚úèÔ∏è EDITAR
                    </button>
                    <button style="flex: 1; padding: 12px; background: #dc3545; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;" onclick="deleteProduct({{ producto.id }}, '{{ producto.nombre }}')">
                        üóëÔ∏è ELIMINAR
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
    
    {% if not productos_por_categoria %}
    <div class="empty-state">
        <div class="empty-icon">
            <i class="icon-package"></i>
        </div>
        <h3>No hay productos</h3>
        <p>A√±ade tu primer producto para comenzar</p>
        <button class="btn btn-primary btn-lg touch-friendly" onclick="showAddProductModal()">
            <i class="icon-plus"></i> A√±adir Primer Producto
        </button>
    </div>
    {% endif %}
</div>

<!-- Modal para editar producto -->
<div id="editProductModal" class="modal" style="display: none;">
    <div class="modal-content touch-optimized">
        <div class="modal-header">
            <h2><i class="fas fa-edit"></i> Editar Producto</h2>
            <button class="modal-close touch-friendly" onclick="hideEditProductModal()">
                <i class="icon-x"></i>
            </button>
        </div>
        
        <form id="editProductForm" method="POST" action="" class="product-form">
            <div class="form-grid">
                <div class="form-group">
                    <label for="edit_nombre" class="form-label">Nombre del Producto</label>
                    <input type="text" id="edit_nombre" name="nombre" required class="form-input touch-friendly">
                </div>
                
                <div class="form-group">
                    <label for="edit_precio" class="form-label">Precio (‚Ç¨)</label>
                    <input type="number" id="edit_precio" name="precio" step="0.01" min="0" required class="form-input touch-friendly">
                </div>
                
                <div class="form-group">
                    <label for="edit_categoria" class="form-label">Categor√≠a</label>
                    <select id="edit_categoria" name="categoria" required class="form-input touch-friendly">
                        <option value="Caf√©s">Caf√©s</option>
                        <option value="Desayunos">Desayunos</option>
                        <option value="Montados">Montados</option>
                        <option value="Platos Calientes">Platos Calientes</option>
                        <option value="Helados">Helados</option>
                        <option value="Bebidas">Bebidas</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit_foto_url" class="form-label">URL de la Imagen</label>
                    <input type="url" id="edit_foto_url" name="foto_url" class="form-input touch-friendly" placeholder="https://ejemplo.com/imagen.jpg">
                </div>
                
                <div class="form-group form-group-full">
                    <label for="edit_descripcion" class="form-label">Descripci√≥n</label>
                    <textarea id="edit_descripcion" name="descripcion" rows="3" class="form-input touch-friendly" placeholder="Descripci√≥n opcional del producto"></textarea>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="submit" class="btn btn-primary btn-lg touch-friendly">
                    <i class="icon-save"></i> Guardar Cambios
                </button>
                <button type="button" class="btn btn-secondary btn-lg touch-friendly" onclick="hideEditProductModal()">
                    <i class="icon-x"></i> Cancelar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal para a√±adir producto - Optimizado para t√°ctil -->
<div id="addProductModal" class="modal">
    <div class="modal-content touch-optimized">
        <div class="modal-header">
            <h2><i class="icon-plus"></i> Nuevo Producto</h2>
            <button class="modal-close touch-friendly" onclick="hideAddProductModal()">
                <i class="icon-x"></i>
            </button>
        </div>
        
        <form method="POST" action="{{ url_for('add_product') }}" class="product-form">
            <div class="form-grid">
                <div class="form-group">
                    <label for="nombre" class="form-label">Nombre del Producto</label>
                    <input type="text" class="form-input touch-friendly" id="nombre" name="nombre" required 
                           placeholder="Ej: Caf√© con leche">
                </div>
                
                <div class="form-group">
                    <label for="precio" class="form-label">Precio (‚Ç¨)</label>
                    <input type="number" step="0.01" class="form-input touch-friendly" id="precio" name="precio" required 
                           placeholder="2.50">
                </div>
                
                <div class="form-group">
                    <label for="categoria" class="form-label">Categor√≠a</label>
                    <select class="form-input touch-friendly" id="categoria" name="categoria" required>
                        <option value="Bebidas Calientes">‚òï Bebidas Calientes</option>
                        <option value="Bebidas Fr√≠as">ü•§ Bebidas Fr√≠as</option>
                        <option value="Alcoholicas">üç∫ Bebidas Alcoh√≥licas</option>
                        <option value="Comida">üçΩÔ∏è Comida</option>
                        <option value="Tapas">üç§ Tapas</option>
                        <option value="Postres">üç∞ Postres</option>
                        <option value="General">üì¶ General</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="foto_url" class="form-label">URL de la Foto (opcional)</label>
                    <input type="url" class="form-input touch-friendly" id="foto_url" name="foto_url" 
                           placeholder="https://ejemplo.com/imagen.jpg">
                </div>
                
                <div class="form-group full-width">
                    <label for="descripcion" class="form-label">Descripci√≥n (opcional)</label>
                    <textarea class="form-input touch-friendly" id="descripcion" name="descripcion" rows="3" 
                              placeholder="Descripci√≥n breve del producto..."></textarea>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary btn-lg touch-friendly" onclick="hideAddProductModal()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary btn-lg touch-friendly">
                    <i class="icon-check"></i> Crear Producto
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function showAddProductModal() {
    document.getElementById('addProductModal').style.display = 'flex';
}

function hideAddProductModal() {
    document.getElementById('addProductModal').style.display = 'none';
}

function openEditModal(id, nombre, precio, categoria, foto_url, descripcion) {
    // Llenar el formulario con los datos del producto
    document.getElementById('edit_nombre').value = nombre;
    document.getElementById('edit_precio').value = precio;
    document.getElementById('edit_categoria').value = categoria;
    document.getElementById('edit_foto_url').value = foto_url;
    document.getElementById('edit_descripcion').value = descripcion;
    
    // Configurar la acci√≥n del formulario
    document.getElementById('editProductForm').action = `/update_product/${id}`;
    
    // Mostrar el modal
    document.getElementById('editProductModal').style.display = 'flex';
}

function hideEditProductModal() {
    document.getElementById('editProductModal').style.display = 'none';
}

function deleteProduct(id, nombre) {
    if (confirm(`¬øEst√°s seguro de eliminar "${nombre}"?`)) {
        window.location.href = `/delete_product/${id}`;
    }
}
</script>

<style>
/* Estilos para botones de editar/eliminar */
.product-buttons {
    display: flex !important;
    gap: 8px !important;
    margin-top: 15px !important;
    padding: 10px !important;
    background: #f8f9fa !important;
    border-radius: 8px !important;
    width: 100% !important;
}

.btn-edit-orange, .btn-delete-red {
    flex: 1 !important;
    padding: 12px 8px !important;
    border: none !important;
    border-radius: 6px !important;
    font-size: 13px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    text-align: center !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 4px !important;
    min-height: 40px !important;
}

.btn-edit-orange {
    background: #ff8c00 !important;
    color: white !important;
    border: 2px solid #ff8c00 !important;
}

.btn-edit-orange:hover {
    background: #ff7700 !important;
    border: 2px solid #ff7700 !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 8px rgba(255, 140, 0, 0.3) !important;
}

.btn-delete-red {
    background: #dc3545 !important;
    color: white !important;
    border: 2px solid #dc3545 !important;
}

.btn-delete-red:hover {
    background: #c82333 !important;
    border: 2px solid #c82333 !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3) !important;
}

.product-card {
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 16px;
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s ease;
}

.product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}

/* Responsive */
@media (max-width: 768px) {
    .btn-edit-orange, .btn-delete-red {
        padding: 15px 20px;
        font-size: 16px;
    }
}
</style>
{% endblock %}